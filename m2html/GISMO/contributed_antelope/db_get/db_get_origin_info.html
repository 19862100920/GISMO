<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of db_get_origin_info</title>
  <meta name="keywords" content="db_get_origin_info">
  <meta name="description" content="ORIGIN = DB_GET_ORIGIN_INFO(EVENT,DATABASE_NAME) If EVENT is a vector">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="../../index.html">GISMO</a> &gt; <a href="#">contributed_antelope</a> &gt; <a href="index.html">db_get</a> &gt; db_get_origin_info.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for GISMO/contributed_antelope/db_get&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>db_get_origin_info
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>ORIGIN = DB_GET_ORIGIN_INFO(EVENT,DATABASE_NAME) If EVENT is a vector</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function [origin,W] = db_get_origin_info(INorigin,dbname,varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> ORIGIN = DB_GET_ORIGIN_INFO(EVENT,DATABASE_NAME) If EVENT is a vector
 of origin id numbers (orid) then the returned structure ORIGIN contains
 fields pulled from the origin table.

 If EVENT is a vector of string times (one time per row) then the database
 is searched for the origin occuring closest in time to each element of
 EVENT (preferred origins only). Using the ORID is a more precise way to
 pull events from the database, however, orid's have no inherent meaning
 and may change. Using (approximate) origin times avoids this.

 [ORIGIN,WAVEFORM] = DB_GET_ORIGIN_INFO(EVENT,DATABASE_NAME,WAVEFORM) Add 
 origin information as new fields in WAVEFORM object.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../GISMO/core/@Catalog/disp.html" class="code" title="function disp(obj, showall)">disp</a>	CATALOG.DISP Display Catalog object</li><li><a href="../../../GISMO/core/@datasource/disp.html" class="code" title="function disp(ds)">disp</a>	DISP Datasource disp overloaded operator</li><li><a href="../../../GISMO/core/@filterobject/disp.html" class="code" title="function disp(f)">disp</a>	DISP - Filterobject disp overloaded operator</li><li><a href="../../../GISMO/core/@scnlobject/disp.html" class="code" title="function disp(sncl)">disp</a>	DISP - scnl disp overloaded operator</li><li><a href="../../../GISMO/core/@spectralobject/disp.html" class="code" title="function disp(s)">disp</a>	DISP - spectralobject disp overloaded operator</li><li><a href="../../../GISMO/core/@threecomp/disp.html" class="code" title="function disp(TC)">disp</a>	DISP Display threecomp object</li><li><a href="../../../GISMO/core/@waveform/abs.html" class="code" title="function w = abs(w)">abs</a>	ABS Absolute value for the waveform object</li><li><a href="../../../GISMO/core/@waveform/addfield.html" class="code" title="function w = addfield(w,fieldname,value,noHistOption)">addfield</a>	ADDFIELD add fields and values to waveform object(s)                V1.1</li><li><a href="../../../GISMO/core/@waveform/disp.html" class="code" title="function disp(w)">disp</a>	DISP Waveform disp overloaded operator</li><li><a href="../../../GISMO/core/@waveform/min.html" class="code" title="function [Y, I] = min(w)">min</a>	MIN    Smallest value of a waveform.</li><li><a href="../../../GISMO/core/dev/@NewCorrelation/disp.html" class="code" title="function disp(c)">disp</a>	CORRELATION/DISPLAY Command window display of a correlation object</li><li><a href="../../../GISMO/core/dev/@SeismicTrace/disp.html" class="code" title="function disp(T)">disp</a>	disp   Display information about SeismicTrace(s)</li><li><a href="../../../GISMO/deprecated/@helicorder/disp.html" class="code" title="function disp(h)">disp</a>	DISP: Helicorder disp overloaded operator</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function neworigin = getorids(origin,dbname);</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [origin,W] = db_get_origin_info(INorigin,dbname,varargin)</a>
0002 
0003 
0004 <span class="comment">% ORIGIN = DB_GET_ORIGIN_INFO(EVENT,DATABASE_NAME) If EVENT is a vector</span>
0005 <span class="comment">% of origin id numbers (orid) then the returned structure ORIGIN contains</span>
0006 <span class="comment">% fields pulled from the origin table.</span>
0007 <span class="comment">%</span>
0008 <span class="comment">% If EVENT is a vector of string times (one time per row) then the database</span>
0009 <span class="comment">% is searched for the origin occuring closest in time to each element of</span>
0010 <span class="comment">% EVENT (preferred origins only). Using the ORID is a more precise way to</span>
0011 <span class="comment">% pull events from the database, however, orid's have no inherent meaning</span>
0012 <span class="comment">% and may change. Using (approximate) origin times avoids this.</span>
0013 <span class="comment">%</span>
0014 <span class="comment">% [ORIGIN,WAVEFORM] = DB_GET_ORIGIN_INFO(EVENT,DATABASE_NAME,WAVEFORM) Add</span>
0015 <span class="comment">% origin information as new fields in WAVEFORM object.</span>
0016 
0017 <span class="comment">% Author: Michael West, Geophysical Institute, Univ. of Alaska Fairbanks</span>
0018 <span class="comment">% $Date$</span>
0019 <span class="comment">% $Revision$</span>
0020 
0021 
0022 
0023 <span class="comment">%  FOR TESTING ONLY</span>
0024 <span class="comment">%dbname = '/home/admin/databases/AU06/wf/au06wf_2006_01';</span>
0025 <span class="comment">%INorigin = [</span>
0026 <span class="comment">%    '1/26/2006 11:58:59'</span>
0027 <span class="comment">%    '1/27/2006 04:10:13'</span>
0028 <span class="comment">%    '1/11/2006 07:01:49'</span>
0029 <span class="comment">%    '1/31/2006 22:02:10'</span>
0030 <span class="comment">%];</span>
0031 <span class="comment">%INorigin = [</span>
0032 <span class="comment">%    31301880</span>
0033 <span class="comment">%    31301918</span>
0034 <span class="comment">%    31300878</span>
0035 <span class="comment">%    31302068</span>
0036 <span class="comment">%];</span>
0037 
0038 
0039 
0040 <span class="keyword">if</span> isnumeric(INorigin)
0041     origin.orid = reshape( INorigin , numel(INorigin), 1 );
0042 <span class="keyword">elseif</span> ischar(INorigin)
0043     <span class="keyword">for</span> n = 1:size(INorigin,1)
0044         tmp(n) = str2epoch(INorigin(n,:));
0045     <span class="keyword">end</span>
0046     tmp = <a href="#_sub1" class="code" title="subfunction neworigin = getorids(origin,dbname);">getorids</a>(tmp,dbname);
0047     origin.orid = reshape( tmp , numel(tmp), 1 );
0048 
0049 <span class="keyword">else</span>
0050     error(<span class="string">'First input must be either origin ids or sting-formatted times'</span>);
0051 <span class="keyword">end</span>
0052 
0053 
0054 <span class="comment">% Check for waveform</span>
0055 <span class="keyword">if</span> numel(varargin) == 1
0056     W = varargin{1};
0057     <span class="keyword">if</span> ~isa(W,<span class="string">'waveform'</span>)
0058         error(<span class="string">'Third argument must be a WAVEFORM object'</span>);
0059     <span class="keyword">end</span>
0060 <span class="keyword">elseif</span> numel(varargin) &gt; 1
0061     error(<span class="string">'Too many arguments'</span>);
0062 <span class="keyword">end</span>
0063 <span class="keyword">if</span> nargout==2 &amp;&amp; nargin~=3
0064     error(<span class="string">'Mismatched number of input and/or output arguments'</span>);
0065 <span class="keyword">end</span>
0066 
0067 
0068 <span class="comment">% GET ORIGIN TIME</span>
0069 db = dbopen(dbname,<span class="string">'r'</span>);
0070 db = dblookup_table(db,<span class="string">'origin'</span>);
0071 nlist = [];
0072 <span class="keyword">for</span> n = 1:length(origin.orid);
0073     db1 = dbsubset(db,[<span class="string">'orid=='</span> num2str(origin.orid(n))]);
0074     [ origin.lat(n),origin.lon(n),origin.depth(n),origin.time_epoch(n),origin.ml(n),origin.orid(n)] = dbgetv(db1,<span class="string">'lat'</span>,<span class="string">'lon'</span>,<span class="string">'depth'</span>,<span class="string">'time'</span>,<span class="string">'ml'</span>,<span class="string">'orid'</span>);
0075 <span class="keyword">end</span>
0076 dbclose(db);
0077 origin.lat = reshape( origin.lat , numel(origin.lat), 1 );
0078 origin.lon = reshape( origin.lon , numel(origin.lon), 1 );
0079 origin.depth = reshape( origin.depth , numel(origin.depth), 1 );
0080 origin.time_epoch = reshape( origin.time_epoch , numel(origin.time_epoch), 1 );
0081 origin.ml = reshape( origin.ml , numel(origin.ml), 1 );
0082 origin.time_matlab = datenum(strtime(origin.time_epoch));
0083 origin.orid = reshape( origin.orid , numel(origin.orid), 1 );
0084 <span class="keyword">if</span> exist(<span class="string">'W'</span>)
0085     <span class="keyword">for</span> n = 1:numel(W)
0086         <a href="../../../GISMO/core/@Catalog/disp.html" class="code" title="function disp(obj, showall)">disp</a>([ <span class="string">'Retreiving origin info for orid: '</span> num2str(origin.orid(n)) <span class="string">' ... '</span>])
0087         W(n) = <a href="../../../GISMO/core/@waveform/addfield.html" class="code" title="function w = addfield(w,fieldname,value,noHistOption)">addfield</a>(W(n),<span class="string">'ORIGIN_LAT'</span>,origin.lat(n));
0088         W(n) = <a href="../../../GISMO/core/@waveform/addfield.html" class="code" title="function w = addfield(w,fieldname,value,noHistOption)">addfield</a>(W(n),<span class="string">'ORIGIN_LON'</span>,origin.lon(n));
0089         W(n) = <a href="../../../GISMO/core/@waveform/addfield.html" class="code" title="function w = addfield(w,fieldname,value,noHistOption)">addfield</a>(W(n),<span class="string">'ORIGIN_DEPTH'</span>,origin.depth(n));
0090         W(n) = <a href="../../../GISMO/core/@waveform/addfield.html" class="code" title="function w = addfield(w,fieldname,value,noHistOption)">addfield</a>(W(n),<span class="string">'ORIGIN_TIME_EPOCH'</span>,origin.time_epoch(n));
0091         W(n) = <a href="../../../GISMO/core/@waveform/addfield.html" class="code" title="function w = addfield(w,fieldname,value,noHistOption)">addfield</a>(W(n),<span class="string">'ORIGIN_ML'</span>,origin.ml(n));
0092         W(n) = <a href="../../../GISMO/core/@waveform/addfield.html" class="code" title="function w = addfield(w,fieldname,value,noHistOption)">addfield</a>(W(n),<span class="string">'ORIGIN_TIME_MATLAB'</span>,origin.time_matlab(n));
0093         W(n) = <a href="../../../GISMO/core/@waveform/addfield.html" class="code" title="function w = addfield(w,fieldname,value,noHistOption)">addfield</a>(W(n),<span class="string">'ORIGIN_ORID'</span>,origin.orid(n));
0094     <span class="keyword">end</span>
0095 <span class="keyword">end</span>
0096 
0097 
0098 
0099 
0100 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0101 <span class="comment">% RETURN ORID FOR EVENT CLOSEST IN TIME TO INPUT</span>
0102 <a name="_sub1" href="#_subfunctions" class="code">function neworigin = getorids(origin,dbname);</a>
0103 
0104 db = dbopen(dbname,<span class="string">'r'</span>);
0105 db = dblookup_table(db,<span class="string">'origin'</span>);
0106 db1 = dblookup_table(db,<span class="string">'event'</span>);
0107 db = dbjoin(db,db1);
0108 db = dbsubset(db,<span class="string">'orid==prefor'</span>);
0109 nrecords = dbquery(db,<span class="string">'dbRECORD_COUNT'</span>);
0110 <span class="comment">%display(['Number of records: ' num2str(nrecords)]);</span>
0111 [orid,time] = dbgetv(db,<span class="string">'orid'</span>,<span class="string">'time'</span>);
0112 dbclose(db);
0113 
0114 <span class="keyword">for</span> n = 1:length(origin)
0115     [tmp,index] = <a href="../../../GISMO/core/@waveform/min.html" class="code" title="function [Y, I] = min(w)">min</a>(<a href="../../../GISMO/core/@waveform/abs.html" class="code" title="function w = abs(w)">abs</a>(origin(n)-time));
0116     neworigin(n) = orid(index);
0117 <span class="keyword">end</span>;
0118 
0119</pre></div>
<hr><address>Generated on Wed 12-Oct-2016 17:36:30 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>