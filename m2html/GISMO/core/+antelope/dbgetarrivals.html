<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of dbgetarrivals</title>
  <meta name="keywords" content="dbgetarrivals">
  <meta name="description" content="DBGETARRIVALS Load arrivals from an Antelope CSS3.0 database">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="../../index.html">GISMO</a> &gt; <a href="#">core</a> &gt; <a href="index.html">+antelope</a> &gt; dbgetarrivals.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for GISMO/core/+antelope&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>dbgetarrivals
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>DBGETARRIVALS Load arrivals from an Antelope CSS3.0 database</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function a = dbgetarrivals(databasePath, subset_expr) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">DBGETARRIVALS Load arrivals from an Antelope CSS3.0 database

 arrivals = DBGETORIGINS(dbpath) opens the arrival table belonging to
 the database specified by dbpath. The arrival table will be joined to
 the assoc, origin and event tables too, if these are present. If all
 of these is present, only arrivals corresponding to preferred origins
 will be loaded. If assoc is present, but not event or origin, only
 arrivals referenced in the assoc table are loaded.

 The output is a structure containing the fields:
   * arid
   * sta
   * chan
   * time (arrival date/time converted from epoch to MATLAB datenum)
   * iphase
   * amp
   * snr
   * seaz
   * deltim
   * iphase
   * delta
   * otime (origin date/time converted from epoch to MATLAB datenum)
   * orid
   * evid
   * timeres
   * traveltime (= time - otime)

 All these fields are vectors of numbers, or cell arrays of strings.
 If you want more fields adding, please email Glenn    

 arrivals = DBGETARRIVALS(dbpath, subset_expression) evaluates the
 subset specified before reading the arrivals. subset_expression must
 be a valid expression accepted by dbe/dbeval.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="dbtable_present.html" class="code" title="function present=dbtable_present(dbpath, table)">dbtable_present</a>	DBTABLE_PRESENT Check if a Datascope database table exists and has more than 0 rows.</li><li><a href="../../../GISMO/libgismo/epoch2datenum.html" class="code" title="function time = epoch2datenum(epoch)">epoch2datenum</a>	TIME = EPOCH2DATENUM(EPOCH) translates Unix epoch date format into Matlab</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function a = dbgetarrivals(databasePath, subset_expr)</a>
0002     <span class="comment">%DBGETARRIVALS Load arrivals from an Antelope CSS3.0 database</span>
0003     <span class="comment">%</span>
0004     <span class="comment">% arrivals = DBGETORIGINS(dbpath) opens the arrival table belonging to</span>
0005     <span class="comment">% the database specified by dbpath. The arrival table will be joined to</span>
0006     <span class="comment">% the assoc, origin and event tables too, if these are present. If all</span>
0007     <span class="comment">% of these is present, only arrivals corresponding to preferred origins</span>
0008     <span class="comment">% will be loaded. If assoc is present, but not event or origin, only</span>
0009     <span class="comment">% arrivals referenced in the assoc table are loaded.</span>
0010     <span class="comment">%</span>
0011     <span class="comment">% The output is a structure containing the fields:</span>
0012     <span class="comment">%   * arid</span>
0013     <span class="comment">%   * sta</span>
0014     <span class="comment">%   * chan</span>
0015     <span class="comment">%   * time (arrival date/time converted from epoch to MATLAB datenum)</span>
0016     <span class="comment">%   * iphase</span>
0017     <span class="comment">%   * amp</span>
0018     <span class="comment">%   * snr</span>
0019     <span class="comment">%   * seaz</span>
0020     <span class="comment">%   * deltim</span>
0021     <span class="comment">%   * iphase</span>
0022     <span class="comment">%   * delta</span>
0023     <span class="comment">%   * otime (origin date/time converted from epoch to MATLAB datenum)</span>
0024     <span class="comment">%   * orid</span>
0025     <span class="comment">%   * evid</span>
0026     <span class="comment">%   * timeres</span>
0027     <span class="comment">%   * traveltime (= time - otime)</span>
0028     <span class="comment">%</span>
0029     <span class="comment">% All these fields are vectors of numbers, or cell arrays of strings.</span>
0030     <span class="comment">% If you want more fields adding, please email Glenn</span>
0031     <span class="comment">%</span>
0032     <span class="comment">% arrivals = DBGETARRIVALS(dbpath, subset_expression) evaluates the</span>
0033     <span class="comment">% subset specified before reading the arrivals. subset_expression must</span>
0034     <span class="comment">% be a valid expression accepted by dbe/dbeval.</span>
0035     
0036     <span class="comment">% Author: Glenn Thompson</span>
0037     <span class="comment">%</span>
0038     <span class="comment">%% To do:</span>
0039     <span class="comment">%   test</span>
0040 
0041     <span class="comment">%% Load the earthquake catalogue</span>
0042     
0043     <span class="comment">% Initialize output so we don't crash if return early</span>
0044     a = struct(<span class="string">'sta'</span>, [], <span class="string">'chan'</span>,[], <span class="string">'time'</span>, [], <span class="string">'arid'</span>,[], <span class="string">'amp'</span>,[], <span class="keyword">...</span>
0045         <span class="string">'snr'</span>,[], <span class="string">'seaz'</span>, [], <span class="string">'deltim'</span>, [], <span class="string">'iphase'</span>, {}, <span class="string">'delta'</span>, [], <span class="string">'otime'</span>, [], <span class="keyword">...</span>
0046         <span class="string">'orid'</span>, [], <span class="string">'evid'</span>, [], <span class="string">'timeres'</span>, [], <span class="string">'traveltime'</span>, []);
0047 
0048     <span class="comment">% Check the database descriptor exists - if not abort</span>
0049     <span class="keyword">if</span> ~exist(databasePath, <span class="string">'file'</span>)
0050         warning(sprintf(<span class="string">'Database %s does not exist, please type in a different one'</span>,databasePath));
0051         <span class="keyword">return</span>
0052     <span class="keyword">end</span>
0053     debug.print_debug(0, sprintf(<span class="string">'Loading data from %s'</span>,databasePath));
0054     ARRIVAL_TABLE_PRESENT = <a href="dbtable_present.html" class="code" title="function present=dbtable_present(dbpath, table)">dbtable_present</a>(databasePath, <span class="string">'arrival'</span>);    
0055     <span class="keyword">if</span> (ARRIVAL_TABLE_PRESENT) <span class="comment">% Open the arrival table, subset if expr exists</span>
0056         db = dbopen(databasePath, <span class="string">'r'</span>);
0057         db = dblookup_table(db, <span class="string">'arrival'</span>);
0058         numarrivals = dbquery(db,<span class="string">'dbRECORD_COUNT'</span>);
0059         debug.print_debug(1,sprintf(<span class="string">'Got %d records from %s.arrival'</span>,numarrivals,dbpath));
0060         <span class="keyword">if</span> numarrivals &gt; 0
0061             ASSOC_TABLE_PRESENT = <a href="dbtable_present.html" class="code" title="function present=dbtable_present(dbpath, table)">dbtable_present</a>(dbpath, <span class="string">'assoc'</span>); 
0062             ORIGIN_TABLE_PRESENT = <a href="dbtable_present.html" class="code" title="function present=dbtable_present(dbpath, table)">dbtable_present</a>(dbpath, <span class="string">'origin'</span>); 
0063             EVENT_TABLE_PRESENT = <a href="dbtable_present.html" class="code" title="function present=dbtable_present(dbpath, table)">dbtable_present</a>(dbpath, <span class="string">'event'</span>);  
0064             
0065             <span class="keyword">if</span> (ASSOC_TABLE_PRESENT)              
0066                 <span class="comment">% open and join the assoc table</span>
0067                 db2 = dblookup_table( db , <span class="string">'assoc'</span>);
0068                 db = dbjoin(db, db2);
0069                 
0070                 <span class="keyword">if</span> dbnrecs(db) &gt; 0 &amp; (ORIGIN_TABLE_PRESENT)
0071                     <span class="comment">% open and join the origin table</span>
0072                     db3=dblookup_table( db, <span class="string">'origin'</span>);
0073                     db= dbjoin(db, db3);
0074                     
0075                     <span class="keyword">if</span> dbnrecs(db) &gt; 0 &amp; (EVENT_TABLE_PRESENT)
0076                         <span class="comment">% open and join the event table and subset for prefor</span>
0077                         db4=dblookup_table( db, <span class="string">'event'</span>);
0078                         db= dbjoin(db, db4);   
0079                         db = dbsubset(<span class="string">'origin.orid = event.prefor'</span>);
0080                     <span class="keyword">end</span>
0081                 <span class="keyword">end</span>
0082             <span class="keyword">end</span>
0083             <span class="keyword">if</span> exist(<span class="string">'subset_expr'</span>,<span class="string">'var'</span>)
0084                 db = dbsubset(db, subset_expr);
0085             <span class="keyword">end</span>
0086             
0087             <span class="keyword">if</span> dbnrecs(db)&gt;0
0088     
0089                 <span class="comment">% read (some) fields &amp; close db</span>
0090                 [a.sta, a.chan, a.time, a.phase, a.arid, a.amp, a.snr, a.deltim] = dbgetv(db, <span class="string">'sta'</span>, <span class="string">'chan'</span>, <span class="string">'arrival.time'</span>, <span class="string">'iphase'</span>, <span class="string">'arid'</span>, <span class="string">'amp'</span>, <span class="string">'snr'</span>, <span class="string">'deltim'</span>);
0091                 <span class="keyword">if</span> (ASSOC_TABLE_PRESENT)
0092                     [a.delta, a.seaz, a.esaz, a.timeres] = dbgetv(db, <span class="string">'assoc.delta'</span>, <span class="string">'assoc.seaz'</span>, <span class="string">'assoc.esaz'</span>, <span class="string">'assoc.timeres'</span>);
0093                 <span class="keyword">end</span>
0094                 <span class="keyword">if</span> (ORIGIN_TABLE_PRESENT)
0095                     [a.otime, a.orid, a.evid] = dbgetv(db, <span class="string">'origin.time'</span>, <span class="string">'origin.orid'</span>, <span class="string">'origin.evid'</span>);
0096                     a.traveltime = a.time - a.otime;
0097                 <span class="keyword">end</span>
0098  
0099                 dbclose(db);   
0100 
0101                 <span class="comment">% Cell arrays don't get created if only 1 row</span>
0102                 <span class="keyword">if</span> strcmp(class(a.sta),<span class="string">'char'</span>)
0103                    a.sta = {a.sta};
0104                    a.chan = {a.chan};
0105                    a.iphase = {a.iphase};
0106                 <span class="keyword">end</span>
0107 
0108                 <span class="comment">% Times are all in epoch</span>
0109                 a.time = <a href="../../../GISMO/libgismo/epoch2datenum.html" class="code" title="function time = epoch2datenum(epoch)">epoch2datenum</a>(a.time);
0110                 a.otime = <a href="../../../GISMO/libgismo/epoch2datenum.html" class="code" title="function time = epoch2datenum(epoch)">epoch2datenum</a>(a.otime);
0111 
0112                 <span class="comment">% Display counts</span>
0113                 fprintf(<span class="string">'\n%d arrivals\n'</span>,numel(a.time));
0114             <span class="keyword">end</span>
0115         <span class="keyword">end</span>
0116     <span class="keyword">end</span>
0117 
0118 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Wed 12-Oct-2016 17:36:30 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>