<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of xcorr</title>
  <meta name="keywords" content="xcorr">
  <meta name="description" content="xcorr   calculate the correlation and lag for traces">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../../index.html">Home</a> &gt;  <a href="../../../index.html">GISMO</a> &gt; <a href="#">core</a> &gt; <a href="#">dev</a> &gt; <a href="index.html">@NewCorrelation</a> &gt; xcorr.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../../index.html"><img alt="<" border="0" src="../../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for GISMO/core/dev/@NewCorrelation&nbsp;<img alt=">" border="0" src="../../../../right.png"></a></td></tr></table>-->

<h1>xcorr
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>xcorr   calculate the correlation and lag for traces</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>function c=xcorr(c,varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> xcorr   calculate the correlation and lag for traces
 C = XCORR(C)
 This function calculates and fills in the correlation and lag fields in a
 correlation object. The input is a correlation object, presumeably with
 empty correlation and lag fields. c.corrmatrix is a matrix of maximum correlation
 values normalized so that autocorrelations are 1. c.L is the lag time in
 between the two waveforms required for maximum correlation. To acheive
 maximum alignment, the value in position (i,j) should be added to the
 trigger time of trace j, or subtracted from trigger i. Traces can be
 aligned with the routine ADJUSTTRIG.

 By default, peak cross correlation values and lag times are NOT
 interpolated for sub-sample lag time because this requires a 30-40%
 increase in CPU time. For some uses, such as relative earthquake
 locations and coda wave interferometry, such precision is necessary. In
 these cases, consider the INTERP option below.

 C = XCORR(C,[PRETRIG POSTTRIG]);
 Perform cross correlation on a cropped portion of the data only. This is
 useful when you wish to keep the entire waveform but align the traces based on
 the correlation of a particular wavelet. PRETRIG and POSTTRIG are the
 time in seconds relative to the trigger time. Note that PRETRIG is
 negative for times before the trigger.

 C = XCORR(C,...,'1xr') Use single trace against one row algorithm
 (default).

 C = XCORR(C,...,'interp') Perform 2nd-order polynomial fitting to
 estimate sub-sample lag time. Sub-sample alignment requires an addition
 30-40% CPU time but results in highest precision lag times possible.

 C = XCORR(C,...,'row',INDEX) Run correlation only on the traces specified
 by INDEX. Each trace of INDEX is correlated against the entire set of
 waveforms. This is useful if a small number of traces has been added to a
 large correlation matrix. Insead of recomputing the entire correlation
 and lag matrices, the routine allows only the &quot;added&quot; lines to be filled
 in. The syntax is a bit clunky. This routine requires the 'row' algorithm
 and the INDEX list. The two must be used together. Polynomial
 interpolation of lag values is always used with this algorithm.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="../../../../GISMO/core/@Catalog/disp.html" class="code" title="function disp(obj, showall)">disp</a>	CATALOG.DISP Display Catalog object</li><li><a href="../../../../GISMO/core/@correlation/crop.html" class="code" title="function c = crop(c,varargin)">crop</a>	c = CROP(c,[PRETRIG POSTTRIG])</li><li><a href="../../../../GISMO/core/@datasource/disp.html" class="code" title="function disp(ds)">disp</a>	DISP Datasource disp overloaded operator</li><li><a href="../../../../GISMO/core/@filterobject/disp.html" class="code" title="function disp(f)">disp</a>	DISP - Filterobject disp overloaded operator</li><li><a href="../../../../GISMO/core/@scnlobject/disp.html" class="code" title="function disp(sncl)">disp</a>	DISP - scnl disp overloaded operator</li><li><a href="../../../../GISMO/core/@spectralobject/disp.html" class="code" title="function disp(s)">disp</a>	DISP - spectralobject disp overloaded operator</li><li><a href="../../../../GISMO/core/@threecomp/disp.html" class="code" title="function disp(TC)">disp</a>	DISP Display threecomp object</li><li><a href="../../../../GISMO/core/@threecomp/isempty.html" class="code" title="function TF = isempty(TC)">isempty</a>	ISEMPTY Display threecomp object</li><li><a href="../../../../GISMO/core/@waveform/disp.html" class="code" title="function disp(w)">disp</a>	DISP Waveform disp overloaded operator</li><li><a href="../../../../GISMO/core/@waveform/double.html" class="code" title="function n = double(W, option)">double</a>	DOUBLE returns a waveform's data as a double type</li><li><a href="../../../../GISMO/core/@waveform/isempty.html" class="code" title="function TF = isempty(w)">isempty</a>	ISEMPTY returns TRUE if waveform contains no data</li><li><a href="NewCorrelation.html" class="code" title="">NewCorrelation</a>	</li><li><a href="crop.html" class="code" title="function c = crop(c, pretrig, posttrig)">crop</a>	crop   crop all waveforms to a time window</li><li><a href="disp.html" class="code" title="function disp(c)">disp</a>	CORRELATION/DISPLAY Command window display of a correlation object</li><li><a href="../../../../GISMO/core/dev/@SeismicTrace/disp.html" class="code" title="function disp(T)">disp</a>	disp   Display information about SeismicTrace(s)</li><li><a href="../../../../GISMO/deprecated/@helicorder/disp.html" class="code" title="function disp(h)">disp</a>	DISP: Helicorder disp overloaded operator</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="../../../../GISMO/contributed_antelope/double_difference/dd_process_scp.html" class="code" title="function dd_process_scp(dbname,scpfile,varargin)">dd_process_scp</a>	DD_PROCESS_SCP Process correlations by station and channel</li><li><a href="../../../../GISMO/core/@correlation/cookbook.html" class="code" title="function correlationVariables = cookbook(corr)">cookbook</a>	% Correlation object cookbook</li><li><a href="../../../../GISMO/core/@correlation/interferogram.html" class="code" title="function [c,t,i,CC,LL] = interferogram(c,varargin)">interferogram</a>	C = INTERFEROGRAM(C)</li><li><a href="../../../../GISMO/core/@correlation/private/xcorr1x1.html" class="code" title="function d = xcorr1x1(d);">xcorr1x1</a>	This function is the same as xcwfm1xr except that it uses matlab's xcorr</li><li><a href="../../../../GISMO/core/@correlation/stack.html" class="code" title="function c = stack(c,varargin)">stack</a>	c = STACK(c)</li><li><a href="NewCorrelation.html" class="code" title="">NewCorrelation</a>	</li><li><a href="cookbook.html" class="code" title="function correlationVariables = cookbook(corr)">cookbook</a>	% Correlation object cookbook</li><li><a href="interferogram.html" class="code" title="function [c,t,i,CC,LL] = interferogram(c, width, timestep, masterIdx)">interferogram</a>	C = INTERFEROGRAM(C)</li><li><a href="stack.html" class="code" title="function c = stack(c,index)">stack</a>	c = STACK(c)</li><li><a href="xcorr1x1.html" class="code" title="function d = xcorr1x1(d)">xcorr1x1</a>	This function is the same as xcwfm1xr except that it uses matlab's xcorr</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function c=xcorr(c,varargin)</a>
0002    <span class="comment">% xcorr   calculate the correlation and lag for traces</span>
0003    <span class="comment">% C = XCORR(C)</span>
0004    <span class="comment">% This function calculates and fills in the correlation and lag fields in a</span>
0005    <span class="comment">% correlation object. The input is a correlation object, presumeably with</span>
0006    <span class="comment">% empty correlation and lag fields. c.corrmatrix is a matrix of maximum correlation</span>
0007    <span class="comment">% values normalized so that autocorrelations are 1. c.L is the lag time in</span>
0008    <span class="comment">% between the two waveforms required for maximum correlation. To acheive</span>
0009    <span class="comment">% maximum alignment, the value in position (i,j) should be added to the</span>
0010    <span class="comment">% trigger time of trace j, or subtracted from trigger i. Traces can be</span>
0011    <span class="comment">% aligned with the routine ADJUSTTRIG.</span>
0012    <span class="comment">%</span>
0013    <span class="comment">% By default, peak cross correlation values and lag times are NOT</span>
0014    <span class="comment">% interpolated for sub-sample lag time because this requires a 30-40%</span>
0015    <span class="comment">% increase in CPU time. For some uses, such as relative earthquake</span>
0016    <span class="comment">% locations and coda wave interferometry, such precision is necessary. In</span>
0017    <span class="comment">% these cases, consider the INTERP option below.</span>
0018    <span class="comment">%</span>
0019    <span class="comment">% C = XCORR(C,[PRETRIG POSTTRIG]);</span>
0020    <span class="comment">% Perform cross correlation on a cropped portion of the data only. This is</span>
0021    <span class="comment">% useful when you wish to keep the entire waveform but align the traces based on</span>
0022    <span class="comment">% the correlation of a particular wavelet. PRETRIG and POSTTRIG are the</span>
0023    <span class="comment">% time in seconds relative to the trigger time. Note that PRETRIG is</span>
0024    <span class="comment">% negative for times before the trigger.</span>
0025    <span class="comment">%</span>
0026    <span class="comment">% C = XCORR(C,...,'1xr') Use single trace against one row algorithm</span>
0027    <span class="comment">% (default).</span>
0028    <span class="comment">%</span>
0029    <span class="comment">% C = XCORR(C,...,'interp') Perform 2nd-order polynomial fitting to</span>
0030    <span class="comment">% estimate sub-sample lag time. Sub-sample alignment requires an addition</span>
0031    <span class="comment">% 30-40% CPU time but results in highest precision lag times possible.</span>
0032    <span class="comment">%</span>
0033    <span class="comment">% C = XCORR(C,...,'row',INDEX) Run correlation only on the traces specified</span>
0034    <span class="comment">% by INDEX. Each trace of INDEX is correlated against the entire set of</span>
0035    <span class="comment">% waveforms. This is useful if a small number of traces has been added to a</span>
0036    <span class="comment">% large correlation matrix. Insead of recomputing the entire correlation</span>
0037    <span class="comment">% and lag matrices, the routine allows only the &quot;added&quot; lines to be filled</span>
0038    <span class="comment">% in. The syntax is a bit clunky. This routine requires the 'row' algorithm</span>
0039    <span class="comment">% and the INDEX list. The two must be used together. Polynomial</span>
0040    <span class="comment">% interpolation of lag values is always used with this algorithm.</span>
0041 
0042    <span class="comment">% Author: Michael West, Geophysical Institute, Univ. of Alaska Fairbanks</span>
0043    <span class="comment">% $Date$</span>
0044    <span class="comment">% $Revision$</span>
0045    
0046    triggerRange = [];
0047    algorithm = <span class="string">'1xr'</span>;
0048    <span class="keyword">switch</span> nargin
0049       <span class="keyword">case</span> 1 <span class="comment">% xcorr(C) :  default behavior</span>
0050          <span class="comment">%algorithm = '1xr';</span>
0051       <span class="keyword">case</span> 2 <span class="comment">% xcorr(C, [pretrig posttrig])</span>
0052          <span class="comment">%algorithm = '1xr';</span>
0053          triggerRange = varargin{1};
0054       <span class="keyword">case</span> 3 <span class="comment">% xcorr(C, [pretrig posttrig], algorithm)</span>
0055          <span class="keyword">if</span> isnumeric(varargin{1}) 
0056             <span class="comment">% xcorr(C, [pretrig posttrig], algorithm)</span>
0057             triggerRange = varargin{1};
0058             algorithm = varargin{2};
0059          <span class="keyword">else</span>
0060             <span class="comment">% xcorr(C, 'row', indexList)</span>
0061             algorithm = varargin{1}; 
0062             index = varargin{2};
0063          <span class="keyword">end</span>
0064       <span class="keyword">case</span> 4 <span class="comment">% xcorr(C, [pretrig posttrig], 'row', indexList)</span>
0065          triggerRange = varargin{1};
0066          algorithm = varargin{2};
0067          index = varargin{3};
0068       <span class="keyword">otherwise</span>
0069          error(<span class="string">'xcorr paramters not understood'</span>);
0070    <span class="keyword">end</span>
0071    
0072    c1 = <a href="NewCorrelation.html" class="code" title="">NewCorrelation</a>(c.traces, c.trig);
0073    <span class="keyword">if</span> ~<a href="../../../../GISMO/core/@threecomp/isempty.html" class="code" title="function TF = isempty(TC)">isempty</a>(triggerRange)
0074       assert(numel(triggerRange)==2, <span class="string">'triggerRange needs to be two numbers: [pretrig, posttrig]'</span>);
0075       c1 = <a href="crop.html" class="code" title="function c = crop(c, pretrig, posttrig)">crop</a>(c1, triggerRange(1), triggerRange(2));
0076    <span class="keyword">end</span>
0077    
0078    
0079    <span class="comment">% CREATE MATRIX OF DATA FROM WAVEFORM ARRAY</span>
0080    <span class="comment">% The correlation object is modified here into a Matlab structure that</span>
0081    <span class="comment">% shares similar fields to the object except that the the trace data is</span>
0082    <span class="comment">% stored in a matrix instead of in a waveform object. This structure is</span>
0083    <span class="comment">% passed to the correlation subroutines as 'd'. The matrix structure</span>
0084    <span class="comment">% improves computation speed because fft and other routines are optomized</span>
0085    <span class="comment">% for matrices. This structure is based on the correlation object version</span>
0086    <span class="comment">% 0.</span>
0087    d.start = c1.traces.firstsampletime();
0088    d.Fs    = c1.traces(1).samplerate();
0089    d.trig  = c1.trig;
0090    d.w = <a href="../../../../GISMO/core/@waveform/double.html" class="code" title="function n = double(W, option)">double</a>(c1.traces);
0091    clear c1
0092    
0093    
0094    <span class="comment">% EXECUTE CROSS CORRELATION</span>
0095    <span class="keyword">if</span> exist(<span class="string">'pretrig'</span>,<span class="string">'var'</span>) &amp;&amp; exist(<span class="string">'posttrig'</span>,<span class="string">'var'</span>)
0096       <a href="disp.html" class="code" title="function disp(c)">disp</a>([<span class="string">'using '</span> algorithm <span class="string">' algorithm on the time interval ['</span> num2str(pretrig) <span class="string">' '</span> num2str(posttrig) <span class="string">'] ...'</span> ]);
0097    <span class="keyword">end</span>
0098    
0099    <span class="comment">%because we're passing struct instead of object, these are now static</span>
0100    <span class="keyword">switch</span> algorithm
0101       <span class="keyword">case</span> <span class="string">'1xr'</span>
0102          d = NewCorrelation.xcorr1xr(d,0);
0103       <span class="keyword">case</span> {<span class="string">'int'</span>}
0104          error(<span class="string">'NewCorrelation:xcorr:oldusage'</span>,<span class="keyword">...</span>
0105             <span class="string">'use ''interp'' instead of ''int'''</span>);
0106       <span class="keyword">case</span> <span class="string">'interp'</span>
0107          d = NewCorrelation.xcorr1xr(d,1);
0108       <span class="keyword">case</span> <span class="string">'row'</span>
0109           assert(exist(<span class="string">'index'</span>,<span class="string">'var'</span>), <span class="string">'algorithm ''row'' requires an index parameter'</span>);
0110           d = NewCorrelation.xcorrrow(d,c,index);
0111       <span class="keyword">otherwise</span>
0112          error(<span class="string">'Correlation algorithm not recognized'</span>);
0113    <span class="keyword">end</span> 
0114    
0115    <span class="comment">% ASSIGN CORRELATION PARAMETERS TO ORIGINAL DATA</span>
0116    c.corrmatrix = d.corrmatrix;
0117    c.lags = d.lags;
0118 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Wed 12-Oct-2016 17:36:30 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>