<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of ChannelDetails</title>
  <meta name="keywords" content="ChannelDetails">
  <meta name="description" content="">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../../index.html">Home</a> &gt;  <a href="../../../index.html">GISMO</a> &gt; <a href="#">core</a> &gt; <a href="#">dev</a> &gt; <a href="index.html">@ChannelDetails</a> &gt; ChannelDetails.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../../index.html"><img alt="<" border="0" src="../../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for GISMO/core/dev/@ChannelDetails&nbsp;<img alt=">" border="0" src="../../../../right.png"></a></td></tr></table>-->

<h1>ChannelDetails
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong></strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>This is a script file. </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="../../../../GISMO/core/@Catalog/disp.html" class="code" title="function disp(obj, showall)">disp</a>	CATALOG.DISP Display Catalog object</li><li><a href="../../../../GISMO/core/@Catalog/plot3.html" class="code" title="function plot3(catalogObject, varargin)">plot3</a>	CATALOG.PLOT3 Plot hypocenters in 3-D</li><li><a href="../../../../GISMO/core/@ChannelTag/ChannelTag.html" class="code" title="">ChannelTag</a>	</li><li><a href="../../../../GISMO/core/@correlation/find.html" class="code" title="function index = find(c,varargin)">find</a>	INDEX = FIND(c,'CLUST',WHICH_CLUSTER)</li><li><a href="../../../../GISMO/core/@correlation/set.html" class="code" title="function c = set(c, prop_name, val)">set</a>	SET Set properties for correlation object</li><li><a href="../../../../GISMO/core/@datasource/disp.html" class="code" title="function disp(ds)">disp</a>	DISP Datasource disp overloaded operator</li><li><a href="../../../../GISMO/core/@drumplot/set.html" class="code" title="function h = set(h,varargin)">set</a>	SET: Set drumplot properties</li><li><a href="../../../../GISMO/core/@filterobject/disp.html" class="code" title="function disp(f)">disp</a>	DISP - Filterobject disp overloaded operator</li><li><a href="../../../../GISMO/core/@filterobject/set.html" class="code" title="function f = set(f, varargin)">set</a>	SET - Set filterobject properties</li><li><a href="../../../../GISMO/core/@scnlobject/ChannelTag.html" class="code" title="function ct = ChannelTag(scnl)">ChannelTag</a>	ChannelTag Converter from scnlobject to ChannelTag</li><li><a href="../../../../GISMO/core/@scnlobject/disp.html" class="code" title="function disp(sncl)">disp</a>	DISP - scnl disp overloaded operator</li><li><a href="../../../../GISMO/core/@scnlobject/ismember.html" class="code" title="function [results, loc] = ismember(A,B)">ismember</a>	ISMEMBER for scnlobjects</li><li><a href="../../../../GISMO/core/@scnlobject/set.html" class="code" title="function scnl = set(scnl, varargin)">set</a>	SET - Set properties for scnlobject</li><li><a href="../../../../GISMO/core/@spectralobject/disp.html" class="code" title="function disp(s)">disp</a>	DISP - spectralobject disp overloaded operator</li><li><a href="../../../../GISMO/core/@spectralobject/set.html" class="code" title="function s = set(s, varargin)">set</a>	SET - Set properties for spectralobject</li><li><a href="../../../../GISMO/core/@threecomp/disp.html" class="code" title="function disp(TC)">disp</a>	DISP Display threecomp object</li><li><a href="../../../../GISMO/core/@threecomp/isempty.html" class="code" title="function TF = isempty(TC)">isempty</a>	ISEMPTY Display threecomp object</li><li><a href="../../../../GISMO/core/@threecomp/plot3.html" class="code" title="function plot3(TC)">plot3</a>	PLOT3 Interactively make 3D plot of particle motion vector evolution</li><li><a href="../../../../GISMO/core/@threecomp/set.html" class="code" title="function TC = set(TC, fieldName, val)">set</a>	SET inserts properties for threecomp object</li><li><a href="../../../../GISMO/core/@waveform/disp.html" class="code" title="function disp(w)">disp</a>	DISP Waveform disp overloaded operator</li><li><a href="../../../../GISMO/core/@waveform/isempty.html" class="code" title="function TF = isempty(w)">isempty</a>	ISEMPTY returns TRUE if waveform contains no data</li><li><a href="../../../../GISMO/core/@waveform/ismember.html" class="code" title="function [results, loc] = ismember(mywave,anythingelse)">ismember</a>	ISMEMBER waveform implementation of ismember</li><li><a href="../../../../GISMO/core/@waveform/set.html" class="code" title="function w = set(w, varargin)">set</a>	SET Set properties for waveform object(s)</li><li><a href="ChannelDetails.html" class="code" title="">ChannelDetails</a>	</li><li><a href="../../../../GISMO/core/dev/@NewCorrelation/disp.html" class="code" title="function disp(c)">disp</a>	CORRELATION/DISPLAY Command window display of a correlation object</li><li><a href="../../../../GISMO/core/dev/@NewCorrelation/find.html" class="code" title="function index = find(c, type, value)">find</a>	INDEX = FIND(c,'CLUST',WHICH_CLUSTER)</li><li><a href="../../../../GISMO/core/dev/@NewCorrelation/set.html" class="code" title="function c = set(c, prop_name, val)">set</a>	SET Set properties for correlation object</li><li><a href="../../../../GISMO/core/dev/@SeismicTrace/disp.html" class="code" title="function disp(T)">disp</a>	disp   Display information about SeismicTrace(s)</li><li><a href="../../../../GISMO/deprecated/@helicorder/disp.html" class="code" title="function disp(h)">disp</a>	DISP: Helicorder disp overloaded operator</li><li><a href="../../../../GISMO/deprecated/@helicorder/set.html" class="code" title="function h = set(h,varargin)">set</a>	SET: Set helicorder properties</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="ChannelDetails.html" class="code" title="">ChannelDetails</a>	</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function N = get.network(obj)</a></li><li><a href="#_sub2" class="code">function obj = set.network(obj, val)</a></li><li><a href="#_sub3" class="code">function S = get.station(obj)</a></li><li><a href="#_sub4" class="code">function obj = set.station(obj, val)</a></li><li><a href="#_sub5" class="code">function L = get.location(obj)</a></li><li><a href="#_sub6" class="code">function obj = set.location(obj, val)</a></li><li><a href="#_sub7" class="code">function C = get.channel(obj)</a></li><li><a href="#_sub8" class="code">function obj = set.channel(obj, val)</a></li><li><a href="#_sub9" class="code">function S = get.name(obj)</a></li><li><a href="#_sub10" class="code">function C = getbyname(obj,val)</a></li><li><a href="#_sub11" class="code">function LL = get.latlon(obj)</a></li><li><a href="#_sub12" class="code">function obj = set.latlon(obj, LL)</a></li><li><a href="#_sub13" class="code">function LL = latlons(obj)</a></li><li><a href="#_sub14" class="code">function [hSta, hLine,nameList] = sphereplot(obj)</a></li><li><a href="#_sub15" class="code">function chdeets = retrieve(ds,varargin)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre>0001 classdef <a href="ChannelDetails.html" class="code" title="">ChannelDetails</a>
0002    <span class="comment">%ChannelDetails Handles station metadata information</span>
0003    <span class="comment">%   Access fields as though this were a struct</span>
0004    <span class="comment">%</span>
0005    <span class="comment">%  Request data using</span>
0006    <span class="comment">%  ChannelDetails.retrieve([], ...) retrieve data from default source:</span>
0007    <span class="comment">%    https://service.iris.edu/fdsnws/station/1/</span>
0008    <span class="comment">%  What follows are parameter-value pairs that filter which data is</span>
0009    <span class="comment">%  retrieved.  These are described in detail from the iris website</span>
0010    <span class="comment">%   &lt;a href&gt;https://service.iris.edu/fdsnws/station/1/&lt;/a&gt;</span>
0011    <span class="comment">%</span>
0012    <span class="comment">%  Examples:</span>
0013    <span class="comment">%    Ex 1. Retrieve all stations that start with A, for network IU. But</span>
0014    <span class="comment">%    only the BH channels (excluding BHZ)</span>
0015    <span class="comment">%    ChannelDetails.retrieve([],'station','A*','network','IU','channel','BH?,-BHZ')</span>
0016    <span class="comment">%</span>
0017    <span class="comment">%    Ex 2. Retrieve channel detail for a SeismicTrace</span>
0018    <span class="comment">%    T = SeismicTrace; T.name = 'IU.ANMO.00.BHZ'; T.starttime = now-1;</span>
0019    <span class="comment">%    ChannelDetails.retrieve([],T);</span>
0020    <span class="comment">%</span>
0021    <span class="comment">%    Ex 3. Retrieve channel detail for ChannelTag (all channels)</span>
0022    <span class="comment">%    ct = ChannelTag('IU.ANMO.00..');</span>
0023    <span class="comment">%    ChannelDetails.retreive([],ct); % results returned in a</span>
0024    <span class="comment">%</span>
0025    <span class="comment">%    Results are in an 1XN ChannelDetails object</span>
0026    
0027    <span class="comment">% NOTE: Starting in r2014b matlab has WEBREAD to access data from</span>
0028    <span class="comment">% restful services.  We could use that with weboptions to provide useful</span>
0029    <span class="comment">% information to the service. (such as type of data requested, useragent,</span>
0030    <span class="comment">% and for restricted data, a username &amp; password pair.</span>
0031    
0032    properties(Dependent)
0033       name
0034       network
0035       station
0036       location
0037       channel
0038    <span class="keyword">end</span>
0039    
0040    properties
0041       channelinfo
0042       latitude
0043       longitude
0044       elevation
0045       depth
0046       azimuth
0047       dip
0048       sensordescription
0049       scale
0050       scalefreq
0051       scaleunits
0052       samplerate
0053       starttime
0054       endtime
0055    <span class="keyword">end</span>
0056    
0057    properties(Dependent, Hidden)
0058       latlon
0059       latlonelev
0060    <span class="keyword">end</span>
0061    
0062    methods
0063       <span class="comment">%% get/set of channel-related data</span>
0064       <a name="_sub0" href="#_subfunctions" class="code">function N = get.network(obj)</a>
0065          N = obj.channelinfo.network;
0066       <span class="keyword">end</span>
0067       <a name="_sub1" href="#_subfunctions" class="code">function obj = set.network(obj, val)</a>
0068          obj.channelinfo.network = val;
0069       <span class="keyword">end</span>
0070       
0071       <a name="_sub2" href="#_subfunctions" class="code">function S = get.station(obj)</a>
0072          S = obj.channelinfo.station;
0073       <span class="keyword">end</span>
0074       <a name="_sub3" href="#_subfunctions" class="code">function obj = set.station(obj, val)</a>
0075          obj.channelinfo.station = val;
0076       <span class="keyword">end</span>
0077       
0078       <a name="_sub4" href="#_subfunctions" class="code">function L = get.location(obj)</a>
0079          L = obj.channelinfo.location;
0080       <span class="keyword">end</span>
0081       <a name="_sub5" href="#_subfunctions" class="code">function obj = set.location(obj, val)</a>
0082          obj.channelinfo.location = val;
0083       <span class="keyword">end</span>
0084       
0085       <a name="_sub6" href="#_subfunctions" class="code">function C = get.channel(obj)</a>
0086          C = obj.channelinfo.channel;
0087       <span class="keyword">end</span>
0088       <a name="_sub7" href="#_subfunctions" class="code">function obj = set.channel(obj, val)</a>
0089          obj.channelinfo.channel = val;
0090       <span class="keyword">end</span>
0091       
0092       <a name="_sub8" href="#_subfunctions" class="code">function S = get.name(obj)</a>
0093          S = obj.channelinfo.string;
0094       <span class="keyword">end</span>
0095       <a name="_sub9" href="#_subfunctions" class="code">function C = getbyname(obj,val)</a>
0096          <span class="comment">% getbyname does not know wildcards!</span>
0097          <span class="comment">% retrieves values that match requeste Net.Sta.Loc.Cha name</span>
0098          <span class="comment">% ex.</span>
0099          <span class="comment">% chandeets.getbyname('IU.ANMO.00.BH1')</span>
0100          C = obj(strcmp({obj.name},val));
0101       <span class="keyword">end</span>
0102       <a name="_sub10" href="#_subfunctions" class="code">function LL = get.latlon(obj)</a>
0103          <span class="comment">% handles single lat/lon combination</span>
0104          LL = [obj.latitude, obj.longitude];
0105       <span class="keyword">end</span>
0106       <a name="_sub11" href="#_subfunctions" class="code">function obj = set.latlon(obj, LL)</a>
0107          <span class="comment">% handles single lat/lon combination</span>
0108          <span class="comment">%does no reality checks</span>
0109          assert(numel(LL) == 2);
0110          obj.latitude = LL(1);
0111          obj.longitude = LL(2);
0112       <span class="keyword">end</span>
0113      <a name="_sub12" href="#_subfunctions" class="code">function LL = latlons(obj)</a>
0114         <span class="comment">% can handle multiple latitudes &amp; longitudes</span>
0115          LL = [[obj.latitude]' [obj.longitude]'];
0116      <span class="keyword">end</span>
0117      
0118      <a name="_sub13" href="#_subfunctions" class="code">function [hSta, hLine,nameList] = sphereplot(obj)</a>
0119         <span class="comment">% sphereplot plots the stations on a sphere that represents the</span>
0120         <span class="comment">% earth.</span>
0121         <span class="comment">%</span>
0122         <span class="comment">% example:</span>
0123         <span class="comment">% % grab all BHZ stations in iris catalog, then plot</span>
0124         <span class="comment">% chandeets = ChannelDetails.retrieve([],'channel','BHZ','endafter',datenum(2015,1,1));</span>
0125         <span class="comment">% chandeets.sphereplot;</span>
0126         <span class="comment">%</span>
0127         <span class="comment">% TODO: add color or symbol per object?</span>
0128         [sphx,sphy,sphz] = sphere(36);
0129         s=surf(sphx,sphy,sphz,<span class="string">'FaceAlpha'</span>,0.7,<span class="string">'edgecolor'</span>,[0.85 0.85 0.85],<span class="string">'FaceColor'</span>,[1, 1, 1]);
0130         
0131         deg2rad = @(x) (pi / 180) .* x;
0132         LatLon = deg2rad(obj.latlons);
0133         [x,y,z] = sph2cart(LatLon(:,2), LatLon(:,1),1.05);
0134         <a href="../../../../GISMO/core/@correlation/set.html" class="code" title="function c = set(c, prop_name, val)">set</a>(gca,<span class="string">'ytick'</span>,[],<span class="string">'xtick'</span>,[],<span class="string">'ztick'</span>,[]);
0135         hold on;
0136         hSta = scatter3(x,y,z,[],<span class="string">'b'</span>,<span class="string">'filled'</span>); <span class="comment">%allows recoloring individually</span>
0137         [x2,y2,z2] = sph2cart(LatLon(:,2), LatLon(:,1),1.0);
0138         hLine = <a href="../../../../GISMO/core/@Catalog/plot3.html" class="code" title="function plot3(catalogObject, varargin)">plot3</a>([x,x2]',[y,y2]',[z,z2]',<span class="string">'k-'</span>); <span class="comment">%plot dashes above</span>
0139         hold off
0140         axis equal
0141         axis vis3d
0142         grid off
0143         nameList = {obj.name};
0144      <span class="keyword">end</span>
0145    <span class="keyword">end</span>
0146    methods(Static)
0147       <a name="_sub14" href="#_subfunctions" class="code">function chdeets = retrieve(ds,varargin)</a>
0148          <span class="comment">% get from fdsnws station service</span>
0149          <span class="comment">% ds not used (yet)</span>
0150          <span class="keyword">if</span> numel(varargin) == 1
0151             <span class="keyword">switch</span>(class(varargin{1}))
0152                <span class="keyword">case</span> <span class="string">'char'</span>
0153                   chdeets = ChannelDetails.retrieve(ds,<a href="../../../../GISMO/core/@ChannelTag/ChannelTag.html" class="code" title="">ChannelTag</a>(varargin{1}));
0154                   <span class="keyword">return</span>
0155                <span class="keyword">case</span> {<span class="string">'SeismicTrace'</span>}
0156                   <span class="keyword">for</span> n=numel(varargin{1}):-1:1
0157                      me = varargin{1}(n);
0158                      ch = ChannelDetails.retrieve(ds,<span class="keyword">...</span>
0159                         <span class="string">'network'</span>,me.network, <span class="string">'station'</span>, me.station, <span class="keyword">...</span>
0160                         <span class="string">'location'</span>, me.location, <span class="string">'channel'</span>, me.channel, <span class="keyword">...</span>
0161                         <span class="string">'starttime'</span>, me.firstsampletime, <span class="string">'endtime'</span>, me.lastsampletime);
0162                      <span class="keyword">if</span> numel(ch) &gt; 1
0163                         warning(<span class="string">'Found multiple epochs for %s channel. only Keeping last one'</span>, me.name);
0164                      <span class="keyword">end</span>
0165                      chdeets(n) = ch(end);
0166                   <span class="keyword">end</span>
0167                   chdeets = reshape(chdeets, size(varargin{1}));
0168                   <span class="keyword">return</span>
0169                <span class="keyword">case</span> <span class="string">'ChannelTag'</span>
0170                   <span class="comment">% return as cell, because we can't be sure how many are</span>
0171                   <span class="comment">% returned!</span>
0172                   <span class="keyword">if</span> numel(varargin{1}) == 1
0173                      me = varargin{1};
0174                      chdeets = ChannelDetails.retrieve(ds, <span class="keyword">...</span>
0175                         <span class="string">'network'</span>,me.network, <span class="string">'station'</span>, me.station, <span class="keyword">...</span>
0176                         <span class="string">'location'</span>, me.location, <span class="string">'channel'</span>, me.channel);
0177                   <span class="keyword">else</span>
0178                      <span class="keyword">for</span> n=numel(varargin{1}):-1:1
0179                         me = varargin{1}(n);
0180                         chdeets(n) = { ChannelDetails.retrieve(ds, <span class="keyword">...</span>
0181                            <span class="string">'network'</span>,me.network, <span class="string">'station'</span>, me.station, <span class="keyword">...</span>
0182                            <span class="string">'location'</span>, me.location, <span class="string">'channel'</span>, me.channel)};
0183                      <span class="keyword">end</span>
0184                      chdeets = reshape(chdeets, size(varargin{1}));
0185                   <span class="keyword">end</span>
0186                   <span class="keyword">return</span>
0187                <span class="keyword">otherwise</span>
0188                   error(<span class="string">'Unknown usage'</span>);
0189             <span class="keyword">end</span>
0190          <span class="keyword">end</span>
0191          p = inputParser;
0192          p.addOptional(<span class="string">'network'</span>,<span class="string">''</span>);
0193          p.addOptional(<span class="string">'station'</span>,<span class="string">''</span>);
0194          p.addOptional(<span class="string">'channel'</span>,<span class="string">''</span>);
0195          p.addOptional(<span class="string">'location'</span>,<span class="string">''</span>);
0196          p.addOptional(<span class="string">'starttime'</span>,[]);
0197          p.addOptional(<span class="string">'endtime'</span>,[]);
0198          p.addOptional(<span class="string">'startbefore'</span>,[]);
0199          p.addOptional(<span class="string">'startafter'</span>,[]);
0200          p.addOptional(<span class="string">'endbefore'</span>,[]);
0201          p.addOptional(<span class="string">'endafter'</span>,[]);
0202          p.addOptional(<span class="string">'minlat'</span>,[]);
0203          p.addOptional(<span class="string">'maxlat'</span>,[]);
0204          p.addOptional(<span class="string">'minlon'</span>,[]);
0205          p.addOptional(<span class="string">'maxlon'</span>,[]);
0206          p.addOptional(<span class="string">'lat'</span>,[])
0207          p.addOptional(<span class="string">'lon'</span>,[]);
0208          p.addOptional(<span class="string">'maxradius'</span>,[]);
0209          p.addOptional(<span class="string">'minradius'</span>,[]);
0210          p.addOptional(<span class="string">'sensor'</span>,[]);
0211          p.addOptional(<span class="string">'includerestricted'</span>,<span class="string">''</span>);
0212          p.addOptional(<span class="string">'includeavailability'</span>,<span class="string">''</span>);
0213          p.addOptional(<span class="string">'updatedafter'</span>,<span class="string">''</span>);
0214          p.addOptional(<span class="string">'matchtimeseries'</span>,<span class="string">''</span>);
0215          p.parse(varargin{:})
0216          R = p.Results;
0217          fn = fieldnames(R);
0218          urlstr = <span class="string">'https://service.iris.edu/fdsnws/station/1/query?format=text&amp;level=channel'</span>;
0219          <span class="keyword">for</span> n=1:numel(fn) <span class="comment">% make sure we keep only active fields</span>
0220             f = fn{n}; v = R.(f);
0221             <span class="keyword">if</span> <a href="../../../../GISMO/core/@threecomp/isempty.html" class="code" title="function TF = isempty(TC)">isempty</a>(v)
0222                R = rmfield(R,f);
0223             <span class="keyword">else</span>
0224                <span class="keyword">switch</span>(f)
0225                   <span class="keyword">case</span> {<span class="string">'network'</span>,<span class="string">'channel'</span>,<span class="string">'location'</span>,<span class="string">'station'</span>}
0226                      <span class="comment">% all strings, nothing to do</span>
0227                   <span class="keyword">case</span> {<span class="string">'starttime'</span>,<span class="string">'endtime'</span>,<span class="keyword">...</span>
0228                         <span class="string">'startbefore'</span>,<span class="string">'endbefore'</span>,<span class="keyword">...</span>
0229                         <span class="string">'startafter'</span>,<span class="string">'endafter'</span>,<span class="keyword">...</span>
0230                         <span class="string">'updatedafter'</span>}
0231                      <span class="keyword">if</span> ischar(v)
0232                         R.(f) = datestr(datenum(v),31);
0233                      <span class="keyword">elseif</span> isnumeric(v)
0234                         <span class="comment">%datenum</span>
0235                         R.(f) = datestr(v,31);
0236                      <span class="keyword">end</span>
0237                      R.(f) = strrep(R.(f),<span class="string">' '</span>,<span class="string">'T'</span>);
0238                      <span class="comment">% all dates. further process</span>
0239                   <span class="keyword">case</span> {<span class="string">'lat'</span>, <span class="string">'lon'</span>, <span class="string">'maxradius'</span>, <span class="string">'minradius'</span>}
0240                      assert(~any(<a href="../../../../GISMO/core/@scnlobject/ismember.html" class="code" title="function [results, loc] = ismember(A,B)">ismember</a>({<span class="string">'minlat'</span>,<span class="string">'maxlat'</span>,<span class="string">'minlon'</span>,<span class="string">'maxlon'</span>},fn)),<span class="keyword">...</span>
0241                         <span class="string">'cannot describe with lat/lon and min/max lat/lon'</span>);
0242                      R.(f) = num2str(v);
0243                   <span class="keyword">case</span> {<span class="string">'minlat'</span>,<span class="string">'maxlat'</span>,<span class="string">'minlon'</span>,<span class="string">'maxlon'</span>}
0244                      R.(f) = num2str(v);
0245                   <span class="keyword">case</span> {<span class="string">'includerestricted'</span>, <span class="string">'includeavailability'</span>, <span class="string">'matchtimeseries'</span>}
0246                      <span class="comment">% translate into 'TRUE' and 'FALSE'</span>
0247                <span class="keyword">end</span>
0248             <span class="keyword">end</span>
0249          <span class="keyword">end</span>
0250          fnames = fieldnames(R);
0251          <span class="keyword">for</span> n=1:numel(fnames)
0252             name = fnames{n};
0253             val = R.(name);
0254             urlstr = [urlstr, <span class="string">'&amp;'</span>, name, <span class="string">'='</span>, val];
0255          <span class="keyword">end</span>
0256          <a href="../../../../GISMO/core/@Catalog/disp.html" class="code" title="function disp(obj, showall)">disp</a>(urlstr)
0257          chdeets = urlread(urlstr);
0258          labels = textscan(chdeets,<span class="string">'%s %s %s %s %s %s %s %s %s %s %s %s %s %s %s %s %s'</span>,1,<span class="string">'delimiter'</span>,<span class="string">'|'</span>);
0259          labels=[labels{:}];
0260          labels(1) = {labels{1}(2:end)}; <span class="comment">%first label starts with #;</span>
0261          labels = lower(strtrim(labels));
0262          C = textscan(chdeets,<span class="string">'%s %s %s %s %f %f %f %f %f %f %s %f %f %s %f %s %s'</span>,<span class="string">'delimiter'</span>,<span class="string">'|'</span>,<span class="string">'commentstyle'</span>,<span class="string">'#'</span>);
0263          
0264          <span class="comment">% convert station network channel location to channeltags and clean</span>
0265          chanTags = <a href="../../../../GISMO/core/@ChannelTag/ChannelTag.html" class="code" title="">ChannelTag</a>(strcat(<span class="keyword">...</span>
0266             C{strcmp(labels,<span class="string">'network'</span>)},<span class="string">'.'</span>,<span class="keyword">...</span>
0267             C{strcmp(labels,<span class="string">'station'</span>)},<span class="string">'.'</span>,<span class="keyword">...</span>
0268             C{strcmp(labels,<span class="string">'location'</span>)},<span class="string">'.'</span>,<span class="keyword">...</span>
0269             C{strcmp(labels,<span class="string">'channel'</span>)}));
0270          C{1} = chanTags; C(2:4) = [];
0271          labels{1} = <span class="string">'channelinfo'</span>; labels(2:4)=[];
0272          <span class="comment">% clean up time fields, and convert</span>
0273          timefields = <a href="../../../../GISMO/core/@correlation/find.html" class="code" title="function index = find(c,varargin)">find</a>(<a href="../../../../GISMO/core/@scnlobject/ismember.html" class="code" title="function [results, loc] = ismember(A,B)">ismember</a>(labels,{<span class="string">'starttime'</span>,<span class="string">'endtime'</span>}));
0274          <span class="keyword">for</span> n=timefields
0275             C{n} = datenum(strrep(C{n},<span class="string">'T'</span>,<span class="string">' '</span>));
0276          <span class="keyword">end</span>
0277          <span class="comment">% parse it</span>
0278          clear chdeets
0279          <span class="keyword">for</span> n=1:numel(chanTags)
0280             chdeets(n) = <a href="ChannelDetails.html" class="code" title="">ChannelDetails</a>;
0281             <span class="keyword">for</span> x = 1 : numel(labels);
0282                fn = labels{x};
0283                <span class="keyword">if</span> iscell(C{x})
0284                   thisval = C{x}{n};
0285                <span class="keyword">else</span>
0286                   thisval = C{x}(n);
0287                <span class="keyword">end</span>
0288                chdeets(n).(fn) = thisval;
0289             <span class="keyword">end</span>
0290          <span class="keyword">end</span>
0291       <span class="keyword">end</span>
0292    <span class="keyword">end</span>
0293    
0294 <span class="keyword">end</span>
0295</pre></div>
<hr><address>Generated on Wed 12-Oct-2016 17:36:30 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>