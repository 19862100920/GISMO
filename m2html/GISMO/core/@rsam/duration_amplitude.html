<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of duration_amplitude</title>
  <meta name="keywords" content="duration_amplitude">
  <meta name="description" content="DURATION_AMPLITUDE Use the duration-amplitde">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="../../index.html">GISMO</a> &gt; <a href="#">core</a> &gt; <a href="index.html">@rsam</a> &gt; duration_amplitude.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for GISMO/core/@rsam&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>duration_amplitude
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>DURATION_AMPLITUDE Use the duration-amplitde</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function [lambda, r2] = duration_amplitude(self, law, min_amplitude, mag_zone) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">DURATION_AMPLITUDE Use the duration-amplitde
Compute the fraction of a data series above each
amplitude level, plot the duration vs amplitude data, and then
allow user input to fit a regression line.
   rsamObject.duration_amplitude(law, min_amplitude)
   
   Inputs: 
       law = 'exponential' or 'power'
       min_amplitude = (Optional) the smallest amplitude to use on
       the x-axis. Otherwise will be 10^10 times smallest than the
       largest amplitude.

   Outputs:
       (None) A graph is plotted, the user clicks two points, and
       from that slope, the characteristic amplitude is computed
       and shown on the screen.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../GISMO/core/@Catalog/disp.html" class="code" title="function disp(obj, showall)">disp</a>	CATALOG.DISP Display Catalog object</li><li><a href="../../../GISMO/core/@Catalog/plot.html" class="code" title="function plot(catalogObject, varargin)">plot</a>	CATALOG.PLOT Plot hypocenters in map view and cross-sections</li><li><a href="../../../GISMO/core/@correlation/find.html" class="code" title="function index = find(c,varargin)">find</a>	INDEX = FIND(c,'CLUST',WHICH_CLUSTER)</li><li><a href="../../../GISMO/core/@correlation/get.html" class="code" title="function val = get(c,prop_name)">get</a>	GET - Get correlation properties</li><li><a href="../../../GISMO/core/@correlation/plot.html" class="code" title="function plot(c,varargin)">plot</a>	PLOT(C) plots waveforms stored in a correlation object. Traces are</li><li><a href="../../../GISMO/core/@datasource/disp.html" class="code" title="function disp(ds)">disp</a>	DISP Datasource disp overloaded operator</li><li><a href="../../../GISMO/core/@datasource/get.html" class="code" title="function val = get(ds, propertyname)">get</a>	</li><li><a href="../../../GISMO/core/@drumplot/get.html" class="code" title="function val = get(h,prop_name)">get</a>	GET: Get drumplot properties</li><li><a href="../../../GISMO/core/@drumplot/plot.html" class="code" title="function varargout = plot(h)">plot</a>	PLOT: Drumplot plotting function. A drumplot object (h) contains no</li><li><a href="../../../GISMO/core/@filterobject/disp.html" class="code" title="function disp(f)">disp</a>	DISP - Filterobject disp overloaded operator</li><li><a href="../../../GISMO/core/@filterobject/get.html" class="code" title="function val = get(f, prop_name)">get</a>	GET - Get filterobject properties</li><li><a href="plot.html" class="code" title="function handlePlot = plot(rsam_vector, varargin)">plot</a>	RSAM/PLOT plot rsam data</li><li><a href="../../../GISMO/core/@scnlobject/disp.html" class="code" title="function disp(sncl)">disp</a>	DISP - scnl disp overloaded operator</li><li><a href="../../../GISMO/core/@scnlobject/get.html" class="code" title="function stuff = get(scnl, prop_name)">get</a>	GET for the scnl object</li><li><a href="../../../GISMO/core/@spectralobject/disp.html" class="code" title="function disp(s)">disp</a>	DISP - spectralobject disp overloaded operator</li><li><a href="../../../GISMO/core/@spectralobject/get.html" class="code" title="function out = get(s, prop_name)">get</a>	GET - Get properties for spectralobject</li><li><a href="../../../GISMO/core/@threecomp/disp.html" class="code" title="function disp(TC)">disp</a>	DISP Display threecomp object</li><li><a href="../../../GISMO/core/@threecomp/get.html" class="code" title="function val = get(TC,varargin)">get</a>	GET    Get threecomp object properties.</li><li><a href="../../../GISMO/core/@threecomp/plot.html" class="code" title="function varargout = plot(TC, varargin)">plot</a>	PLOT plots a threecomp object</li><li><a href="../../../GISMO/core/@waveform/abs.html" class="code" title="function w = abs(w)">abs</a>	ABS Absolute value for the waveform object</li><li><a href="../../../GISMO/core/@waveform/disp.html" class="code" title="function disp(w)">disp</a>	DISP Waveform disp overloaded operator</li><li><a href="../../../GISMO/core/@waveform/get.html" class="code" title="function val = get(w,prop_name)">get</a>	GET Get waveform properties</li><li><a href="../../../GISMO/core/@waveform/max.html" class="code" title="function [Y, I] = max(w)">max</a>	MIN    Largest value of a waveform.</li><li><a href="../../../GISMO/core/@waveform/min.html" class="code" title="function [Y, I] = min(w)">min</a>	MIN    Smallest value of a waveform.</li><li><a href="../../../GISMO/core/@waveform/plot.html" class="code" title="function varargout = plot(w, varargin)">plot</a>	PLOT plots a waveform object</li><li><a href="../../../GISMO/core/dev/@NewCorrelation/disp.html" class="code" title="function disp(c)">disp</a>	CORRELATION/DISPLAY Command window display of a correlation object</li><li><a href="../../../GISMO/core/dev/@NewCorrelation/find.html" class="code" title="function index = find(c, type, value)">find</a>	INDEX = FIND(c,'CLUST',WHICH_CLUSTER)</li><li><a href="../../../GISMO/core/dev/@NewCorrelation/get.html" class="code" title="function val = get(c,prop_name)">get</a>	GET - Get correlation properties</li><li><a href="../../../GISMO/core/dev/@NewCorrelation/plot.html" class="code" title="function plot(c,varargin)">plot</a>	PLOT(C) plots waveforms stored in a correlation object. Traces are</li><li><a href="../../../GISMO/core/dev/@SeismicTrace/disp.html" class="code" title="function disp(T)">disp</a>	disp   Display information about SeismicTrace(s)</li><li><a href="../../../GISMO/core/dev/@SeismicTrace/plot.html" class="code" title="function varargout = plot(T, varargin)">plot</a>	plot   plots a SeismicTrace</li><li><a href="../../../GISMO/deprecated/@helicorder/disp.html" class="code" title="function disp(h)">disp</a>	DISP: Helicorder disp overloaded operator</li><li><a href="../../../GISMO/deprecated/@helicorder/get.html" class="code" title="function val = get(h,prop_name)">get</a>	GET: Get helicorder properties</li><li><a href="../../../GISMO/deprecated/fft_tools/+wf_fft/plot.html" class="code" title="function plot(w)">plot</a>	PLOT plot fourier transform of a waveform</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="rsam.html" class="code" title="">rsam</a>	</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [lambda, r2] = duration_amplitude(self, law, min_amplitude, mag_zone)</a>
0002     <span class="comment">%DURATION_AMPLITUDE Use the duration-amplitde</span>
0003     <span class="comment">%Compute the fraction of a data series above each</span>
0004     <span class="comment">%amplitude level, plot the duration vs amplitude data, and then</span>
0005     <span class="comment">%allow user input to fit a regression line.</span>
0006     <span class="comment">%   rsamObject.duration_amplitude(law, min_amplitude)</span>
0007     <span class="comment">%</span>
0008     <span class="comment">%   Inputs:</span>
0009     <span class="comment">%       law = 'exponential' or 'power'</span>
0010     <span class="comment">%       min_amplitude = (Optional) the smallest amplitude to use on</span>
0011     <span class="comment">%       the x-axis. Otherwise will be 10^10 times smallest than the</span>
0012     <span class="comment">%       largest amplitude.</span>
0013     <span class="comment">%</span>
0014     <span class="comment">%   Outputs:</span>
0015     <span class="comment">%       (None) A graph is plotted, the user clicks two points, and</span>
0016     <span class="comment">%       from that slope, the characteristic amplitude is computed</span>
0017     <span class="comment">%       and shown on the screen.</span>
0018 
0019     y = self.data;
0020     n = length(y);
0021     a = <a href="../../../GISMO/core/@waveform/abs.html" class="code" title="function w = abs(w)">abs</a>(y);
0022     max_amplitude = <a href="../../../GISMO/core/@waveform/max.html" class="code" title="function [Y, I] = max(w)">max</a>(a);
0023     <span class="keyword">if</span> ~exist(<span class="string">'min_amplitude'</span>, <span class="string">'var'</span>)
0024         min_amplitude = <a href="../../../GISMO/core/@waveform/max.html" class="code" title="function [Y, I] = max(w)">max</a>([<a href="../../../GISMO/core/@waveform/min.html" class="code" title="function [Y, I] = min(w)">min</a>(a) <a href="../../../GISMO/core/@waveform/max.html" class="code" title="function [Y, I] = max(w)">max</a>(a)*1e-10]);
0025     <span class="keyword">end</span>
0026 
0027     <span class="comment">% Method 1</span>
0028     index=0;
0029     x = min_amplitude;
0030     <span class="keyword">while</span> x &lt; max_amplitude,
0031         i = <a href="../../../GISMO/core/@correlation/find.html" class="code" title="function index = find(c,varargin)">find</a>(a&gt;x);
0032         f = length(i);
0033         index = index+1;
0034         frequency(index) = f;
0035         threshold(index) = x;
0036         x = x * 1.2;
0037     <span class="keyword">end</span>
0038     clear x y a  f  n  min_amplitude max_amplitude index ;
0039 
0040     <span class="comment">%             % Method 2</span>
0041     <span class="comment">%             threshold = [0.0 logspace(min_amplitude, max_amplitude, 50)];</span>
0042     <span class="comment">%             nsamples=[];</span>
0043     <span class="comment">%             for d = 1:length(threshold)</span>
0044     <span class="comment">%                 i = find(a &gt; threshold(d));</span>
0045     <span class="comment">%                 frequency(d) = length(i)/length(y);</span>
0046     <span class="comment">%             end</span>
0047     <span class="comment">%             clear d, nsamples, i, y</span>
0048 
0049     <span class="comment">%% PLOT_DURATION_AMPLITUDE</span>
0050     <span class="comment">% plot graph, user select two points, compute</span>
0051     <span class="comment">% characteristic from slope.</span>
0052     <span class="comment">% Use different method depending on whether it is a</span>
0053     <span class="comment">% power law or exponential.</span>
0054 
0055     <span class="comment">% define x and y</span>
0056     <span class="keyword">switch</span> law
0057         <span class="keyword">case</span> {<span class="string">'exponential'</span>}
0058             x = threshold;
0059             xlabelstr = <span class="string">'RMS Displacement(nm)'</span>;
0060         <span class="keyword">case</span> {<span class="string">'power'</span>}
0061             x = log10(threshold);
0062             xlabelstr = <span class="string">'log10(RMS Displacement(nm))'</span>;
0063         <span class="keyword">otherwise</span>
0064             error(<span class="string">'law unknown'</span>)
0065     <span class="keyword">end</span>
0066     y=log10(frequency);
0067 
0068     <span class="comment">% plot duration-amplitude data as circles</span>
0069     figure
0070     <a href="plot.html" class="code" title="function handlePlot = plot(rsam_vector, varargin)">plot</a>(x,y,<span class="string">'o'</span>);
0071     xlabel(xlabelstr);
0072     ylabel(<span class="string">'log10(Cumulative Minutes)'</span>);
0073     hold on;
0074     <span class="comment">%set(gca,'XLim',[xmin xmax]);</span>
0075 
0076     lambda=0;
0077     r2=0;
0078 
0079     <span class="comment">% check if we have pre-set the magnitude range, effectively</span>
0080     <span class="comment">% our x1 and x2 click points with ginput</span>
0081     <span class="keyword">if</span> exist(<span class="string">'mag_zone'</span>,<span class="string">'var'</span>) <span class="comment">% no user select</span>
0082         <span class="keyword">switch</span> law
0083             <span class="keyword">case</span> {<span class="string">'power'</span>}
0084                 x1=<a href="../../../GISMO/core/@waveform/min.html" class="code" title="function [Y, I] = min(w)">min</a>(mag_zone);
0085                 x2=<a href="../../../GISMO/core/@waveform/max.html" class="code" title="function [Y, I] = max(w)">max</a>(mag_zone);
0086             <span class="keyword">case</span> {<span class="string">'exponential'</span>}
0087                 x1=10^min(mag_zone);
0088                 x2=10^max(mag_zone);
0089 
0090             <span class="keyword">otherwise</span>
0091                 error(<span class="string">'law unknown'</span>)
0092         <span class="keyword">end</span>      
0093         <span class="keyword">if</span> x1&lt;<a href="../../../GISMO/core/@waveform/min.html" class="code" title="function [Y, I] = min(w)">min</a>(x)
0094             x2=<a href="../../../GISMO/core/@waveform/min.html" class="code" title="function [Y, I] = min(w)">min</a>(x);
0095         <span class="keyword">end</span>
0096         y1=interp1(x,y,x1);
0097         <span class="keyword">if</span> x2&gt;<a href="../../../GISMO/core/@waveform/max.html" class="code" title="function [Y, I] = max(w)">max</a>(x)
0098             x2=<a href="../../../GISMO/core/@waveform/max.html" class="code" title="function [Y, I] = max(w)">max</a>(x);
0099         <span class="keyword">end</span>
0100         y2=interp1(x,y,x2); 
0101 
0102         <span class="comment">% draw a dotted line to show where user selected</span>
0103         <span class="comment">%plot([x1 x2], [y1 y2], '-.');</span>
0104 
0105         <span class="comment">% select requested data range and do a least squares fit</span>
0106         ii = <a href="../../../GISMO/core/@correlation/find.html" class="code" title="function index = find(c,varargin)">find</a>(x &gt;= x1 &amp; x &lt;= x2);
0107         wx = x(ii);
0108         wy = y(ii);
0109         [p,S]=polyfit(wx,wy,1);
0110         yfit = polyval(p,wx);
0111         thiscorr = corrcoef(wy, yfit)
0112         <span class="comment">%try</span>
0113         <span class="keyword">if</span> numel(thiscorr)&gt;1
0114             r2 = thiscorr(1,2);
0115 
0116             <span class="comment">% compute lambda</span>
0117             <span class="keyword">switch</span> law
0118                 <span class="keyword">case</span> {<span class="string">'exponential'</span>}
0119                     lambda = -p(1)/log10(exp(1));
0120                 <span class="keyword">case</span> {<span class="string">'power'</span>}
0121                     lambda = -p(1); 
0122                 <span class="keyword">otherwise</span>
0123                     error(<span class="string">'law unknown'</span>)
0124             <span class="keyword">end</span>
0125 
0126             <a href="../../../GISMO/core/@Catalog/disp.html" class="code" title="function disp(obj, showall)">disp</a>(sprintf(<span class="string">'characteristic D_R_S=%.2f cm^2, R^2=%.2f'</span>,lambda,r2));
0127 
0128             <span class="comment">% draw the fitted line</span>
0129             xf = [<a href="../../../GISMO/core/@waveform/min.html" class="code" title="function [Y, I] = min(w)">min</a>(wx) <a href="../../../GISMO/core/@waveform/max.html" class="code" title="function [Y, I] = max(w)">max</a>(wx)];
0130             yf = xf * p(1) + p(2);
0131             <a href="plot.html" class="code" title="function handlePlot = plot(rsam_vector, varargin)">plot</a>(xf, yf,<span class="string">'-'</span>);
0132 
0133             <span class="comment">%ylabel('log10(t/t0)');</span>
0134             <span class="comment">%xlabel(sprintf('D_R_S (%s) (cm^2)',measure));</span>
0135 
0136 
0137             <span class="comment">% Add legend</span>
0138             yrange=<a href="../../../GISMO/core/@correlation/get.html" class="code" title="function val = get(c,prop_name)">get</a>(gca,<span class="string">'YLim'</span>);
0139             xlim = <a href="../../../GISMO/core/@correlation/get.html" class="code" title="function val = get(c,prop_name)">get</a>(gca,<span class="string">'XLim'</span>);
0140             xmax=<a href="../../../GISMO/core/@waveform/max.html" class="code" title="function [Y, I] = max(w)">max</a>(xlim);
0141 
0142             xpos = xmax*0.65;
0143             ypos = (yrange(2)-yrange(1))*0.8;
0144             r2str=sprintf(<span class="string">'%.2f'</span>,r2);
0145             lambdastr=sprintf(<span class="string">'%.2f'</span>,lambda);
0146             <span class="keyword">if</span> strcmp(law,<span class="string">'exponential'</span>)
0147                 tstr = [<span class="string">' \lambda='</span>,lambdastr,<span class="string">' R^2='</span>,r2str];
0148             <span class="keyword">else</span>
0149                 tstr = [<span class="string">' \gamma='</span>,lambdastr,<span class="string">' R^2='</span>,r2str];
0150             <span class="keyword">end</span>
0151 
0152             text(xpos, ypos, tstr, <span class="keyword">...</span>
0153                 <span class="string">'FontName'</span>,<span class="string">'Helvetica'</span>,<span class="string">'FontSize'</span>,[14],<span class="string">'FontWeight'</span>,<span class="string">'bold'</span>);   
0154         <span class="keyword">else</span>
0155             lambda=NaN;
0156             r2=NaN;
0157         <span class="keyword">end</span>
0158 
0159     <span class="keyword">else</span>
0160 
0161         <span class="comment">% user select a range of data</span>
0162         <a href="../../../GISMO/core/@Catalog/disp.html" class="code" title="function disp(obj, showall)">disp</a>(<span class="string">'Left-click Select lowest X, any other mouse button to ignore this station'</span>)
0163         [x1, y1, button1]=ginput(1);
0164         <span class="keyword">if</span> button1==1
0165             <a href="../../../GISMO/core/@Catalog/disp.html" class="code" title="function disp(obj, showall)">disp</a>(<span class="string">'Left-click Select highest X, any other mouse button to ignore this station'</span>)
0166             [x2, y2, button2]=ginput(1);    
0167             <span class="keyword">if</span> button2==1
0168                 <span class="keyword">if</span> x2&gt;x1
0169                    <span class="comment">% draw a dotted line to show where user selected</span>
0170                     <a href="plot.html" class="code" title="function handlePlot = plot(rsam_vector, varargin)">plot</a>([x1 x2], [y1 y2], <span class="string">'-.'</span>);
0171 
0172                     <span class="comment">% select requested data range and do a least squares fit</span>
0173                     ii = <a href="../../../GISMO/core/@correlation/find.html" class="code" title="function index = find(c,varargin)">find</a>(x &gt;= x1 &amp; x &lt;= x2);
0174                     wx = x(ii);
0175                     wy = y(ii);
0176                     [p,S]=polyfit(wx,wy,1);
0177                     yfit = polyval(p,wx);
0178                     thiscorr = corrcoef(wy, yfit)
0179 
0180                     r2 = thiscorr(1,2);
0181 
0182                     <span class="comment">% compute lambda</span>
0183                     <span class="keyword">switch</span> law
0184                         <span class="keyword">case</span> {<span class="string">'exponential'</span>}
0185                             lambda = -p(1)/log10(exp(1));
0186                         <span class="keyword">case</span> {<span class="string">'power'</span>}
0187                             lambda = -p(1); 
0188                         <span class="keyword">otherwise</span>
0189                             error(<span class="string">'law unknown'</span>)
0190                     <span class="keyword">end</span>
0191 
0192                     <a href="../../../GISMO/core/@Catalog/disp.html" class="code" title="function disp(obj, showall)">disp</a>(sprintf(<span class="string">'characteristic D_R_S=%.2f cm^2, R^2=%.2f'</span>,lambda,r2));
0193 
0194                     <span class="comment">% draw the fitted line</span>
0195                     xf = [<a href="../../../GISMO/core/@waveform/min.html" class="code" title="function [Y, I] = min(w)">min</a>(wx) <a href="../../../GISMO/core/@waveform/max.html" class="code" title="function [Y, I] = max(w)">max</a>(wx)];
0196                     yf = xf * p(1) + p(2);
0197                     <a href="plot.html" class="code" title="function handlePlot = plot(rsam_vector, varargin)">plot</a>(xf, yf,<span class="string">'-'</span>);
0198 
0199                     <span class="comment">%ylabel('log10(t/t0)');</span>
0200                     <span class="comment">%xlabel(sprintf('D_R_S (%s) (cm^2)',measure));</span>
0201 
0202 
0203                     <span class="comment">% Add legend</span>
0204                     yrange=<a href="../../../GISMO/core/@correlation/get.html" class="code" title="function val = get(c,prop_name)">get</a>(gca,<span class="string">'YLim'</span>);
0205                     xlim = <a href="../../../GISMO/core/@correlation/get.html" class="code" title="function val = get(c,prop_name)">get</a>(gca,<span class="string">'XLim'</span>);
0206                     xmax=<a href="../../../GISMO/core/@waveform/max.html" class="code" title="function [Y, I] = max(w)">max</a>(xlim);
0207 
0208                     xpos = xmax*0.65;
0209                     ypos = (yrange(2)-yrange(1))*0.8;
0210                     r2str=sprintf(<span class="string">'%.2f'</span>,r2);
0211                     lambdastr=sprintf(<span class="string">'%.2f'</span>,lambda);
0212                     <span class="keyword">if</span> strcmp(law,<span class="string">'exponential'</span>)
0213                         tstr = [self.sta,<span class="string">' \lambda='</span>,lambdastr,<span class="string">' R^2='</span>,r2str];
0214                     <span class="keyword">else</span>
0215                         tstr = [self.sta,<span class="string">' \gamma='</span>,lambdastr,<span class="string">' R^2='</span>,r2str];
0216                     <span class="keyword">end</span>
0217 
0218                     text(xpos, ypos, tstr, <span class="keyword">...</span>
0219                         <span class="string">'FontName'</span>,<span class="string">'Helvetica'</span>,<span class="string">'FontSize'</span>,[14],<span class="string">'FontWeight'</span>,<span class="string">'bold'</span>);
0220 
0221 
0222                 <span class="keyword">end</span>
0223             <span class="keyword">end</span>
0224         <span class="keyword">end</span>
0225     <span class="keyword">end</span>
0226 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Wed 12-Oct-2016 17:36:30 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>