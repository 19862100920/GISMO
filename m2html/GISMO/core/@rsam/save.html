<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of save</title>
  <meta name="keywords" content="save">
  <meta name="description" content="RSAM/SAVE - save an rsam-like object to an RSAM/BOB binary">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="../../index.html">GISMO</a> &gt; <a href="#">core</a> &gt; <a href="index.html">@rsam</a> &gt; save.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for GISMO/core/@rsam&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>save
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>RSAM/SAVE - save an rsam-like object to an RSAM/BOB binary</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function save(self, filepattern) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> RSAM/SAVE - save an rsam-like object to an RSAM/BOB binary
 file


 Examples:
   1. save data to myfile.bob
       r.save('myfile.bob')

   2. save to file like YEAR_STATION_CHANNEL_MEASURE.bob
       r.save('YYYY_SSSS_CCC_MMMM.bob')</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../GISMO/core/@Catalog/disp.html" class="code" title="function disp(obj, showall)">disp</a>	CATALOG.DISP Display Catalog object</li><li><a href="../../../GISMO/core/@correlation/diff.html" class="code" title="function c = diff(c)">diff</a>	DIFF differentiate each trace.</li><li><a href="../../../GISMO/core/@correlation/find.html" class="code" title="function index = find(c,varargin)">find</a>	INDEX = FIND(c,'CLUST',WHICH_CLUSTER)</li><li><a href="../../../GISMO/core/@datasource/disp.html" class="code" title="function disp(ds)">disp</a>	DISP Datasource disp overloaded operator</li><li><a href="../../../GISMO/core/@filterobject/disp.html" class="code" title="function disp(f)">disp</a>	DISP - Filterobject disp overloaded operator</li><li><a href="../../../GISMO/core/@scnlobject/disp.html" class="code" title="function disp(sncl)">disp</a>	DISP - scnl disp overloaded operator</li><li><a href="../../../GISMO/core/@spectralobject/disp.html" class="code" title="function disp(s)">disp</a>	DISP - spectralobject disp overloaded operator</li><li><a href="../../../GISMO/core/@threecomp/disp.html" class="code" title="function disp(TC)">disp</a>	DISP Display threecomp object</li><li><a href="../../../GISMO/core/@waveform/diff.html" class="code" title="function w = diff (w)">diff</a>	DIFF Differentiate waveform</li><li><a href="../../../GISMO/core/@waveform/disp.html" class="code" title="function disp(w)">disp</a>	DISP Waveform disp overloaded operator</li><li><a href="../../../GISMO/core/dev/@NewCorrelation/diff.html" class="code" title="function c = diff(c)">diff</a>	DIFF differentiate each trace.</li><li><a href="../../../GISMO/core/dev/@NewCorrelation/disp.html" class="code" title="function disp(c)">disp</a>	CORRELATION/DISPLAY Command window display of a correlation object</li><li><a href="../../../GISMO/core/dev/@NewCorrelation/find.html" class="code" title="function index = find(c, type, value)">find</a>	INDEX = FIND(c,'CLUST',WHICH_CLUSTER)</li><li><a href="../../../GISMO/core/dev/@SeismicTrace/disp.html" class="code" title="function disp(T)">disp</a>	disp   Display information about SeismicTrace(s)</li><li><a href="../../../GISMO/deprecated/@helicorder/disp.html" class="code" title="function disp(h)">disp</a>	DISP: Helicorder disp overloaded operator</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../GISMO/applications/+iceweb/iceweb.html" class="code" title="function iceweb(ds, varargin)">iceweb</a>	</li><li><a href="../../../GISMO/applications/+iceweb/montserrat_remove_analog_sites.html" class="code" title="function montserrat_remove_analog_sites">montserrat_remove_analog_sites</a>	</li><li><a href="../../../GISMO/applications/+iceweb/setup.html" class="code" title="function setup(subnet, snum, enum, setupfile, chanmatch)">setup</a>	</li><li><a href="../../../GISMO/applications/+iceweb/waveform_wrapper.html" class="code" title="function w=waveform_wrapper(ds, chantag, snum, enum);">waveform_wrapper</a>	WAVEFORM_WRAPPER try multiple datasource objects in</li><li><a href="../../../GISMO/contributed/instrument_response/demo_plutons.html" class="code" title="">demo_plutons</a>	</li><li><a href="../../../GISMO/contributed_antelope/double_difference/dd_process_scp.html" class="code" title="function dd_process_scp(dbname,scpfile,varargin)">dd_process_scp</a>	DD_PROCESS_SCP Process correlations by station and channel</li><li><a href="../../../GISMO/contributed_antelope/reduced_displacement/reducedisp_plot.html" class="code" title="function reducedisp_plot(dbname)">reducedisp_plot</a>	REDUCEDISP_PLOT plot reduced displacement data.</li><li><a href="../../../GISMO/core/@Catalog/cookbook.html" class="code" title="">cookbook</a>	% Catalog Cookbook</li><li><a href="../../../GISMO/core/@correlation/conv.html" class="code" title="function c = conv(c,varargin)">conv</a>	c = CONV(c) convolves all traces with the final trace. By default the new</li><li><a href="../../../GISMO/core/@correlation/deconv.html" class="code" title="function c = deconv(c,varargin)">deconv</a>	c = DECONV(c) convolves all traces with the final trace. By default the new</li><li><a href="rsam.html" class="code" title="">rsam</a>	</li><li><a href="../../../GISMO/core/@threecomp/private/create_demo_data.html" class="code" title="">create_demo_data</a>	This script was used once to create the demo dataset</li><li><a href="../../../GISMO/core/dev/@NewCorrelation/conv.html" class="code" title="function c = conv(c)">conv</a>	conv   convolve all traces with the final trace</li><li><a href="../../../GISMO/core/dev/@NewCorrelation/deconv.html" class="code" title="function c = deconv(c)">deconv</a>	c = DECONV(c) convolves all traces with the final trace. By default the new</li><li><a href="../../../GISMO/tests/testWaveform.html" class="code" title="">testWaveform</a>	</li><li><a href="../../../GISMO/training/gismo_examples.html" class="code" title="">gismo_examples</a>	Standard clearing MATLAB workspace & command window, closing figures</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function save(self, filepattern)</a>
0002     <span class="comment">% RSAM/SAVE - save an rsam-like object to an RSAM/BOB binary</span>
0003     <span class="comment">% file</span>
0004     <span class="comment">%</span>
0005     <span class="comment">%</span>
0006     <span class="comment">% Examples:</span>
0007     <span class="comment">%   1. save data to myfile.bob</span>
0008     <span class="comment">%       r.save('myfile.bob')</span>
0009     <span class="comment">%</span>
0010     <span class="comment">%   2. save to file like YEAR_STATION_CHANNEL_MEASURE.bob</span>
0011     <span class="comment">%       r.save('YYYY_SSSS_CCC_MMMM.bob')</span>
0012     <span class="comment">%</span>
0013 
0014     <span class="keyword">for</span> c=1:numel(self)
0015         dnum = self(c).dnum;
0016         data = self(c).data;
0017         file = filepattern; 
0018 
0019         <span class="comment">% substitute for station</span>
0020         file = regexprep(file, <span class="string">'SSSS'</span>, upper(self(c).sta));
0021 
0022         <span class="comment">% substitute for channel</span>
0023         file = regexprep(file, <span class="string">'CCC'</span>, upper(self(c).chan));
0024 
0025         <span class="comment">% substitute for measure</span>
0026         file = regexprep(file, <span class="string">'MMMM'</span>, self(c).measure);             
0027 
0028         <span class="comment">% since dnum may not be ordered and contiguous, this function</span>
0029         <span class="comment">% should write data based on dnum only</span>
0030 
0031         <span class="keyword">if</span> length(dnum)~=length(data)
0032                 debug.print_debug(0,sprintf(<span class="string">'%s: Cannot save to %s because data and time vectors are different lengths'</span>,mfilename,filename));
0033                 <span class="keyword">return</span>;
0034         <span class="keyword">end</span>
0035 
0036         <span class="keyword">if</span> length(data)&lt;1
0037                 debug.print_debug(0,<span class="string">'No data. Aborting'</span>);
0038             <span class="keyword">return</span>;
0039         <span class="keyword">end</span>
0040 
0041         <span class="comment">% filename</span>
0042 
0043         <span class="comment">% set start year and month, and end year and month</span>
0044         [syyy sm]=datevec(self(c).snum);
0045         [eyyy em]=datevec(self(c).enum);
0046 
0047         <span class="keyword">if</span> syyy~=eyyy
0048             <span class="keyword">if</span> ~strfind(filepattern, <span class="string">'YYYY'</span>)
0049                         error(<span class="string">'can only save RSAM data to BOB file if all data within 1 year (or you can add YYYY in your file pattern)'</span>);
0050             <span class="keyword">end</span>
0051         <span class="keyword">end</span> 
0052 
0053         <span class="keyword">for</span> yyyy=syyy:eyyy
0054 
0055             <span class="comment">% how many days in this year?</span>
0056             daysperyear = 365;
0057             <span class="keyword">if</span> (mod(yyyy,4)==0)
0058                     daysperyear = 366;
0059             <span class="keyword">end</span>
0060 
0061             <span class="comment">% Substitute for year</span>
0062             fname = regexprep(file, <span class="string">'YYYY'</span>, sprintf(<span class="string">'%04d'</span>,yyyy) );
0063             debug.print_debug(2,sprintf(<span class="string">'Looking for file: %s\n'</span>,fname));
0064 
0065             <span class="keyword">if</span> ~exist(fname,<span class="string">'file'</span>)
0066                     debug.print_debug(2, [<span class="string">'Creating '</span>,fname])
0067                     rsam.makebobfile(fname, daysperyear);
0068             <span class="keyword">end</span>            
0069 
0070             datapointsperday = 1440;
0071 
0072             <span class="comment">% round times to minute</span>
0073             dnum = round((dnum-1/86400) * 1440) / 1440;
0074 
0075             <span class="comment">% subset for current year</span>
0076             dnumy = dnum(dnum &lt; datenum(yyyy + 1, 1, 1));
0077             datay = data(dnum &lt; datenum(yyyy + 1, 1, 1));
0078 
0079             <span class="comment">% find the next contiguous block of data</span>
0080             <a href="../../../GISMO/core/@correlation/diff.html" class="code" title="function c = diff(c)">diff</a>=dnumy(2:end) - dnumy(1:end-1);
0081             i = <a href="../../../GISMO/core/@correlation/find.html" class="code" title="function index = find(c,varargin)">find</a>(<a href="../../../GISMO/core/@correlation/diff.html" class="code" title="function c = diff(c)">diff</a> &gt; 1.5/1440 | <a href="../../../GISMO/core/@correlation/diff.html" class="code" title="function c = diff(c)">diff</a> &lt; 0.5/1440);        
0082 
0083             <a href="../../../GISMO/core/@Catalog/disp.html" class="code" title="function disp(obj, showall)">disp</a>(sprintf(<span class="string">'Saving to %s'</span>,fname));
0084             
0085             <span class="keyword">if</span> length(i)&gt;0
0086                 <span class="comment">% slow mode</span>
0087 
0088                 <span class="keyword">for</span> c=1:length(dnumy)
0089 
0090                     <span class="comment">% write the data</span>
0091                     startsample = round((dnumy(c) - datenum(yyyy,1,1)) * datapointsperday);
0092                     offset = startsample*4;
0093                     fid = fopen(fname,<span class="string">'r+'</span>);
0094                     fseek(fid,offset,<span class="string">'bof'</span>);
0095                     debug.print_debug(2, sprintf(<span class="string">'saving data with mean of %e from to file %s, starting at position %d'</span>,nanmean(datay),fname,startsample,(datapointsperday*daysperyear)))
0096                     fwrite(fid,datay(c),<span class="string">'float32'</span>);
0097                     fclose(fid);
0098                 <span class="keyword">end</span>
0099             <span class="keyword">else</span>
0100                 <span class="comment">% fast mode</span>
0101 
0102                 <span class="comment">% write the data</span>
0103                 startsample = round((dnumy(1) - datenum(yyyy,1,1)) * datapointsperday);
0104                 offset = startsample*4;
0105                 fid = fopen(fname,<span class="string">'r+'</span>,<span class="string">'l'</span>); <span class="comment">% little-endian. Anything written on a PC is little-endian by default. Sun is big-endian.</span>
0106                 fseek(fid,offset,<span class="string">'bof'</span>);
0107                 debug.print_debug(2, sprintf(<span class="string">'saving data with mean of %e from to file %s, starting at position %d/%d'</span>,nanmean(datay),fname,startsample,(datapointsperday*daysperyear)))
0108                 fwrite(fid,datay,<span class="string">'float32'</span>);
0109                 fclose(fid);
0110             <span class="keyword">end</span>
0111         <span class="keyword">end</span>
0112     <span class="keyword">end</span>
0113 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Wed 12-Oct-2016 17:36:30 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>