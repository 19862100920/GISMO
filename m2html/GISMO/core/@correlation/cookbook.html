<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of cookbook</title>
  <meta name="keywords" content="cookbook">
  <meta name="description" content="% Correlation object cookbook">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="../../index.html">GISMO</a> &gt; <a href="#">core</a> &gt; <a href="index.html">@correlation</a> &gt; cookbook.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for GISMO/core/@correlation&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>cookbook
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>% Correlation object cookbook</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function correlationVariables = cookbook(corr) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">% Correlation object cookbook
 This is a short demonstration of some of the major tools in the waveform
 correlation toolbox. The overarching goal of the toolbox is to provide a
 set of functions for performing routine manipulations on a large set of
 waveforms (tens to thousands) which may bare some similarity to each
 other - cross correlation, stacking, grouping, plotting, interferometry
 etc. Detailed usages can be found for each function with the HELP
 command. At a minimum, read HELP CORRELATION for the basic architecture
 of a CORRELATION object. Detailed installation and version notes can be
 found in GISMO/@correlation/README.txt

 Data can be imported to a CORRELATION object from several sources.
 Primary sources are intended to be Antelope and Winston databases. Since
 trace handling is carried out with the WAVEFORM toolbox though, any data
 that can be converted to a WAVEFORM object can be converted to a
 CORRELATION object, including SAC files. All uses of CORRELATION require
 that the WAVEFORM toolbox be installed.

 [NOTE that the set(gcf,'Position',...) lines used repeatedly below are
 just for display purposes in this document.]</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../GISMO/core/@Catalog/plot.html" class="code" title="function plot(catalogObject, varargin)">plot</a>	CATALOG.PLOT Plot hypocenters in map view and cross-sections</li><li><a href="../../../GISMO/core/@Catalog/subset.html" class="code" title="function catalogObject2 = subset(catalogObject, indices)">subset</a>	CATALOG.SUBSET Create a new catalogObject by subsetting based</li><li><a href="adjusttrig.html" class="code" title="function c = adjusttrig(c,varargin)">adjusttrig</a>	ADJUSTTRIG adjusts the trigger times of each trace</li><li><a href="butter.html" class="code" title="function c = butter(c,varargin)">butter</a>	C = BUTTER(C,[TYPE],CUTOFF,[POLES])</li><li><a href="cluster.html" class="code" title="function c=cluster(c,varargin)">cluster</a>	c = CLUSTER(c,CUTOFF) cuts the "branches" of the linkage tree to create</li><li><a href="correlation.html" class="code" title="function c = correlation(varargin)">correlation</a>	</li><li><a href="crop.html" class="code" title="function c = crop(c,varargin)">crop</a>	c = CROP(c,[PRETRIG POSTTRIG])</li><li><a href="display.html" class="code" title="function display(c)">display</a>	CORRELATION/DISPLAY Command window display of a correlation object</li><li><a href="find.html" class="code" title="function index = find(c,varargin)">find</a>	INDEX = FIND(c,'CLUST',WHICH_CLUSTER)</li><li><a href="get.html" class="code" title="function val = get(c,prop_name)">get</a>	GET - Get correlation properties</li><li><a href="interferogram.html" class="code" title="function [c,t,i,CC,LL] = interferogram(c,varargin)">interferogram</a>	C = INTERFEROGRAM(C)</li><li><a href="linkage.html" class="code" title="function c = linkage(c,varargin);">linkage</a>	c = LINKAGE(c) Creates a hierarchical cluster tree for all waveforms in</li><li><a href="minus.html" class="code" title="function c = minus(c,varargin)">minus</a>	C = MINUS(C,I)</li><li><a href="norm.html" class="code" title="function c = norm(c,varargin)">norm</a>	C = NORM(C)</li><li><a href="plot.html" class="code" title="function plot(c,varargin)">plot</a>	PLOT(C) plots waveforms stored in a correlation object. Traces are</li><li><a href="set.html" class="code" title="function c = set(c, prop_name, val)">set</a>	SET Set properties for correlation object</li><li><a href="sign.html" class="code" title="function c = sign(c,varargin);">sign</a>	SIGN removes the mean of each trace.</li><li><a href="sort.html" class="code" title="function c = norm(c,varargin)">sort</a>	C = SORT(C,'TIME')</li><li><a href="stack.html" class="code" title="function c = stack(c,varargin)">stack</a>	c = STACK(c)</li><li><a href="subset.html" class="code" title="function c = subset(c,index)">subset</a>	c = SUBSET(c,INDEX)</li><li><a href="taper.html" class="code" title="function c = taper(c,varargin)">taper</a>	TAPER tapers the ends of waveforms in the correlation object.</li><li><a href="waveform.html" class="code" title="function w = waveform(c,varargin)">waveform</a>	WAVEFORM Extract a waveform object.</li><li><a href="xcorr.html" class="code" title="function c=xcorr(c,varargin)">xcorr</a>	C = XCORR(C)</li><li><a href="../../../GISMO/core/@datasource/display.html" class="code" title="function display(ds)">display</a>	DISPLAY - datasource display overloaded operator</li><li><a href="../../../GISMO/core/@datasource/get.html" class="code" title="function val = get(ds, propertyname)">get</a>	</li><li><a href="../../../GISMO/core/@drumplot/get.html" class="code" title="function val = get(h,prop_name)">get</a>	GET: Get drumplot properties</li><li><a href="../../../GISMO/core/@drumplot/plot.html" class="code" title="function varargout = plot(h)">plot</a>	PLOT: Drumplot plotting function. A drumplot object (h) contains no</li><li><a href="../../../GISMO/core/@drumplot/set.html" class="code" title="function h = set(h,varargin)">set</a>	SET: Set drumplot properties</li><li><a href="../../../GISMO/core/@filterobject/display.html" class="code" title="function display(f)">display</a>	DISPLAY - Filterobject display overloaded operator</li><li><a href="../../../GISMO/core/@filterobject/get.html" class="code" title="function val = get(f, prop_name)">get</a>	GET - Get filterobject properties</li><li><a href="../../../GISMO/core/@filterobject/set.html" class="code" title="function f = set(f, varargin)">set</a>	SET - Set filterobject properties</li><li><a href="../../../GISMO/core/@rsam/plot.html" class="code" title="function handlePlot = plot(rsam_vector, varargin)">plot</a>	RSAM/PLOT plot rsam data</li><li><a href="../../../GISMO/core/@scnlobject/display.html" class="code" title="function display(scnl)">display</a>	DISPLAY - scnlobject display overloaded operator</li><li><a href="../../../GISMO/core/@scnlobject/get.html" class="code" title="function stuff = get(scnl, prop_name)">get</a>	GET for the scnl object</li><li><a href="../../../GISMO/core/@scnlobject/set.html" class="code" title="function scnl = set(scnl, varargin)">set</a>	SET - Set properties for scnlobject</li><li><a href="../../../GISMO/core/@spectralobject/display.html" class="code" title="function display(s)">display</a>	DISPLAY - spectralobject display overloaded operator</li><li><a href="../../../GISMO/core/@spectralobject/get.html" class="code" title="function out = get(s, prop_name)">get</a>	GET - Get properties for spectralobject</li><li><a href="../../../GISMO/core/@spectralobject/set.html" class="code" title="function s = set(s, varargin)">set</a>	SET - Set properties for spectralobject</li><li><a href="../../../GISMO/core/@threecomp/get.html" class="code" title="function val = get(TC,varargin)">get</a>	GET    Get threecomp object properties.</li><li><a href="../../../GISMO/core/@threecomp/plot.html" class="code" title="function varargout = plot(TC, varargin)">plot</a>	PLOT plots a threecomp object</li><li><a href="../../../GISMO/core/@threecomp/set.html" class="code" title="function TC = set(TC, fieldName, val)">set</a>	SET inserts properties for threecomp object</li><li><a href="../../../GISMO/core/@threecomp/waveform.html" class="code" title="function w = waveform(TC)">waveform</a>	WAVEFORM Get waveforms from a threecomp object</li><li><a href="../../../GISMO/core/@waveform/display.html" class="code" title="function display(w)">display</a>	DISPLAY Waveform Display overloaded operator</li><li><a href="../../../GISMO/core/@waveform/get.html" class="code" title="function val = get(w,prop_name)">get</a>	GET Get waveform properties</li><li><a href="../../../GISMO/core/@waveform/minus.html" class="code" title="function w = minus(w,q)">minus</a>	MINUS (-) Overloaded waveform subtraction    w - q</li><li><a href="../../../GISMO/core/@waveform/plot.html" class="code" title="function varargout = plot(w, varargin)">plot</a>	PLOT plots a waveform object</li><li><a href="../../../GISMO/core/@waveform/set.html" class="code" title="function w = set(w, varargin)">set</a>	SET Set properties for waveform object(s)</li><li><a href="../../../GISMO/core/@waveform/sign.html" class="code" title="function w = sign(w)">sign</a>	SIGN Signum function for waveforms.</li><li><a href="../../../GISMO/core/@waveform/stack.html" class="code" title="function out = stack(w)">stack</a>	STACK stacks data from array of waveforms</li><li><a href="../../../GISMO/core/@waveform/taper.html" class="code" title="function w = taper(w,R, style)">taper</a>	WAVEFORM = TAPER(WAVEFORM,R) applies a cosine taper to the ends of a</li><li><a href="../../../GISMO/core/@waveform/waveform.html" class="code" title="function w = waveform(varargin)">waveform</a>	WAVEFORM Waveform Class constructor</li><li><a href="../../../GISMO/core/dev/@NewCorrelation/adjusttrig.html" class="code" title="function c = adjusttrig(c,varargin)">adjusttrig</a>	ADJUSTTRIG  adjusts the trigger times of each trace</li><li><a href="../../../GISMO/core/dev/@NewCorrelation/butter.html" class="code" title="function c = butter(c,varargin)">butter</a>	butter   create and apply a butterworth filter to the traces</li><li><a href="../../../GISMO/core/dev/@NewCorrelation/cluster.html" class="code" title="function c=cluster(c,varargin)">cluster</a>	cluster   Construct agglomerative clusters from linkage for Seismic Traces</li><li><a href="../../../GISMO/core/dev/@NewCorrelation/crop.html" class="code" title="function c = crop(c, pretrig, posttrig)">crop</a>	crop   crop all waveforms to a time window</li><li><a href="../../../GISMO/core/dev/@NewCorrelation/find.html" class="code" title="function index = find(c, type, value)">find</a>	INDEX = FIND(c,'CLUST',WHICH_CLUSTER)</li><li><a href="../../../GISMO/core/dev/@NewCorrelation/get.html" class="code" title="function val = get(c,prop_name)">get</a>	GET - Get correlation properties</li><li><a href="../../../GISMO/core/dev/@NewCorrelation/interferogram.html" class="code" title="function [c,t,i,CC,LL] = interferogram(c, width, timestep, masterIdx)">interferogram</a>	C = INTERFEROGRAM(C)</li><li><a href="../../../GISMO/core/dev/@NewCorrelation/linkage.html" class="code" title="function c = linkage(c,varargin)">linkage</a>	linkage   Agglomerative hierarchical cluster tree for Seismic Traces</li><li><a href="../../../GISMO/core/dev/@NewCorrelation/minus.html" class="code" title="function c = minus(c,I)">minus</a>	C = MINUS(C,I)</li><li><a href="../../../GISMO/core/dev/@NewCorrelation/norm.html" class="code" title="function c = norm(c,varargin)">norm</a>	C = NORM(C)</li><li><a href="../../../GISMO/core/dev/@NewCorrelation/plot.html" class="code" title="function plot(c,varargin)">plot</a>	PLOT(C) plots waveforms stored in a correlation object. Traces are</li><li><a href="../../../GISMO/core/dev/@NewCorrelation/set.html" class="code" title="function c = set(c, prop_name, val)">set</a>	SET Set properties for correlation object</li><li><a href="../../../GISMO/core/dev/@NewCorrelation/sign.html" class="code" title="function c = sign(c)">sign</a>	SIGN convert traces to the sign of their data (+1, 0, -1)</li><li><a href="../../../GISMO/core/dev/@NewCorrelation/sort.html" class="code" title="function c = sort(c)">sort</a>	C = SORT(C) Sorts traces from oldest to youngest.</li><li><a href="../../../GISMO/core/dev/@NewCorrelation/stack.html" class="code" title="function c = stack(c,index)">stack</a>	c = STACK(c)</li><li><a href="../../../GISMO/core/dev/@NewCorrelation/subset.html" class="code" title="function c = subset(c,index)">subset</a>	c = SUBSET(c,INDEX)</li><li><a href="../../../GISMO/core/dev/@NewCorrelation/taper.html" class="code" title="function c = taper(c,varargin)">taper</a>	TAPER tapers the ends of waveforms in the correlation object.</li><li><a href="../../../GISMO/core/dev/@NewCorrelation/waveform.html" class="code" title="function w = waveform(c,varargin)">waveform</a>	WAVEFORM Extract a waveform object.</li><li><a href="../../../GISMO/core/dev/@NewCorrelation/xcorr.html" class="code" title="function c=xcorr(c,varargin)">xcorr</a>	xcorr   calculate the correlation and lag for traces</li><li><a href="../../../GISMO/core/dev/@SeismicTrace/plot.html" class="code" title="function varargout = plot(T, varargin)">plot</a>	plot   plots a SeismicTrace</li><li><a href="../../../GISMO/deprecated/@helicorder/display.html" class="code" title="function display(h)">display</a>	DISPLAY: Helicorder display overloaded operator</li><li><a href="../../../GISMO/deprecated/@helicorder/get.html" class="code" title="function val = get(h,prop_name)">get</a>	GET: Get helicorder properties</li><li><a href="../../../GISMO/deprecated/@helicorder/set.html" class="code" title="function h = set(h,varargin)">set</a>	SET: Set helicorder properties</li><li><a href="../../../GISMO/deprecated/fft_tools/+wf_fft/plot.html" class="code" title="function plot(w)">plot</a>	PLOT plot fourier transform of a waveform</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../GISMO/core/@Catalog/Catalog.html" class="code" title="">Catalog</a>	CATALOG the blueprint for Catalog objects in GISMO</li><li><a href="../../../GISMO/core/@EventRate/EventRate.html" class="code" title="">EventRate</a>	</li><li><a href="correlation.html" class="code" title="function c = correlation(varargin)">correlation</a>	</li><li><a href="../../../GISMO/core/@drumplot/drumplot.html" class="code" title="">drumplot</a>	DRUMPLOT the blueprint for drumplot objects in GISMO</li><li><a href="../../../GISMO/core/dev/@NewCorrelation/NewCorrelation.html" class="code" title="">NewCorrelation</a>	</li><li><a href="../../../GISMO/core/dev/@TraceFilter/TraceFilter.html" class="code" title="">TraceFilter</a>	</li><li><a href="../../../GISMO/core/dev/@TraceSpectra/TraceSpectra.html" class="code" title="">TraceSpectra</a>	</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function correlationVariables = cookbook(corr)</a>
0002    <span class="comment">%% Correlation object cookbook</span>
0003    <span class="comment">% This is a short demonstration of some of the major tools in the waveform</span>
0004    <span class="comment">% correlation toolbox. The overarching goal of the toolbox is to provide a</span>
0005    <span class="comment">% set of functions for performing routine manipulations on a large set of</span>
0006    <span class="comment">% waveforms (tens to thousands) which may bare some similarity to each</span>
0007    <span class="comment">% other - cross correlation, stacking, grouping, plotting, interferometry</span>
0008    <span class="comment">% etc. Detailed usages can be found for each function with the HELP</span>
0009    <span class="comment">% command. At a minimum, read HELP CORRELATION for the basic architecture</span>
0010    <span class="comment">% of a CORRELATION object. Detailed installation and version notes can be</span>
0011    <span class="comment">% found in GISMO/@correlation/README.txt</span>
0012    <span class="comment">%</span>
0013    <span class="comment">% Data can be imported to a CORRELATION object from several sources.</span>
0014    <span class="comment">% Primary sources are intended to be Antelope and Winston databases. Since</span>
0015    <span class="comment">% trace handling is carried out with the WAVEFORM toolbox though, any data</span>
0016    <span class="comment">% that can be converted to a WAVEFORM object can be converted to a</span>
0017    <span class="comment">% CORRELATION object, including SAC files. All uses of CORRELATION require</span>
0018    <span class="comment">% that the WAVEFORM toolbox be installed.</span>
0019    <span class="comment">%</span>
0020    <span class="comment">% [NOTE that the set(gcf,'Position',...) lines used repeatedly below are</span>
0021    <span class="comment">% just for display purposes in this document.]</span>
0022    
0023    <span class="comment">% Author: Michael West, Geophysical Institute, Univ. of Alaska Fairbanks</span>
0024    <span class="comment">% $Date$</span>
0025    <span class="comment">% $Revision$</span>
0026    
0027    
0028    <span class="comment">%% Use traces from the demo dataset</span>
0029    <span class="comment">% For the purposes of this cookbook example we use the built-in correlation</span>
0030    <span class="comment">% demo dataset of 100 traces drawn from a broadband sensor AU13 at</span>
0031    <span class="comment">% Augustine volcano.</span>
0032    
0033    c = <a href="correlation.html" class="code" title="function c = correlation(varargin)">correlation</a>(<span class="string">'DEMO'</span>);
0034    
0035    
0036    <span class="comment">%% Load traces from an outside datasource</span>
0037    <span class="comment">% This approach requires that the Antelope toolbox for Matlab be installed.</span>
0038    <span class="comment">% The waveform object must also be installed. Once a list of &quot;trigger</span>
0039    <span class="comment">% times&quot; has been defined (in Matlab date format), reading traces can</span>
0040    <span class="comment">% be accomplished with a single command. Loading a few thousand short</span>
0041    <span class="comment">% traces into a single correlation object is no problem. See HELP</span>
0042    <span class="comment">% DATASOURCE and HELP SCNLOBJECT for a full description of these</span>
0043    <span class="comment">% prerequisite tools.</span>
0044    <span class="comment">%</span>
0045    <span class="comment">%&gt;&gt; time_str = [</span>
0046    <span class="comment">%     '01/11/2006 03:05:14.363'</span>
0047    <span class="comment">%     '01/11/2006 03:06:24.336'</span>
0048    <span class="comment">%     ...</span>
0049    <span class="comment">%     '01/12/2006 06:25:59.710'</span>
0050    <span class="comment">%     '01/12/2006 06:27:23.797'</span>
0051    <span class="comment">%     ];</span>
0052    <span class="comment">%&gt;&gt; time_num = datenum(time_str);</span>
0053    <span class="comment">%&gt;&gt; ds = datasource('antelope','archive');</span>
0054    <span class="comment">%&gt;&gt; scnl = scnlobject('sta','chan');</span>
0055    <span class="comment">%&gt;&gt; c = correlation(ds,scnl,time_num,-5,10)</span>
0056    
0057    
0058    <span class="comment">%% How to use a correlation object</span>
0059    <span class="comment">% List what functions can be used on a CORRELATION object. Display the 7</span>
0060    <span class="comment">% fields contained with each CORRELATION object.</span>
0061    
0062    methods(c)
0063    <a href="display.html" class="code" title="function display(c)">display</a>(c)
0064    
0065    
0066    <span class="comment">%% Plot raw data</span>
0067    <span class="comment">% Use 'wig' option for a traditional wiggle plot. 'sha' displays shaded</span>
0068    <span class="comment">% traces often useful when viewing more than ~50 traces at a</span>
0069    <span class="comment">% time.</span>
0070    
0071    <a href="plot.html" class="code" title="function plot(c,varargin)">plot</a>(c,<span class="string">'wig'</span>);
0072    <a href="set.html" class="code" title="function c = set(c, prop_name, val)">set</a>(gcf,<span class="string">'Position'</span>,[50 50 700 400]);
0073    
0074    
0075    <span class="comment">%% Crop, taper, filter traces</span>
0076    <span class="comment">% This particular use of crop is unnecessary but it demonstrates cropping</span>
0077    <span class="comment">% the data (in this case on the low end) and zero padding (in this case on</span>
0078    <span class="comment">% the high end.) BUTTER applies a zero-phase Butterworth filter to the</span>
0079    <span class="comment">% data. It is important to at least apply a high pass filter to data before</span>
0080    <span class="comment">% cross-correlating as long period rolls can greatly bias the correlation.</span>
0081    
0082    c = <a href="crop.html" class="code" title="function c = crop(c,varargin)">crop</a>(c,-4,12);
0083    c = <a href="taper.html" class="code" title="function c = taper(c,varargin)">taper</a>(c);
0084    c = <a href="butter.html" class="code" title="function c = butter(c,varargin)">butter</a>(c,[.5 10]);
0085    
0086    
0087    <span class="comment">%% Cross correlate</span>
0088    <span class="comment">% Cross correlate waveforms, identifying the maximum correlation value and</span>
0089    <span class="comment">% the relative time offset between each pair of traces to acheive the</span>
0090    <span class="comment">% maximum correlation. For many hundreds of events, this can be a time</span>
0091    <span class="comment">% consuming process. XCORR provides status information along the way.</span>
0092    
0093    c = <a href="xcorr.html" class="code" title="function c=xcorr(c,varargin)">xcorr</a>(c,[0 3.5]);
0094    
0095    
0096    <span class="comment">%% Similarity matrix</span>
0097    <span class="comment">% Sort traces by time and plot the correlation matrix - the set of maximum</span>
0098    <span class="comment">% cross-correlation values between each pair of traces. To access the</span>
0099    <span class="comment">% correlation matrix directly, first extract it from the correlation object</span>
0100    <span class="comment">% using the get command.</span>
0101    
0102    c = <a href="sort.html" class="code" title="function c = norm(c,varargin)">sort</a>(c);
0103    <a href="plot.html" class="code" title="function plot(c,varargin)">plot</a>(c,<span class="string">'corr'</span>);
0104    <a href="set.html" class="code" title="function c = set(c, prop_name, val)">set</a>(gcf,<span class="string">'Position'</span>,[50 50 500 400]);
0105    corr_matrix = <a href="get.html" class="code" title="function val = get(c,prop_name)">get</a>(c,<span class="string">'CORR'</span>);
0106    corr_matrix(1:5,1:5)
0107    
0108    <span class="comment">%% Lag matrix</span>
0109    <span class="comment">% Similar to above, this function plots the matrix of lag times (in</span>
0110    <span class="comment">% seconds) that yeild the maximum correlation between each pair of traces.</span>
0111    
0112    <a href="plot.html" class="code" title="function plot(c,varargin)">plot</a>(c,<span class="string">'lag'</span>);
0113    <a href="set.html" class="code" title="function c = set(c, prop_name, val)">set</a>(gcf,<span class="string">'Position'</span>,[50 50 500 400]);
0114    lag_matrix = <a href="get.html" class="code" title="function val = get(c,prop_name)">get</a>(c,<span class="string">'LAG'</span>);
0115    lag_matrix(1:5,1:5)
0116    
0117    
0118    <span class="comment">%% Realign traces</span>
0119    <span class="comment">% Apply the time corrections in the lag matrix to the trigger times. This</span>
0120    <span class="comment">% will result in highly correlated traces being well aligned. Plot the</span>
0121    <span class="comment">% results as a shaded waveform plot.</span>
0122    
0123    c = <a href="adjusttrig.html" class="code" title="function c = adjusttrig(c,varargin)">adjusttrig</a>(c,<span class="string">'MIN'</span>,1);
0124    <a href="plot.html" class="code" title="function plot(c,varargin)">plot</a>(c,<span class="string">'sha'</span>);
0125    <a href="set.html" class="code" title="function c = set(c, prop_name, val)">set</a>(gcf,<span class="string">'Position'</span>,[50 50 700 400]);
0126    
0127    
0128    <span class="comment">%% hierarchical cluster tree</span>
0129    <span class="comment">% Plot a hierarchical cluster tree relationship (denrogram) between traces.</span>
0130    <span class="comment">% Plot reorders traces such that they correspond with the ordering of</span>
0131    <span class="comment">% traces on the cluster tree.</span>
0132    
0133    c = <a href="linkage.html" class="code" title="function c = linkage(c,varargin);">linkage</a>(c);
0134    <a href="plot.html" class="code" title="function plot(c,varargin)">plot</a>(c,<span class="string">'den'</span>);
0135    close(gcf) <span class="comment">%NOTE: why is this closed?</span>
0136    <a href="set.html" class="code" title="function c = set(c, prop_name, val)">set</a>(gcf,<span class="string">'Position'</span>,[50 50 600 400]);
0137    
0138    
0139    <span class="comment">%% Event clusters</span>
0140    <span class="comment">% Trim the cluster tree relationship into discrete clusters of events. Subset</span>
0141    <span class="comment">% just the events of the largest cluster.</span>
0142    
0143    c = <a href="cluster.html" class="code" title="function c=cluster(c,varargin)">cluster</a>(c,.8);
0144    index = <a href="find.html" class="code" title="function index = find(c,varargin)">find</a>(c,<span class="string">'CLUST'</span>,1);
0145    c1 = <a href="subset.html" class="code" title="function c = subset(c,index)">subset</a>(c,index);
0146    <a href="plot.html" class="code" title="function plot(c,varargin)">plot</a>(c1,<span class="string">'wig'</span>);
0147    <a href="set.html" class="code" title="function c = set(c, prop_name, val)">set</a>(gcf,<span class="string">'Position'</span>,[50 50 700 400]);
0148    
0149    
0150    <span class="comment">%% Coverting waveform and correlation objects</span>
0151    <span class="comment">% Inside the CORRELATION object, waveforms are stored as WAVEFORM objects.</span>
0152    <span class="comment">% It is possible to extract and then reinsert waveforms. This is use for</span>
0153    <span class="comment">% carrying out trace manipulations that do not exist in the CORRELATION</span>
0154    <span class="comment">% toolbox. Be aware if reinserting waveforms that it is possible to</span>
0155    <span class="comment">% manipulate waveforms in ways that may be incompatible with the</span>
0156    <span class="comment">% correlation object, removing waveforms, for example, or altering</span>
0157    <span class="comment">% timestamps.</span>
0158    
0159    w  = <a href="waveform.html" class="code" title="function w = waveform(c,varargin)">waveform</a>(c1);
0160    <span class="keyword">for</span> n = 1:numel(w)
0161       w(n) = w(n).^2 .* <a href="sign.html" class="code" title="function c = sign(c,varargin);">sign</a>(w(n));
0162    <span class="keyword">end</span>
0163    c2 = <a href="correlation.html" class="code" title="function c = correlation(varargin)">correlation</a>(c1,w);
0164    
0165    
0166    <span class="comment">%% Sign traces</span>
0167    <span class="comment">% SIGN effectively removes the ampltiude information from traces. In some</span>
0168    <span class="comment">% cases the can improve correlations in the presence of large amplitude</span>
0169    <span class="comment">% transients.</span>
0170    
0171    c2 = <a href="sign.html" class="code" title="function c = sign(c,varargin);">sign</a>(c1);
0172    <a href="plot.html" class="code" title="function plot(c,varargin)">plot</a>(c2,<span class="string">'wig'</span>,.3);
0173    <a href="set.html" class="code" title="function c = set(c, prop_name, val)">set</a>(gcf,<span class="string">'Position'</span>,[50 50 700 400]);
0174    
0175    
0176    <span class="comment">%% Stack traces</span>
0177    <span class="comment">% Crop, normalize and stack events. The stack is appended as an additional</span>
0178    <span class="comment">% traces at the bottom. The first NORM call is to ensure that each trace is</span>
0179    <span class="comment">% given equal weight in the stack. The second NORM call is to normalize the</span>
0180    <span class="comment">% new trace stack appended to the end. STACK does not, by default, divide</span>
0181    <span class="comment">% the summation by the number of traces.</span>
0182    c1 = <a href="crop.html" class="code" title="function c = crop(c,varargin)">crop</a>(c1,-4,9);
0183    c1 = <a href="norm.html" class="code" title="function c = norm(c,varargin)">norm</a>(c1);
0184    c1 = <a href="stack.html" class="code" title="function c = stack(c,varargin)">stack</a>(c1);
0185    c1 = <a href="norm.html" class="code" title="function c = norm(c,varargin)">norm</a>(c1);
0186    
0187    
0188    <span class="comment">%% Find residual waveform</span>
0189    <span class="comment">% Subtract the stacked waveform from all other traces. The final trace is</span>
0190    <span class="comment">% zeroed out because it was subtracted from itself (the stack).</span>
0191    
0192    c2 = <a href="norm.html" class="code" title="function c = norm(c,varargin)">norm</a>(c1);
0193    c2 = <a href="minus.html" class="code" title="function c = minus(c,varargin)">minus</a>(c2);
0194    <a href="plot.html" class="code" title="function plot(c,varargin)">plot</a>(c2,<span class="string">'raw'</span>,.5)
0195    <a href="set.html" class="code" title="function c = set(c, prop_name, val)">set</a>(gcf,<span class="string">'Position'</span>,[50 50 700 400]);
0196    
0197    
0198    <span class="comment">%% Interferogram</span>
0199    <span class="comment">% Calculate the correlation and lag values on narrow time windows within</span>
0200    <span class="comment">% each trace relative to a master event. By default, the final trace is</span>
0201    <span class="comment">% used as the master event, which in this case is the trace stack. Both the</span>
0202    <span class="comment">% maximum correlations and the lag times can be plotted behind a wiggle</span>
0203    <span class="comment">% trace plot, or they can be exported as matrices. This can be a</span>
0204    <span class="comment">% computationally intensive routine. Feedback is given to show progress</span>
0205    <span class="comment">% through the calculation. See HELP CORRELATION/PLOT for an explanation of</span>
0206    <span class="comment">% the lag interferogram color scale.</span>
0207    
0208    c1 = <a href="xcorr.html" class="code" title="function c=xcorr(c,varargin)">xcorr</a>(c1,[1 3]);       <span class="comment">% align traces on the initial wavelet</span>
0209    c1 = <a href="adjusttrig.html" class="code" title="function c = adjusttrig(c,varargin)">adjusttrig</a>(c1);        <span class="comment">%     &quot;     &quot;</span>
0210    c1 = <a href="interferogram.html" class="code" title="function [c,t,i,CC,LL] = interferogram(c,varargin)">interferogram</a>(c1);
0211    <a href="plot.html" class="code" title="function plot(c,varargin)">plot</a>(c1,<span class="string">'int'</span>,1,<span class="string">'corr'</span>);    <span class="comment">% plot the correlation value interferogram</span>
0212    <a href="set.html" class="code" title="function c = set(c, prop_name, val)">set</a>(gcf,<span class="string">'Position'</span>,[50 50 700 400]);
0213    <a href="plot.html" class="code" title="function plot(c,varargin)">plot</a>(c1,<span class="string">'int'</span>,1,<span class="string">'lag'</span>,.01);    <span class="comment">% plot the lag value interferogram</span>
0214    <a href="set.html" class="code" title="function c = set(c, prop_name, val)">set</a>(gcf,<span class="string">'Position'</span>,[50 50 700 400]);
0215    
0216    
0217    <span class="comment">%% Occurence plot</span>
0218    <span class="comment">% Display stacked traces for the 10 largest clusters and plot them against</span>
0219    <span class="comment">% the time history of the events.</span>
0220    
0221    c = <a href="crop.html" class="code" title="function c = crop(c,varargin)">crop</a>(c,-3,10);
0222    <a href="plot.html" class="code" title="function plot(c,varargin)">plot</a>(c,<span class="string">'occurence'</span>,1,1:10);
0223    <a href="set.html" class="code" title="function c = set(c, prop_name, val)">set</a>(gcf,<span class="string">'Position'</span>,[50 50 700 400]);
0224    
0225    
0226    <span class="comment">%% Overlay traces</span>
0227    <span class="comment">% Plot all traces from the largest cluster together with the stack of</span>
0228    <span class="comment">% the traces.</span>
0229    
0230    index = <a href="find.html" class="code" title="function index = find(c,varargin)">find</a>(c,<span class="string">'CLUST'</span>,1);
0231    <a href="plot.html" class="code" title="function plot(c,varargin)">plot</a>(c,<span class="string">'overlay'</span>,1,index);
0232    <a href="set.html" class="code" title="function c = set(c, prop_name, val)">set</a>(gcf,<span class="string">'Position'</span>,[50 50 700 200]);
0233    
0234    correlationVariables.c1 = c1;
0235    correlationVariables.c2 = c2;
0236    correlationVariables.corr = corr;
0237    correlationVariables.corr_matrix = corr_matrix;
0238    correlationVariables.index = index;
0239    correlationVariables.n = n;
0240    correlationVariables.w = w;
0241   
0242 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Wed 12-Oct-2016 17:36:30 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>