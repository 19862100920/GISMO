<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
					"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta name="description" content="information about the Waveform class, within the waveform suite for MATLAB.  The waveform suite is meant to assist in the importing and handling of evenly sampled time series data, such as seismic data."/>
<meta name="keywords" content="waveform suite, MATLAB, Antelope, WINSTON, SAC, Seisan, guide, seismology, tutorial, waveform class" />
<title>Waveform Suite for Matlab: Working with the Waveform Class</title>
<link type="text/css" rel="stylesheet" href="wavesuite.css"/>
</head>

<body>
<div id="allcontent">
  <a name="top"/>
<div id="header">
    <p><img id = "photo" src="images/lilwave.gif" alt="waveform icon" /></p>
<a name="define">
<h1>The <em>Waveform</em> class</h1>
<p>Waveforms are the workhorse of the waveform suite.  They contain 
information about the station, the data, the units, historical information, 
and any number of user-defined fields. Waveform takes care of the record 
keeping associated with the manipulation of its data.</p>
</div> <!-- header -->
<div id="main">
<p><strong>Welcome</strong> to the online documentation and tutorial 
      pages for the waveform suite for MATLAB!</p>
      <p>
        Within these pages you'll find information to get you up and 
        running with the waveform suite. The waveform suite is a collection
        of matlab classes that work together to speed up and simplify the 
        import and manipulation of time-series data.  Originally conceived
        to manipulate seismic data, it may be applied to any regularly 
        sampled time-series data that is associated with a location.
      </p>
        <p>The waveform object:</p>
        <ul>
          <li>makes playing with data <i>easier</i> by automating the 
          tedious aspects of data manipulation</li>
          <li>makes programs more <i>stable</i> by ensuring proper data typing</li>
          <li>makes code more <i>portable</i> by reading multiple formats and functioning on multiple systems</li>
          <li>makes troubleshooting <i>faster</i> by providing more detailed messages and warnings </li>
        </ul>
		<p>The README can be found on my <a href="download.html">downloads</a> page.</p>

<!-- CREATING WAVEFORMS -- --------------------------- -->
<a name="create"></a>
<h2>Creating a Waveform </h2>
<p>Generic information about the waveform constructor class</p>
<dl class="functions">

<dt>w = waveform</dt>
 <dd>creates a blank waveform. You get a waveform with a blank station
      and channel, and a location and network of '--', a frequency of
      <i>NaN</i> Hz, and a start time equal to antelope's default start
      time '1/1/1970 00:00:00'. Changing any or all of this waveform's
    information can be done through the <code>set</code> function.</dd>
    <dt>w = waveform(station, component, freq, start, data)</dt>
<dd>manually puts together a waveform object using each of these specified values. This is 
designed to allow you to create a waveform based on data from other places or from data that 
you've conjured up yourself.  Additional values can be added/changed through the <code>set</code>
 function.</dd>
	
	
	
	<dt>w =waveform(datasource, scnlobject, startTime,endTime)</dt>
<dd>
Retrieves waveform(s) from the selected datasource, returning all waveforms that are described 
by the <a href="scnlobject.html">scnlobject</a> list (ie, matching the correct 
station/channel/network/location parameters), for the times requested. The 
<a href="datasource.html">datasource</a> object allows waveform to retrieve 
from any one of a number of sources: 
      <a href="datasource.html#create_antelope">Antelope</a> or 
      <a href="datasource.html#create_winston">Winston</a> databases, 
	  <a href="datasource.html#create_sac">SAC</a>
      or <a href="datasource.html#create_seisan">SEISAN</a>
    files, or even waveforms saved as <a href="datasource.html#create_file">.mat</a> files.</p></dd>
</dl>
<h3>What, exactly, is in a waveform object?</h3>
<p>The beauty of object-oriented program is that it really doesn't matter how 
the information is stored, so long as it is accessible in a standard way</p>
<p>A waveform object contains only the following information:</p>
<ul>
    <li>Scnlobject (station, channel, network, and location)</li>
    <li>Frequency</li>
    <li>Start time</li>
    <li>Data samples</li>
    <li>History</li>
    <li>User-defined Fields</li>
</ul>
<p>You can use the <code>struct(waveform)</code> command to return the 
absolutely raw data and see for yourself... struct returns a structure 
based on the listed object.</p>
<p>However, much more information can be asked of it via the waveform/get routine.</p>  
<!-- ACCESSING WAVEFORMS -- --------------------------- -->
<a name="access"></a>
<h2>Accessing</h2>

<p>To retrieve information from waveforms, use the <b>get</b> method. </p>
<p><code>value = get(SCNLobject, 'PropertyToGet')</code></p>
<p>Here is a sample of the types of data / derived data that can be retrieved;</p><ul>
    <li>get(w,'station') - returns the station call-sign. ie. VNSS, OKCF, etc...</li>
    <li>get(w,'freq') - returns the frequency of the sample. this is an average sample rate</li>
    <li>get(w,'start_str') - provides a readable date associated with this waveform's start time</li>
    <li>get(w,'start_antelope') - returns the start time in Antelope time. That is, the number of seconds elapsed since 1/1/1970</li>
    <li>get(w,'data') - returns the vector of seismic data, same as <code>double(data)</code></li>
    <li>get(w,'nyq') - returns the nyquist frequency of the sample</li>
    <li>get(w,'data_length') - gives you the number of samples in your data set</li>
    <li>get(w,'duration') - gives you the time-span of your data set</li>
</ul><p><i>for additional valid properties, type <code>help waveform/get</code></i></p>
<p>For a single waveform, the <b>get</b> method will return the requested property .  For 
multiple waveforms, get will return either a numeric or cell array with the requested 
information.  </p>

<!-- MODIFYING WAVEFORMS -- --------------------------- -->
<h2><a name="modify"></a>Making direct changes to your waveform</h2>

<p>Using set, you can change the values of your waveform.  The general form of set is:</p>

<p>modifiedWave = set(originalWave, 'PropertyToChange', newValue)</p>
<p>If <i>originalWave</i> contains an array of waveforms, then that property 
is changed for all waveforms.  Remember, the originalWave is unchanged until it is assigned the result.</p>


<a name="functions"></a>
<h2>Additional functions of note</h2>
<p>Here are additional functions to be aware of:</p>
<dl class="functions">
<dt>Plot</dt><dd>plot one or more waveforms, labeling the graph as well as taking account of units
<ol class="specificexample"><li>h = plot(waveform)<br/>
    Plots a waveform object, handling the title and axis labeling.  The
    output parameter h is optional.  If used, the handle to the waveform
    plots will be returned.  These can be used to change properties of the
    plotted waveforms.</li>
 
    <li>h = plot(waveform, ...)<br/>
    Plots a waveform object, passing additional parameters to matlab's PLOT
    routine.</li>
 
    <li>h = plot(waveform, 'xunit', xvalue, ...)<br/>
    sets the xunit property of the graph, which is used to determine how
    the times of the waveform are interpereted.  Possible values for XVALUE
    are 'seconds', 'minutes', 'hours', 'days', 'day_of_year', 'date'.
 
    For multiple waveforms, specifying XUNITs of 'seconds', 'minutes', 'hours' will
    cause all the waveforms to be plotted starting at 0.  An XUNIT of
    'date' will force all waveforms to plot starting at their starttimes.
 
    the default XUNIT is seconds</li></ol>
   <p>For the following examples assume:</p>
   <p class="comment">W is a 10-minute long waveform starting:04/02/2005 01:00:00<br/>% W2 is a 1-minute long waveform (same station) starting: 04/02/2005 01:05:00</p>
<p>PLOT EXAMPLE 1:</p><blockquote class="matlabsession">
    <p class="comment">This example plots the waveforms at their absolute times...</p><p class="user">plot(W,'xunit','date');<span class="comment">plots the waveform in blue</span><br/>
    hold on;<br/>
    h = plot(W2,'xunit','date', 'r', 'linewidth', 1);<br/>
          <span class="comment">%plots your other waveform in red, and with a wider line</span></p>
 </blockquote>
  <p>PLOT EXAMPLE 2:</p><blockquote class="matlabsession">
    <p class="comment">% This example plots the waveforms, starting at time 0</p>
    <p class="user">plot(W);<span class="comment">plots the waveform in blue with seconds on the x axis</span><br/>
    hold on;<br/>
    plot(W2,'xunit','seconds', 'color', [.5 .5 .5]);<span class="comment">plots your other<pre>                                        % waveform, starting in unison
                                        % with the prev waveform, then
                                        % change the color of the new
                                        % plot to grey (RGB)</pre></span></blockquote>
 
   <p>For a list of properties you can set (such as color, linestyle, etc...)
   type get(h) after plotting something.</p>
 
   <p>Also, now Y can be autoscaled with the property pair: 'autoscale',true
   although it only works for single waveforms...</p>

<p>if the wave parameter is a vector of waveform objects, then plot will plot them all on the same axis, and to scale. You can also pass formatting comands to the plot function.</p>
<blockquote class="matlabsession">
<p class="user">h = plot(wave,'xunit','date', 'r.-', 'linewidth', 1);</p></blockquote><p>
This plots your other waveform in a red dash-dotted line, and makes the line thicker.</p>
<dt>demean</dt><dd><p>remove the voltage offset from the data.  This basically just subtracts the mean of the data. One nice feature is that this is designed to work with arrays of waveform objects.</p>
<blockquote class="matlabsession">
<p class="user">fixedWave = demean(VNSS20050403PMwave);</p></blockquote></dd>
<dt>mean</dt><dd><p>figures out the average (mean) of the waveform's data, then returns that value as a scalar.</p>
<blockquote class="matlabsession">
<p class="user">avgVoltageOffset = demean (mySampleWave);</p></blockquote><p>
You can also pass this function an array of waveforms, and it will return a same-shaped array of mean values.</p></dd>
<dt>hilbert<img class="inline_ex" src="images/hilbert_ex.gif" alt ="Hilbert Example"/></dt><dd>returns the real part of a hilbert transform based on the waveform's data. </br>
This is great for generating envelopes.</p>
<blockquote class="matlabsession">
<p class="user">
hilbert_envelope = hilbert(mySampleWave);</p></blockquote></dd>
<dt>stack</dt><dd>combines waveforms.  If you have waveform objects with similar sample rates and durations, you can stack their waveforms.

<p>This clones the first waveform in the array, (station ID, start time, etc) and then sums the data from each of the included waveforms. This does no error checking, so it will crash if your arrays don't overlap. You'll definitely want to change the header information for the waveform using the get command after successfully stacking things, so that it becomes obvious that the data is stacked.</p>
<blockquote class="matlabsession">
<p class="comment">In this example, veni1 .. veni4 are waveform objects</p>
<p class= "user">w = [veni1 veni2 veni3 veni4];<br/>
mystack = stack(w);<br/>
mystack = set(mystack,'STATION','VNSS_Stack');</p></blockquote>
</dd>
<dt>extract</dt><dd>returns a waveform consisting of a subset of data from within another waveform array.
<p>Let's start with a waveform that was loaded like so:</p>
<blockquote class="matlabsession">
<p class="user">bigWave = waveform('OKCF','SHZ','10/5/2005 12:00','10/5/2005 24:00');</p></blockquote><p>
Twelve hours of data... that's an awful big wave to have to deal with, especially at a 100Hz sample rate. Maybe I'd like to work with the 14:00 - 15:00 subsection... You could go back to the database and reload. But, maybe you've done some funky filtering or something else that you don't want to have to repeat. Here are two ways to do that:</p>
<blockquote class="matlabsession">
<p class="user">subWave = extract(bigWave,'TIME','10/5/2005/14:00','10/5/2005 15:00');</p><p class="user">subWave = extract (bigWave,'Index&Duration', 100 * 60 * 60 * 2, '1:00');</p></blockquote>
Where 100 * 60 * 60 * 2 is the expected offset of your second hour of data...</p>
</dd>
<dt>fix_data_length</dt><dd>sets the data from multiple waveforms to the same length,

Several functions in matlab require using data of the same length, and this function will do that. By default, it will find the longest waveform, and then pad all the others with zero to make them match up.</p>
<blockquote class="matlabsession">
<p class="user">myWaves = fix_data_length(myWaves);</p></blockquote>
</dd>
</dl>
<p></p>
</div> <!-- main -->
<a name="example"/>
<div id="examples">
<h2>Examples</h2>
  <p>Several examples can be checked out from</p>
  <ul>
      <li>
      <a href="waveform_suite_example_index.html">example index (several)</a></li>
      <li><a href="wave_example1.html">another example (w/ antelope)</a></li>
  </ul>

<hr/><p>Please send feedback to: <i> celso &lt;at&gt; gi &lt;dot&gt; alaska &lt;dot&gt; edu </i></p>
</div> <!-- examples -->
  <div id="navigation">
  <p><span class="suite_title">Waveform Suite</span><br/> for MATLAB</p><p>
    <a href="download.html"><b>download</b></a></p><hr/>
	
	<div class="here">
	<p><b>waveform</b></p>
	<ul><li><a href="#define">Intro</a></li>
	<li><a href="#create">Creating</a></li>
	<li><a href="#access">Accessing</a></li>
	<li><a href="#modify">Modifying</a></li>
	<li><a href="#functions">Functions</a></li>
	<li><a href="#example">Examples</a></li>
	</ul>
	</div>
	<p><a href="scnlobject.html">scnlobject</a><br/>
	<a href="datasource.html">datasource</a><br/>
	<a href="filterobject.html">filterobject </a><br/>
	<a href="spectralobject.html">spectralobject</a></p>
	<hr/>
	<p><a href="../feline_example/tutorial_and_code_frameset.htm">object tutorial</a></p>
	
	<hr/><p> <a href="waveform_suite_example_index.html">Waveform Suite Examples</a>
  </p><hr/>
  <p><a href="../../index.html">Celso's homepage</a></p>
   <!-- CSS & XHTML validation approval -->
<p>
    <a href="http://validator.w3.org/check?uri=referer"><img
        src="http://www.w3.org/Icons/valid-xhtml10-blue"
        alt="Valid XHTML 1.0 Transitional" height="31" width="88" /></a>
  </p>
  <p>
<a href="http://jigsaw.w3.org/css-validator/check/referer">
    <img style="border:0;width:88px;height:31px"
        src="http://jigsaw.w3.org/css-validator/images/vcss-blue"
        alt="Valid CSS!" />
</a>
</p>
  </div> <!-- navigation -->
  </div> <!-- allcontent -->
  <script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-8415966-1");
pageTracker._trackPageview();
} catch(err) {}</script>
</body>

</html>


