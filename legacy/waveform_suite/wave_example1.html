<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd"><html><head><meta http-equiv="Content-Type" content="text/html; charset=us-ascii" /><meta name="description" content="Working examples of the waveform suite for MATLAB" /><meta name="keywords" content="waveform suite, MATLAB, Antelope, WINSTON, SAC, Seisan, guide, seismology, tutorial, waveform class" /><title>Examples of the waveform suite in action (old)</title><link type="text/css" rel="stylesheet" href="wavemanuals.css"></head><body>  <a name="top"/>  <div id="top_navigation" class="navButtons">	<p><a href="../../index.html">home</a> |	<a href="waveform.html">waveform</a> | 	<a href="scnlobject.html">scnlobject</a> | 	<a href="datasource.html">datasource</a> | 	<a href="filterobject.html">filterobject </a>| 	<a href="spectralobject.html">spectralobject</a> | 	<a href="../feline_example/tutorial_and_code_frameset.htm">object tutorial</a>    <br/><a href="waveform_suite_example_index.html">Examples of my waveform suite in use</a></p>  </div><hr/><h2>How do I use the waveform suite in a real life situation?</h2><p>Below, I'll have examples. The <strong><code>BOLD</code></strong> computer input are things that I typed, and the <code>other computer-type</code>  is what the computer spit out. sometimes you'll see '<code>&gt;&gt;</code>', which is the MATLAB command prompt... don't type that in. <em>%Italics</em> are comments...</p> <p>Now, because (on this computer) I almost always access the data through our Antelope database of continuous traces, I have a <i>datasource</i> pre-definedin a matlab script (common_datasources.m).  This script can either be loaded at startupvia startup.m, can be loaded at any time through <code>load(common_datasources.m)</code>, or can be called within any function that requires database access.</p>Here's an example of my version of common_datasources.m:<code><pre class="block_code">%% define commonly used datasources% antelope continuous waveform databaseds_antelope = datasource('antelope',...  '/iwrun/op/db/archive/archive_%04d/archive_%04d_%02d_%02d',...  'year','year','month','day');  % collection of unprocessed waveforms, stored locally as .mat filesds_rawfiles = datasource('file',...  '/home/celso/okmokraw/%04d/%02d/OkmokRaw_%04d_%02d_%02d_%s.mat',...  'year','month','year','month','day','station');% a winston server (not currently available)ds_winston = datasource('winston','mylocalwaveserver.giseis.alaska.edu',12345);%%  predefine the Okmok stations used for my raw files% All these definitions may be overkill, but I use them A LOT!!OKsta.sp.ehz = scnlobject ({'OKAK','OKCF','OKER','OKRE','OKSP','OKTU','OKWE','OKWR'},'EHZ','AV');OKsta.sp.shz = set(OKsta.sp.ehz,'channel','SHZ');OKsta.bb.hz = scnlobject({'OKCE','OKSO','OKFG','OKCD'},'BHZ','AV');OKsta.bb.hn = set(OKsta.bb.hz,'channel','BHN');OKsta.bb.he = set(OKsta.bb.hz,'channel','BHE');OKsta.bb.all = [OKsta.bb.hz, OKsta.bb.hn, OKsta.bb.he];OKsta.all.current = [OKsta.sp.ehz, OKsta.bb.all];OKsta.all.oldstyle = [OKsta.sp.shz, OKsta.bb.all];</code></pre><p>I just checked the seismology log, and see Tanja's note:</p><hr /><p><b>Katmai</b>: another swarm of very local events on station KVT ("atmospheric events"?) lasting about 6 hrs; see attached example.</p><p>  <img src="images/1109704061_2_33.gif" width="489" height="293"></p><hr /><p>Curious. I want to take a closer look at these events... therefore, I start MATLAB...</p><p>Since I have a valid datasource, I can just use that.<br/>  I don't have a scnlobject for this station, so I'll create that:</p><p><code>kvt = scnlobject('KVT','SHZ')</code></p><pre class="block_code">kvt =    station: KVT   channel: SHZ   network: --  location: --</pre><p>Now, I'll load the waveform from the antleope database</p><p><code>w = waveform(ds_antelope,kvt,'3/1/2005 15:00:00','3/1/2005 15:10:00');</code></p><p>Then I have a waveform as follows:</p><pre class="block_code">w =    station:    KVT               network: AV   channel:    SHZ              location: --     start: 01-Mar-2005 15:00:00.010            duration(00:10:00.000)      data: 60000 samples      freq: 100.000000 Hz     units: nm / sec    With misc fields...    * HISTORY: [10x2] cell object    * NET: -    * CALIBRATION_APPLIED: YES    * CALIB: 5.491</pre><p>I plot it up...</p><p><code>plot(w)</code></p><p><img src="images/w_plot.gif" width="560" height="420"></p><p>hmm... OK. so? Let me get the spectra on that using the default spectral object.</p><p><code>specgram2(spectralobject,w);</code></p><p><img src="images/w_specgram.gif" width="448" height="336" /></p><p>Hmm. energy everywhere, and the events have energy into higher bands. Let me try to get a better frequency content by using a higher nfft. I'll also smooth the picture out by taking spectral samples every 1/2 second. Oh, and I also want to both look into higher frequencies and limit the dB range to reign in the saturated portion of the spectra.</p><p> I accomplish this by defining a specific spectralobject:</p><p><code>s = spectralobject(2048,1998,10,[50 100])</code></p><pre class="block_code">s =     nfft: 2048    over: 1998 freqmax: 10  dBlims: [50 100]</pre><p>lets generate another spectrogram. </p><p><code>specgram2(s,w,0)</code></p><p><img src="images/w_specgram_2.gif" width="448" height="336" /></p><p>Energy still goes off the displayed spectrum, so I want to try again, this time with a much higher frequencyMax (20).</p><p><code>specgram2(set(s,'freqmax',20), w, 0)</code></p><p><img src="images/w_specgram_high.gif" width="448" height="336"></p><p>The zero that trails the above command tells specgram to reuse the entire plot window. Otherwise it jams the spectrogram into the currently active axis. (Try it without the zero, and you'll <a href="images/w_specgram_dbl.gif" target="_blank">see what I mean</a>). Without the zero, you can create more complicated figures (here is just an ugly example of a  <a href="images/w_specgram_bunch.gif">subplot</a> ). </p><p>speaking of subplots, Lets take a closer look at one of the events. Here are a few consecutive commands...</p><p><code>&gt;&gt;</code><strong><code>w2 = waveform(ds_antelope,kvt,'3/1/2005 15:06:40', '3/1/2005 15:07:30')</code></strong></p><pre>w2 =    station:    KVT               network: AV   channel:    SHZ              location: --     start: 01-Mar-2005 15:06:40.010            duration(00:00:50.000)      data: 5000 samples      freq: 100.000000 Hz     units: nm / sec    With misc fields...    * HISTORY: [10x2] cell object    * NET: -    * CALIBRATION_APPLIED: YES    * CALIB: 5.491</pre><pre>&gt;&gt; <code>figure<em> % create a new figure for plotting</em></code> &gt;&gt; <code>subplot(2,1,1) <em>% divide the plot into two rows, one column, use the top one.</em></code>&gt;&gt; <code>plot(w2) <em>%plot my raw waveform</em></code>&gt;&gt; <code>f = filterobject <em>%create a default filterobject</em> </code> f =       type: B (Bandpass)    cutoff: 0.8           5 Hz     poles: 2&gt;&gt; <code>filteredwave = filtfilt(f,w2) <em>%filter the w2 waveform with the above filter</em> </code> filteredwave =    station:    KVT               network: AV   channel:    SHZ              location: --     start: 01-Mar-2005 15:06:40.010            duration(00:00:50.000)      data: 5000 samples      freq: 100.000000 Hz     units: nm / sec    With misc fields...    * HISTORY: [11x2] cell object    * NET: -    * CALIBRATION_APPLIED: YES    * CALIB: 5.491&gt;&gt; <code>bothwaves = [w2 filteredwave] <em>% create a vector w/ both unfiltered and filtered waveforms</em></code> bothwaves =  [1x2] waveform object with fields:     station     channel     start     freq     data     units   with common fields...    'CALIB'    'CALIBRATION_APPLIED'    'HISTORY'    'NET'&gt;&gt; <code>subplot(2,1,2) <em>%  activate the second (bottom) plot area</em></code>&gt;&gt; <code>plot(bothwaves,'nm') <em>% plot the two waves on the same axis, with a different scale</em></code></pre><p><img src="images/overlappedplots.gif" width="640" height="461"></p><p>From the bottom plot, I can see that the second arrival (at about 14 seconds) has more energy in the 0.8 to 5.0 hz range. </p><p>Here endeth the demo. for more information, feel free to contact me.</p><p>Cheers! <br/>- <em>Celso </em></p></body></html>