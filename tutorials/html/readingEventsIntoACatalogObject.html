
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>Reading events into a Catalog object</title><meta name="generator" content="MATLAB 8.4"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2015-10-23"><meta name="DC.source" content="readingEventsIntoACatalogObject.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>Reading events into a Catalog object</h1><!--introduction--><p>GISMO can read events from many different earthquake catalog file formats (e.g. Seisan, Antelope) and data sources (e.g. IRIS DMC) using the readEvents() function.</p><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">The readEvents() function</a></li><li><a href="#6">Reading events from IRIS DMC</a></li><li><a href="#13">Readings events from an Antelope database</a></li><li><a href="#19">Reading events from a Seisan database</a></li></ul></div><h2>The readEvents() function<a name="1"></a></h2><p>The readEvents() function is used to read event metadata (origin time, lon, lat, depth, mag etc.) from a variety of catalog data sources and file formats into a Catalog object.</p><p>Usage:       catalogObject = readEvents(dataformat, 'param1', <i>value1</i>, ...                                                   'paramN', <i>valueN</i>)</p><p>dataformat may be:</p><div><ul><li>'iris' (for IRIS DMC, using irisFetch.m),</li><li>'antelope' (for a CSS3.0 Antelope/Datascope database)</li><li>'seisan' (for a Seisan database with a REA/YYYY/MM/ directory structure)</li></ul></div><p>The name-value parameter pairs supported are the same as those supported by irisFetch.Events(). Currently these are:</p><div><ul><li><i>startTime</i></li><li><i>endTime</i></li><li><i>eventId</i></li><li><i>fetchLimit</i></li><li><i>magnitudeType</i></li><li><i>minimumLongitude</i></li><li><i>maximumLongitude</i></li><li><i>minimumLatitude</i></li><li><i>maximumLatitude</i></li><li><i>minimumMagnitude</i></li><li><i>maximumMagnitude</i></li><li><i>minimumDepth</i></li><li><i>maximumDepth</i></li></ul></div><p>And the two convenience parameters:</p><div><ul><li><i>radialcoordinates</i> = [ <i>centerLatitude</i>, <i>centerLongitude</i>, <i>maximumRadius</i> ]</li></ul></div><div><ul><li><i>boxcoordinates</i> = [ <i>minimumLatitude</i> <i>maximumLatitude</i> <i>minimumLongitude</i> <i>maximumLongitude</i> ]</li></ul></div><h2>Reading events from IRIS DMC<a name="6"></a></h2><p>To load events into a Catalog object we use the readEvents function. The first argument is the data source/format - when this is given as 'iris', readEvents uses the irisFetch.m program to retrieve event data via the IRIS webservices. To narrow down our data search we can give readEvents any name-value parameter pairs supported by irisFetch.</p><p>In this example we will use readEvents to retrieve all events at IRIS DMC with a magnitude of at least 7.9 between year 2000 and 2014 (inclusive):</p><pre class="codeinput">catalogObject = readEvents(<span class="string">'iris'</span>, <span class="string">'minimumMagnitude'</span>, 7.9, <span class="string">'starttime'</span>, <span class="string">'2000-01-01'</span>, <span class="string">'endtime'</span>, <span class="string">'2015-01-01'</span>)
</pre><pre class="codeoutput">fetching...


26 events found *************

parsing into MATLAB structures

catalogObject = 

       date         time        lon        lat      depth    mag    magtype       etype    
    __________    ________    _______    _______    _____    ___    _______    ____________

    2014/06/23    20:53:09     178.74     51.849      109    7.9    'MWW'      'earthquake'
    2014/04/01    23:46:47    -70.769     -19.61       25    8.2    'MWW'      'earthquake'
    2013/05/24    05:44:49     153.28     54.874    608.9    8.3    'MW'       'earthquake'
    2013/02/06    01:12:27     165.14    -10.738     28.7      8    'MW'       'earthquake'
    2012/04/11    10:43:10     92.428     0.7675     21.6    8.2    'MW'       'earthquake'
    2012/04/11    08:38:37     93.014     2.2376     26.3    8.6    'MW'       'earthquake'
    2011/03/11    06:15:37     141.09     36.227     25.4    7.9    'MW'       'earthquake'
    2011/03/11    05:46:23      142.5     38.296     19.7    9.1    'MW'       'earthquake'
    2010/02/27    06:34:13    -72.933    -36.148     28.1    8.8    'MW'       'earthquake'
    2009/09/29    17:48:11    -171.94    -15.512     18.5    8.1    'MW'       'earthquake'
    2008/05/12    06:27:59     103.37     31.064      7.6    7.9    'MW'       'earthquake'
    2007/09/12    23:49:04     100.73    -2.6161       36    7.9    'MW'       'earthquake'
    2007/09/12    11:10:26      101.4    -4.4637     35.5    8.5    'MW'       'earthquake'
    2007/08/15    23:40:58    -76.555    -13.384     41.2      8    'MW'       'earthquake'
    2007/04/01    20:39:56     157.03    -8.4468      9.5    8.1    'MW'       'earthquake'
    2007/01/13    04:23:23      154.5     46.231     22.5    8.1    'MW'       'earthquake'
    2006/11/15    11:14:14     153.21     46.681     12.2    8.3    'MW'       'earthquake'
    2006/06/05    00:50:31     119.08     17.992      124      8    'MS'       'earthquake'
    2006/06/01    18:57:02     120.88     19.054       13    8.4    'MS'       'earthquake'
    2006/05/03    15:26:39    -174.14    -20.163     53.5    7.9    'MW'       'earthquake'
    2006/02/15    18:29:15     121.95      9.624        2    7.9    'mb'       'earthquake'
    2005/03/28    16:09:35     97.113     2.0964       30    8.1    'MW'       'earthquake'
    2004/12/26    00:58:52     95.901     3.4125     26.1    8.2    'MW'       'earthquake'
    2004/12/23    14:59:00     161.58     -49.71       10      8    'MW'       'earthquake'
    2003/09/25    19:50:07     143.87     41.749       33    8.1    'MW'       'earthquake'
    2001/06/23    20:33:09    -73.561    -16.303      2.2    8.3    'MW'       'earthquake'

</pre><p>We have retrieved 26 events. To access any particular property we can use dot notation, as if the object were a structure, e.g.:</p><pre class="codeinput">catalogObject.depth
catalogObject.mag
</pre><pre class="codeoutput">
ans =

  109.0000
   25.0000
  608.9000
   28.7000
   21.6000
   26.3000
   25.4000
   19.7000
   28.1000
   18.5000
    7.6000
   36.0000
   35.5000
   41.2000
    9.5000
   22.5000
   12.2000
  124.0000
   13.0000
   53.5000
    2.0000
   30.0000
   26.1000
   10.0000
   33.0000
    2.2000


ans =

    7.9000
    8.2000
    8.3000
    8.0000
    8.2000
    8.6000
    7.9000
    9.1000
    8.8000
    8.1000
    7.9000
    7.9000
    8.5000
    8.0000
    8.1000
    8.1000
    8.3000
    8.0000
    8.4000
    7.9000
    7.9000
    8.1000
    8.2000
    8.0000
    8.1000
    8.3000

</pre><p>catalogObject is of type "Catalog". etype contains the event type for each of the 26 events. In this case each is just  'earthquake', but when dealing with more diverse dataset, many other etype's are possible. magtype is whatever magnitude type was assigned by the agency that provided the magnitude data.</p><p>Using the methods() function will tell us what operations we can perform on a Catalog object:</p><pre class="codeinput">methods(catalogObject)
</pre><pre class="codeoutput">
Methods for class Catalog:

Catalog      disp         plot         plotprmm     subset       
Event        enum         plot3        save         summary      
bvalue       eventrate    plot_counts  snum         webmap       
combine      hist         plot_time    subclassify  write        

</pre><p>Now we'll do another example - we will get events within 200 km of the great M9.0 Tohoku earthquake that occurred on 2011/03/11. The mainshock parameters are:</p><pre>   Date/Time:  "2011/03/11 05:46:24"
   Longitude:  142.372
   Latitude:   38.297
   Depth:      30 km</pre><p>We will limit our search to 1 day before and after the earthquake:</p><pre class="codeinput">mainshocktime = datenum(<span class="string">'2011/03/11 05:46:24'</span>)
catalogObject = readEvents(<span class="string">'iris'</span>, <span class="keyword">...</span>
            <span class="string">'radialcoordinates'</span>, [38.297 142.372 km2deg(200)], <span class="keyword">...</span>
            <span class="string">'starttime'</span>, mainshocktime - 1, <span class="keyword">...</span>
            <span class="string">'endtime'</span>, mainshocktime + 1);
</pre><pre class="codeoutput">
mainshocktime =

   7.3457e+05

fetching...


1136 events found *************

parsing into MATLAB structures
</pre><p>This returns 1136 earthquakes. Let's get a summary:</p><pre class="codeinput">catalogObject.summary()
</pre><pre class="codeoutput">
Variables:

    date: 1136x10 char

    time: 1136x8 char

    lon: 1136x1 double
        Values:

            min       140.31
            median    142.59
            max       144.63

    lat: 1136x1 double
        Values:

            min       36.517
            median     37.88
            max       40.044

    depth: 1136x1 double
        Values:

            min           0  
            median       25  
            max       149.7  

    mag: 1136x1 double
        Values:

            min       0.1  
            median    4.3  
            max       9.1  
            NaNs        4  

    magtype: 1136x1 cell string

    etype: 1136x1 cell string

</pre><h2>Readings events from an Antelope database<a name="13"></a></h2><p>To load event data from an Antelope/Datascope CSS3.0 database you will need to have Antelope (<a href="http://www.brtt.com/software.html">http://www.brtt.com/software.html</a>) installed, including the Antelope toolbox for MATLAB.</p><p><b>SCAFFOLD: NOTE THAT CURRENTLY NOT USING THE RTDB200903 AT ALL</b></p><p>For the purpose of this exercise we will be using data from Redoubt volcano from 2009/03/20 to 2009/03/23. We will use snippets from two catalogs that are provided with GISMO in Antelope format:</p><div><ul><li>The real-time catalog (rtdb200903).</li><li>The analyst-reviewed offical AVO catalog (avodb200903).</li></ul></div><p>Both catalog segments are included in the "demo" directory. We will now load the official AVO catalog into an Events object:</p><pre class="codeinput">dbpath = demodb(<span class="string">'avo'</span>);
catalogObject = readEvents(<span class="string">'antelope'</span>, <span class="string">'dbpath'</span>, dbpath);
</pre><pre class="codeoutput">Loading data from /Users/thompsong/src/matlab/GISMO/classes/Catalog/demo/antelope/avodb200903
</pre><p>This should load 1441 events. What if we only want events within 20km of Redoubt volcano? There are two ways to do this. The first is the use the radialcoordinates parameter:</p><pre class="codeinput">redoubtLon = -152.7431;
redoubtLat = 60.4853;
maxR = 20.0;
catalogObject = readEvents(<span class="string">'antelope'</span>, <span class="string">'dbpath'</span>, dbpath, <span class="keyword">...</span>
	<span class="string">'radialcoordinates'</span>, [redoubtLat redoubtLon maxR]);
catalogObject.numberOfEvents
</pre><pre class="codeoutput">Loading data from /Users/thompsong/src/matlab/GISMO/classes/Catalog/demo/antelope/avodb200903

ans =

        1441

</pre><p>The second way is to use the 'subset_expression' which the Antelope expression evaluator interprets:</p><pre class="codeinput">redoubtLon = -152.7431;
redoubtLat = 60.4853;
expr = sprintf(<span class="string">'deg2km(distance(lat, lon, %f, %f)) &lt; %f'</span>,redoubtLat, redoubtLon,maxR)
catalogObject = readEvents(<span class="string">'antelope'</span>, <span class="string">'dbpath'</span>, dbpath, <span class="keyword">...</span>
	<span class="string">'subset_expression'</span>, expr);
catalogObject.numberOfEvents
</pre><pre class="codeoutput">
expr =

deg2km(distance(lat, lon, 60.485300, -152.743100)) &lt; 20.000000

Loading data from /Users/thompsong/src/matlab/GISMO/classes/Catalog/demo/antelope/avodb200903

ans =

        1397

</pre><h2>Reading events from a Seisan database<a name="19"></a></h2><p>Here we load events from a Seisan catalog. A Seisan "Sfile" contains all the metadata for 1 event. These Sfiles are stored in a flat-file database structure the path to which is: $SEISAN_TOP/REA/databaseName. Sfiles are organized in year/month subdirectories under this path.</p><p><b>SCAFFOLD: INCLUDE DEMO DATASET FROM MVOE</b></p><p>The following will navigate this where in this case $SEISAN_TOP = '/raid/data/seisan' and the databaseName is MVOE_ which stands for the Montserrat Volcano Observatory Event database. (In Seisan, databaseName is limited to exactly 5 characters).</p><p>This example will load all Sfiles for January 1st, 2000. This is a slow function to run as MATLAB is slow at parsing text files, and there are many events per day in this particular database.</p><pre class="codeinput">catalogObject = readEvents(<span class="string">'seisan'</span>, <span class="keyword">...</span>
    <span class="string">'dbpath'</span>, fullfile(<span class="string">'/raid'</span>,<span class="string">'data'</span>,<span class="string">'seisan'</span>,<span class="string">'REA'</span>,<span class="string">'MVOE_'</span>), <span class="keyword">...</span>
	<span class="string">'starttime'</span>, <span class="string">'2000/01/01'</span>, <span class="keyword">...</span><span class="comment">.</span>
	<span class="string">'endtime'</span>, <span class="string">'2000/01/02'</span>)
</pre><pre class="codeoutput error">Error using readEvents&gt;seisan (line 632)
The value of 'startTime' is invalid. It must satisfy the function: isnumeric.

Error in readEvents (line 151)
            self = seisan(varargin{:});

Error in readingEventsIntoACatalogObject (line 173)
catalogObject = readEvents('seisan', ...
</pre><p class="footer"><br><a href="http://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2014b</a><br></p></div><!--
##### SOURCE BEGIN #####
%% Reading events into a Catalog object
% GISMO can read events from many different earthquake catalog file formats
% (e.g. Seisan, Antelope) and data sources (e.g. IRIS DMC) using the
% readEvents() function.

%% The readEvents() function
% The readEvents() function is used to read event metadata (origin time, 
% lon, lat, depth, mag etc.) from a variety of catalog data sources and
% file formats into a Catalog object. 
%
% Usage:
%       catalogObject = readEvents(dataformat, 'param1', _value1_, ...
%                                                   'paramN', _valueN_)
% 
% dataformat may be:
%%
%
% * 'iris' (for IRIS DMC, using irisFetch.m), 
% * 'antelope' (for a CSS3.0 Antelope/Datascope database)
% * 'seisan' (for a Seisan database with a REA/YYYY/MM/ directory structure)
%

%%
% The name-value parameter pairs supported are the same as those supported
% by irisFetch.Events(). Currently these are:
%%
% 
% * _startTime_
% * _endTime_ 
% * _eventId_ 
% * _fetchLimit_
% * _magnitudeType_
% * _minimumLongitude_
% * _maximumLongitude_
% * _minimumLatitude_
% * _maximumLatitude_
% * _minimumMagnitude_
% * _maximumMagnitude_
% * _minimumDepth_
% * _maximumDepth_
% 
% And the two convenience parameters:
%%
%
% * _radialcoordinates_ = [ _centerLatitude_, _centerLongitude_, _maximumRadius_ ]
%
% * _boxcoordinates_ = [ _minimumLatitude_ _maximumLatitude_ _minimumLongitude_ _maximumLongitude_ ]
% 

%% Reading events from IRIS DMC
% To load events into a Catalog object we use the readEvents function. 
% The first argument is the data source/format - when this is given as 
% 'iris', readEvents uses the irisFetch.m program to retrieve event data 
% via the IRIS webservices. To narrow down our data search we can give 
% readEvents any name-value parameter pairs supported by irisFetch.
%
% In this example we will use readEvents to retrieve all events at IRIS DMC 
% with a magnitude of at least 7.9 between year 2000 and 2014 (inclusive):

catalogObject = readEvents('iris', 'minimumMagnitude', 7.9, 'starttime', '2000-01-01', 'endtime', '2015-01-01')

%%
% We have retrieved 26 events. To access any particular property we can use
% dot notation, as if the object were a structure, e.g.:

catalogObject.depth
catalogObject.mag

%%
% catalogObject is of type "Catalog". etype contains the event type for 
% each of the 26 events. In this case each is just  'earthquake', but when 
% dealing with more diverse dataset, many other etype's are possible. 
% magtype is whatever magnitude type was assigned by the agency that 
% provided the magnitude data.
%

%%
% Using the methods() function will tell us what operations we can perform
% on a Catalog object:

methods(catalogObject)

%%
% Now we'll do another example - we will get events within 200 km of the 
% great M9.0 Tohoku earthquake that occurred on 2011/03/11. 
% The mainshock parameters are: 
% 
%     Date/Time:  "2011/03/11 05:46:24"
%     Longitude:  142.372
%     Latitude:   38.297
%     Depth:      30 km
 
%%
% We will limit our search to 1 day before and after the earthquake:
 
mainshocktime = datenum('2011/03/11 05:46:24')
catalogObject = readEvents('iris', ...
            'radialcoordinates', [38.297 142.372 km2deg(200)], ...
            'starttime', mainshocktime - 1, ...
            'endtime', mainshocktime + 1);

%%
% This returns 1136 earthquakes. Let's get a summary:

catalogObject.summary()


%% Readings events from an Antelope database
% To load event data from an Antelope/Datascope CSS3.0 database you will 
% need to have Antelope (<http://www.brtt.com/software.html>) installed, 
% including the Antelope toolbox for MATLAB.
% 
%%
% *SCAFFOLD: NOTE THAT CURRENTLY NOT USING THE RTDB200903 AT ALL* 
% 
% For the purpose of this exercise we will be using data from Redoubt 
% volcano from 2009/03/20 to 2009/03/23. We will use snippets from two 
% catalogs that are provided with GISMO in Antelope format:
 
%%
%
% * The real-time catalog (rtdb200903).
% * The analyst-reviewed offical AVO catalog (avodb200903).

%%
% Both catalog segments are included in the "demo" directory. 
% We will now load the official AVO catalog into an Events object:
  
dbpath = demodb('avo');
catalogObject = readEvents('antelope', 'dbpath', dbpath);
 
%%
% This should load 1441 events. What if we only want events within 20km of 
% Redoubt volcano? There are two ways to do this. The first is the use the
% radialcoordinates parameter:

redoubtLon = -152.7431; 
redoubtLat = 60.4853;
maxR = 20.0;
catalogObject = readEvents('antelope', 'dbpath', dbpath, ...
	'radialcoordinates', [redoubtLat redoubtLon maxR]);
catalogObject.numberOfEvents

%%
% The second way is to use the 'subset_expression' which the Antelope
% expression evaluator interprets:
 
redoubtLon = -152.7431; 
redoubtLat = 60.4853;
expr = sprintf('deg2km(distance(lat, lon, %f, %f)) < %f',redoubtLat, redoubtLon,maxR)
catalogObject = readEvents('antelope', 'dbpath', dbpath, ...
	'subset_expression', expr);
catalogObject.numberOfEvents

%% Reading events from a Seisan database
% Here we load events from a Seisan catalog. A Seisan "Sfile" contains all
% the metadata for 1 event. These Sfiles are stored in a flat-file database
% structure the path to which is: $SEISAN_TOP/REA/databaseName. Sfiles are 
% organized in year/month subdirectories under this path.
%
% *SCAFFOLD: INCLUDE DEMO DATASET FROM MVOE*

%%
% The following will navigate this where in this case 
% $SEISAN_TOP = '/raid/data/seisan' and the databaseName is MVOE_ which 
% stands for the Montserrat Volcano Observatory Event database. 
% (In Seisan, databaseName is limited to exactly 5 characters).
%
% This example will load all Sfiles for January 1st, 2000. This is a slow 
% function to run as MATLAB is slow at parsing text files, and there are
% many events per day in this particular database.
 
catalogObject = readEvents('seisan', ...
    'dbpath', fullfile('/raid','data','seisan','REA','MVOE_'), ...
	'starttime', '2000/01/01', ....
	'endtime', '2000/01/02')



##### SOURCE END #####
--></body></html>