<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of channeltag</title>
  <meta name="keywords" content="channeltag">
  <meta name="description" content="">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="#">gismotools</a> &gt; <a href="../index.html">GISMO</a> &gt; <a href="index.html">classes</a> &gt; channeltag.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for gismotools/GISMO/classes&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>channeltag
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong></strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>This is a script file. </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="channeltag.html" class="code" title="">channeltag</a>	</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="channeltag.html" class="code" title="">channeltag</a>	</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function obj = channeltag(varargin)</a></li><li><a href="#_sub2" class="code">function [IDX, objs] = matching(objs, N, S, L, C)</a></li><li><a href="#_sub3" class="code">function [Y, I] = sort(cha_tags)</a></li><li><a href="#_sub4" class="code">function result = eq(A, B)</a></li><li><a href="#_sub5" class="code">function result = ne(A, B)</a></li><li><a href="#_sub6" class="code">function val = get(obj, prop)</a></li><li><a href="#_sub7" class="code">function obj = set(obj, varargin)</a></li><li><a href="#_sub8" class="code">function s = fixedlengthstrings(objs, netLen, staLen, locLen, chaLen)</a></li><li><a href="#_sub9" class="code">function c = char(obj)</a></li><li><a href="#_sub10" class="code">function s = string(obj, delim, option)</a></li><li><a href="#_sub11" class="code">function s = getDelimitedString(obj, delim)</a></li><li><a href="#_sub12" class="code">function res = validate(obj)</a></li><li><a href="#_sub13" class="code">function  [N, S, L, C] = parse(val)</a></li><li><a href="#_sub14" class="code">function  C = strsplit(s, delim)</a></li><li><a href="#_sub15" class="code">function cha_tags = array(varargin)</a></li><li><a href="#_sub16" class="code">function test()</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 classdef <a href="channeltag.html" class="code" title="">channeltag</a>
0002    <span class="comment">%channeltag Summary of this class goes here</span>
0003    <span class="comment">% channeltag is the class that holds the network, station, location, and channel for a seismic trace</span>
0004    <span class="comment">%</span>
0005    <span class="comment">% This rewrite is designed to be better SEED compatible</span>
0006    <span class="comment">%</span>
0007    <span class="comment">%  chaTag = channeltag('NW.STA.LO.CHA'); % create from text</span>
0008    <span class="comment">%  chaTag = channeltag(network, station, location, channel);</span>
0009    <span class="comment">%  chaTag = channeltag(); %default, blank nscl</span>
0010    <span class="comment">%</span>
0011    <span class="comment">%  To initialize multiple channeltags at once, use channeltag.array:</span>
0012    <span class="comment">%</span>
0013    <span class="comment">%  Example using cells of stationID strings</span>
0014    <span class="comment">%    x = channeltag.array({'NW.STA.LO.CHA','NW.STA.LO.CHA'[,...]});</span>
0015    <span class="comment">%</span>
0016    <span class="comment">%  Example using individual parts</span>
0017    <span class="comment">%    cha_tags = channeltag.array({'IU','ANMO','00',{'BHZ','BH1','BH2'});</span>
0018    <span class="comment">%</span>
0019    <span class="comment">%  note, an array of cha_tags may be created by including cell arrays of</span>
0020    <span class="comment">%  choices. However, all cells that contain multiple strings must be the</span>
0021    <span class="comment">%  same size and shape.</span>
0022    <span class="comment">%</span>
0023    <span class="comment">%  OK: x = channeltag.array('IU',{'ANMO','ANTO},'00',{'BHE','BH1'}</span>
0024    <span class="comment">%        results in IU.ANMO.00.BHE &amp; IU.ANTO.00.BH1</span>
0025    <span class="comment">%</span>
0026    <span class="comment">%  NOTOK: x = channeltag.array('IU',{'ANMO','ANTO},'00',{'BHE';'BH1'}</span>
0027    <span class="comment">%        error because stations (1x2) not same size as channels (2x1)</span>
0028    <span class="comment">%</span>
0029    <span class="comment">%</span>
0030    <span class="comment">%  NOTE: WILDCARDS,  NOT IMPLEMENTED as of 2015-07-31!!!!!</span>
0031    
0032    <span class="comment">%{</span>
0033    <span class="comment">%  ----------- WILDCARDS ---------------------</span>
0034    <span class="comment">%  channeltag is merely a storage unit for net-sta-chan-loc information. It</span>
0035    <span class="comment">%  is blind to wildcards. However, when used as an argument in WAVEFORM,</span>
0036    <span class="comment">%  wildcards in the channeltag take on meaning that depends somewhat on the</span>
0037    <span class="comment">%  DATASOURCE type. In most cases, * wildcards are understood without</span>
0038    <span class="comment">%  issue. Note that '*' differs from ''. The latter excludes this term from</span>
0039    <span class="comment">%  the search altogether. Station and channel cannot be excluded from the</span>
0040    <span class="comment">%  search.</span>
0041    <span class="comment">%</span>
0042    <span class="comment">%  channeltag('R*','BHZ','XE','') match all stations begining with R</span>
0043    <span class="comment">%  channeltag('MCK','*','XE','')  match all channels for MCK</span>
0044    <span class="comment">%  channeltag('R*','*','XE','')   all R* stations. All channels</span>
0045    <span class="comment">%</span>
0046    <span class="comment">%  The uses above have been tested against Antelope data sources. Note that</span>
0047    <span class="comment">%  in Antelope it would be more common to use the literal wildcards 'R.*'</span>
0048    <span class="comment">%  or '.*'. When waveform interprets channeltags, it considers these use</span>
0049    <span class="comment">%  the same.</span>
0050    <span class="comment">%</span>
0051    <span class="comment">% EXAMPLE:</span>
0052    <span class="comment">%   s={'ANMO','ANTO'} , n='IU' , L='00' , c={'BHZ,BHE'}</span>
0053    <span class="comment">%   chaTag=channeltag(s,c,n,L); %  returns a 1x2 channeltag:</span>
0054    <span class="comment">%    chaTag(1) contains ANMO, IU, 00, BHZ</span>
0055    <span class="comment">%    chaTag(2) contains ANTO, IU, 00, BHE</span>
0056    <span class="comment">%}</span>
0057    
0058    <span class="comment">% Programming notes:</span>
0059    <span class="comment">%   This is intended as a stand-alone class. It should know nothing about</span>
0060    <span class="comment">%   any other waveform class.</span>
0061    
0062    <span class="comment">% Backwards compatibility notes:</span>
0063    <span class="comment">%   The old SCNLOBJECT class will use this behind the scenes. Hopefully</span>
0064    <span class="comment">%   it will be easier to convert code when SNCLOBJECT is producing the</span>
0065    <span class="comment">%   appropriate warning messages.</span>
0066    
0067    properties
0068       network  = <span class="string">''</span>;
0069       station  = <span class="string">''</span>;
0070       location = <span class="string">''</span>;
0071       channel  = <span class="string">''</span>;
0072    <span class="keyword">end</span>
0073    
0074    properties (Constant=true)
0075       ENFORCE_SEED_COMPLIANCE = getpref(<span class="string">'gismo'</span>,<span class="string">'seed_compliant'</span>,false); <span class="comment">% currently unused</span>
0076    <span class="keyword">end</span>
0077    
0078    properties (Access=protected)
0079       <span class="comment">% bulkIsValid = @(x) ischar(x)|| (iscell(x) &amp;&amp; all(cellfun(@ischar,x)) );</span>
0080    <span class="keyword">end</span>
0081    
0082    methods
0083       <a name="_sub0" href="#_subfunctions" class="code">function obj = channeltag(varargin)</a>
0084          <span class="comment">% construct a channeltag from a string or 4 strings.</span>
0085          <span class="comment">% chaTag = channeltag('IU', 'ANMO', '00', 'BHZ'); % net, sta, loc, cha</span>
0086          <span class="comment">% chaTag = channeltag('IU.ANMO.00.BHZ');</span>
0087          <span class="comment">%</span>
0088          <span class="comment">% any of these may be empty ([] or '').</span>
0089          <span class="comment">% to create multiple channeltags at once, use channeltag.array()</span>
0090          <span class="comment">%</span>
0091          <span class="comment">% See also: channeltag.array</span>
0092          
0093          <span class="comment">% By removing the ability to create many at once, we ensure it won't</span>
0094          <span class="comment">% be done accidentally.</span>
0095          
0096          <span class="keyword">switch</span> nargin
0097             <span class="keyword">case</span> 4
0098                <span class="comment">% inputsThatAreCells = cellfun(@iscell,{N,S,L,C});</span>
0099                <span class="comment">% if any(cellfun(@iscell,{N,S,L,C}))</span>
0100                <span class="keyword">if</span> any(cellfun(@iscell,varargin))
0101                   error(<span class="string">'channeltag:InvalidConversion'</span>,<span class="keyword">...</span>
0102                      [<span class="string">'expected strings but received cells.\n'</span>, <span class="keyword">...</span>
0103                      <span class="string">'To create multiple channeltags, use channeltag.array()'</span>]);
0104                <span class="keyword">end</span>
0105                varargin = strtrim(varargin);
0106                [obj.network, obj.station, obj.location, obj.channel] = deal(varargin{:});
0107             <span class="keyword">case</span> 1
0108                inObj = varargin{1};
0109                <span class="keyword">switch</span> class(inObj)
0110                   <span class="keyword">case</span> <span class="string">'channeltag'</span>
0111                      obj = inObj;
0112                   <span class="keyword">case</span> {<span class="string">'char'</span>,<span class="string">'struct'</span>}
0113                      <span class="keyword">if</span> size(inObj,1) == 1
0114                      [obj.network, obj.station, obj.location, obj.channel] = <span class="keyword">...</span>
0115                         channeltag.parse(inObj);
0116                      <span class="keyword">else</span>
0117                         error(<span class="string">'channeltag:InvalidConversion'</span>,<span class="keyword">...</span>
0118                            <span class="string">'To create multiple channeltags, use channeltag.array()'</span>);
0119                      <span class="keyword">end</span>
0120                         
0121                   <span class="keyword">case</span> <span class="string">'cell'</span>
0122                      <span class="keyword">if</span> numel(inObj) == 1
0123                         [obj.network, obj.station, obj.location, obj.channel] = <span class="keyword">...</span>
0124                            channeltag.parse(inObj{1});
0125                      <span class="keyword">else</span>
0126                         error(<span class="string">'channeltag:InvalidConversion'</span>,<span class="keyword">...</span>
0127                            <span class="string">'To create multiple channeltags, use channeltag.array()'</span>);
0128                      <span class="keyword">end</span>
0129                   <span class="keyword">otherwise</span>
0130                      error (<span class="string">'channeltag:InvalidConversion'</span>,<span class="string">'Invalid number of arguments'</span>);
0131                <span class="keyword">end</span>
0132                
0133             <span class="keyword">case</span> 0
0134                <span class="keyword">return</span>
0135             <span class="keyword">otherwise</span>
0136                error (<span class="string">'channeltag:InvalidConversion'</span>,<span class="string">'Invalid number of arguments'</span>);
0137          <span class="keyword">end</span>
0138       <span class="keyword">end</span>
0139       
0140       <a name="_sub1" href="#_subfunctions" class="code">function [IDX, objs] = matching(objs, N, S, L, C)</a>
0141          <span class="comment">% matching does field-by-field comparison</span>
0142          <span class="comment">%</span>
0143          <span class="comment">% idx = cha_tags.matching(Net, Sta, Loc, Cha);</span>
0144          <span class="comment">% idx = cha_tags.matching('net.sta.loc.cha');</span>
0145          <span class="comment">% returns an index vector the same size as cha_tags</span>
0146          <span class="comment">% [idx, matched] = cha_tags.matching(...)</span>
0147          <span class="comment">%   additionally returns the actual matching cha_tags</span>
0148          <span class="comment">%</span>
0149          <span class="comment">% so, cha_tags(matches) will return the actual values</span>
0150          <span class="comment">% use [] or '' as wildcard</span>
0151          <span class="comment">%  either:</span>
0152          <span class="comment">%    cha_tags.matching('IU','ANMO',[],'BHZ')   or</span>
0153          <span class="comment">%    cha_tags.matching('IU.ANMO..BHZ')</span>
0154          <span class="comment">% will match BOTH</span>
0155          <span class="comment">%   'IU.ANMO.00.BHZ' and 'IU.ANMO.01.BHZ'</span>
0156          <span class="keyword">if</span> nargin == 2
0157             <span class="keyword">if</span> (ischar(N) &amp;&amp; any(N == <span class="string">'.'</span>)) || isa(N,<span class="string">'channeltag'</span>)
0158                <span class="comment">% query used single string : 'net.sta.loc.cha'</span>
0159                [N, S, L, C] = channeltag.parse(N);
0160             <span class="keyword">else</span>
0161                error(<span class="string">'CHANNELTAG:matching:UnknownMatchType'</span>,<span class="string">'don''t know how to match it'</span>);
0162             <span class="keyword">end</span>
0163          <span class="keyword">end</span>
0164          IDX = true(size(objs));
0165          <span class="keyword">if</span> ~isempty(N) &amp;&amp; all(N ~= <span class="string">'*'</span>)
0166             IDX = strcmp({objs.network}, N);
0167          <span class="keyword">end</span>
0168          <span class="keyword">if</span> exist(<span class="string">'S'</span>, <span class="string">'var'</span>) &amp;&amp; ~isempty(S) &amp;&amp; all(S ~= <span class="string">'*'</span>)
0169             IDX = IDX &amp; strcmp({objs.station}, S);
0170          <span class="keyword">end</span>
0171          <span class="keyword">if</span> exist(<span class="string">'L'</span>, <span class="string">'var'</span>)  &amp;&amp; ~isempty(L) &amp;&amp; all(L ~= <span class="string">'*'</span>)
0172             IDX = IDX &amp; strcmp({objs.location}, L);
0173          <span class="keyword">end</span>
0174          <span class="keyword">if</span> exist(<span class="string">'C'</span>, <span class="string">'var'</span>) &amp;&amp; ~isempty(C) &amp;&amp; all(C ~= <span class="string">'*'</span>)
0175             IDX = IDX &amp; strcmp({objs.channel}, C);
0176          <span class="keyword">end</span>
0177          <span class="keyword">if</span> nargout == 2
0178             objs = objs(IDX);
0179          <span class="keyword">end</span>
0180       <span class="keyword">end</span>
0181       
0182       <a name="_sub2" href="#_subfunctions" class="code">function [Y, I] = sort(cha_tags)</a>
0183          <span class="comment">% sort nscls in assending order by net.cha.loc.sta</span>
0184          [~,I] = <a href="#_sub3" class="code" title="subfunction [Y, I] = sort(cha_tags)">sort</a>(cha_tags.fixedlengthstrings(5,5,5,5));
0185          Y = cha_tags(I);
0186       <span class="keyword">end</span>
0187       
0188       <a name="_sub3" href="#_subfunctions" class="code">function result = eq(A, B)</a>
0189          <span class="comment">% expect that both parts are channeltags</span>
0190          result = strcmp(A.string(), B.string());
0191       <span class="keyword">end</span><span class="comment">%eq</span>
0192       
0193       <a name="_sub4" href="#_subfunctions" class="code">function result = ne(A, B)</a>
0194          result = ~strcmp(A.string,B.string);
0195       <span class="keyword">end</span>
0196       
0197       <a name="_sub5" href="#_subfunctions" class="code">function val = get(obj, prop)</a>
0198          <span class="comment">%GET for the chaTag object</span>
0199          <span class="comment">%  result = get(channeltag, property), where PROPERTY is one of the</span>
0200          <span class="comment">%  following:</span>
0201          <span class="comment">%    STATION, CHANNEL, LOCATION, NETWORK, chaTag_STRING</span>
0202          <span class="comment">%</span>
0203          <span class="comment">% If the results of a single chaTag are requested, then a string is returned.</span>
0204          <span class="comment">% Otherwise, a cell of values will be returned.</span>
0205          
0206          
0207          prop = lower(prop);
0208          
0209          <span class="keyword">switch</span> prop
0210             <span class="keyword">case</span>{<span class="string">'station'</span>,<span class="string">'channel'</span>,<span class="string">'network'</span>,<span class="string">'location'</span>}
0211                val = {obj.(prop)};
0212             <span class="keyword">case</span> {<span class="string">'nscl_string'</span>}
0213                <span class="comment">%stuff = chaTag.string;</span>
0214                warning(<span class="string">'CHANNELTAG:get:obsoleteUsage'</span>,<span class="keyword">...</span>
0215                   [<span class="string">'get(''nsclstring'') obsolete. Use chaTag.string().\n'</span><span class="keyword">...</span>
0216                   <span class="string">'  notice it will return N.S.L.C instead of N_S_C_L'</span>]);
0217                val=strcat({obj.network},<span class="string">'_'</span>,{obj.station},<span class="string">'_'</span>,{obj.channel},<span class="string">'_'</span>,{obj.location});
0218             <span class="keyword">otherwise</span>
0219                error(<span class="string">'CHANNELTAG:get:UnrecognizedProperty'</span>,<span class="keyword">...</span>
0220                   <span class="string">'Unrecognized property name : %s'</span>,  upper(prop));
0221          <span class="keyword">end</span>
0222          
0223          <span class="comment">%if a single chaTag, then return the string representation, else return a</span>
0224          <span class="comment">%cell of strings.</span>
0225          <span class="keyword">if</span> numel(val) == 1
0226             val = val{1};
0227          <span class="keyword">else</span>
0228             val = reshape(val,size(obj));
0229          <span class="keyword">end</span>
0230       <span class="keyword">end</span><span class="comment">%get</span>
0231       
0232       <a name="_sub6" href="#_subfunctions" class="code">function obj = set(obj, varargin)</a>
0233          <span class="comment">%SET - Set properties for channeltag</span>
0234          <span class="comment">%       s = Set(s,prop_name, val, ...)</span>
0235          <span class="comment">%       Valid property names:</span>
0236          <span class="comment">%       STATION, LOCATION, NETWORK, CHANNEL</span>
0237          
0238          idx = [1 2];
0239          <span class="keyword">while</span> numel(varargin) &gt; 1 <span class="comment">% for each property</span>
0240             [prop, val] = deal(varargin{idx});
0241             varargin(idx) = []; <span class="comment">% remove the prop and val</span>
0242             <span class="keyword">switch</span> upper(prop)
0243                <span class="keyword">case</span> {<span class="string">'STATION'</span>,<span class="string">'LOCATION'</span>,<span class="string">'NETWORK'</span>,<span class="string">'CHANNEL'</span>}
0244                   <span class="keyword">if</span> iscell(val) &amp;&amp; numel(val) &gt; 1
0245                      val = val{1};
0246                      warning(<span class="string">'channeltag:set:TooManyValues'</span>,<span class="keyword">...</span>
0247                         <span class="string">'Too many property values, only the first will be used'</span>);
0248                   <span class="keyword">end</span>
0249                   [obj.(lower(prop))] = deal(val);
0250                <span class="keyword">otherwise</span>
0251                   error(<span class="string">'channeltag:set:UnrecognizedProperty'</span>,<span class="keyword">...</span>
0252                      <span class="string">'Unrecognized property name : %s'</span>,  upper(prop));
0253             <span class="keyword">end</span>; <span class="comment">%switch</span>
0254          <span class="keyword">end</span>; <span class="comment">%each property</span>
0255          <span class="keyword">if</span> ~isempty(varargin)
0256             error(<span class="string">'channeltag:set:PropertyValueMismatch'</span>,<span class="keyword">...</span>
0257                <span class="string">'Each property should have a value. [%s] has no matching value'</span>, varargin{1});
0258          <span class="keyword">end</span>
0259       <span class="keyword">end</span>
0260       
0261       <a name="_sub7" href="#_subfunctions" class="code">function s = fixedlengthstrings(objs, netLen, staLen, locLen, chaLen)</a>
0262          strformat = sprintf(<span class="string">'%%-%ds.%%-%ds.%%-%ds.%%-%ds'</span>,netLen,staLen,locLen,chaLen);
0263          <span class="keyword">for</span> n = numel(objs) : -1 : 1
0264             chaTag = objs(n);
0265             s(n) = {sprintf(strformat,chaTag.network,chaTag.station,chaTag.location,chaTag.channel)};
0266          <span class="keyword">end</span>
0267       <span class="keyword">end</span>
0268       
0269       <a name="_sub8" href="#_subfunctions" class="code">function c = char(obj)</a>
0270          c = obj.string([],<span class="string">'nocell'</span>);
0271       <span class="keyword">end</span>
0272          
0273       <a name="_sub9" href="#_subfunctions" class="code">function s = string(obj, delim, option)</a>
0274          <span class="comment">% string returns string representation of the nscltag(s)</span>
0275          <span class="comment">% s = chaTag.string()  will return the string representation</span>
0276          <span class="comment">%      (1xn char) in the format NET.STA.LOC.CHA</span>
0277          <span class="comment">%</span>
0278          <span class="comment">% s = chaTag.string(DELIM) will use DELIM to separate</span>
0279          <span class="comment">%     fields.</span>
0280          <span class="comment">%     ex.  chaTag.string('-'); will return NET-STA-LOC-CHA</span>
0281          <span class="comment">%</span>
0282          <span class="comment">% If chaTag is an array, then results are returned as a</span>
0283          <span class="comment">% a cell of strings of same shape as chaTag will be returned.</span>
0284          <span class="comment">%</span>
0285          <span class="comment">% s = chaTag.string(DELIM,'nocell') to overrides functionality</span>
0286          <span class="comment">% to return a padded NxM char array</span>
0287          <span class="comment">% if DELIM is empty, then '.' will be used.</span>
0288          <span class="keyword">if</span> ~exist(<span class="string">'delim'</span>,<span class="string">'var'</span>) || isempty(delim)
0289             delim = <span class="string">'.'</span>;
0290          <span class="keyword">end</span>
0291          <span class="keyword">if</span> numel(obj) == 1
0292             s = <a href="#_sub11" class="code" title="subfunction s = getDelimitedString(obj, delim)">getDelimitedString</a>(obj, delim);
0293          <span class="keyword">else</span>
0294             <span class="keyword">if</span> exist(<span class="string">'option'</span>,<span class="string">'var'</span>) &amp;&amp; strcmpi(option,<span class="string">'nocell'</span>)
0295                s = <span class="string">''</span>;
0296                <span class="keyword">for</span> n=1 : numel(obj)
0297                   tmp = <a href="#_sub11" class="code" title="subfunction s = getDelimitedString(obj, delim)">getDelimitedString</a>(obj(n), delim);
0298                   s(n,1:numel(tmp)) = tmp;
0299                <span class="keyword">end</span>
0300             <span class="keyword">else</span>
0301                s = cell(size(obj));
0302                <span class="keyword">for</span> n=1 : numel(obj)
0303                   s(n) = {<a href="#_sub11" class="code" title="subfunction s = getDelimitedString(obj, delim)">getDelimitedString</a>(obj(n), delim)};
0304                <span class="keyword">end</span>
0305             <span class="keyword">end</span>
0306          <span class="keyword">end</span>
0307          
0308          <a name="_sub10" href="#_subfunctions" class="code">function s = getDelimitedString(obj, delim)</a>
0309             s = [obj.network, delim, obj.station, delim,<span class="keyword">...</span>
0310                      obj.location, delim, obj.channel];
0311          <span class="keyword">end</span>
0312       <span class="keyword">end</span>
0313       
0314       <a name="_sub11" href="#_subfunctions" class="code">function res = validate(obj)</a>
0315          <span class="comment">% make sure channeltag roughly conforms to SEED</span>
0316          nslc_is_char = [ischar(obj.network), ischar(obj.channel),<span class="keyword">...</span>
0317              ischar(obj.station), ischar(obj.location)];
0318          nslc_valid_length = [numel(obj.network) == 2,<span class="keyword">...</span>
0319             numel(obj.station) &lt;= 5 &amp;&amp; numel(obj.station) &gt; 0, <span class="keyword">...</span>
0320             numel(obj.location) == 2, <span class="keyword">...</span>
0321             numel(obj.channel) == 3];
0322          res = all(nslc_is_char &amp; nslc_valid_length);
0323       <span class="keyword">end</span>
0324             
0325    <span class="keyword">end</span><span class="comment">%methods</span>
0326    
0327    methods(Static)
0328       <a name="_sub12" href="#_subfunctions" class="code">function  [N, S, L, C] = parse(val)</a>
0329          <span class="comment">% parse parses a period-delimeted string</span>
0330          <span class="comment">% [N, S, L, C] = channeltag.parse('net.sta.loc.cha')</span>
0331          <span class="keyword">if</span> isstruct(val) || isa(val,<span class="string">'channeltag'</span>)
0332             N = val.network;
0333             S = val.station;
0334             L = val.location;
0335             C = val.channel;
0336          <span class="keyword">elseif</span> ischar(val)
0337             <span class="comment">% test validity, then split.  in R2015a+ strsplit() could do</span>
0338             <span class="comment">% this. But, this is being designed on R2012a.</span>
0339             parts =  <a href="#_sub14" class="code" title="subfunction  C = strsplit(s, delim)">strsplit</a>(val, <span class="string">'.'</span>);
0340             <span class="keyword">if</span> numel(parts) ~= 4
0341                error(<span class="string">'channeltag:parse:InvalidFieldCount'</span>,<span class="keyword">...</span>
0342                   <span class="string">'Expected ''A.B.C.D'' (4 fields), but received %d.'</span>, numel(parts));
0343             <span class="keyword">end</span>
0344             <span class="keyword">if</span> any(val == <span class="string">' '</span>), 
0345                parts = strtrim(parts); 
0346             <span class="keyword">end</span>
0347             [N, S, L, C] = deal(parts{:});
0348          <span class="keyword">else</span>
0349             error(<span class="string">'channeltag:parse:UnknownClass'</span>,<span class="keyword">...</span>
0350                <span class="string">'unknown how to parse: %s'</span>, class(val));
0351          <span class="keyword">end</span>
0352          
0353          <a name="_sub13" href="#_subfunctions" class="code">function  C = strsplit(s, delim)</a>
0354             <span class="comment">% C = strsplit(str, delim) returns cell created from string</span>
0355             <span class="comment">%  ex. C = strsplit('A.B..D','.') -&gt; {'A', 'B', '', 'D'}</span>
0356             <span class="comment">% can (probably) be commented out or removed in r2015a+</span>
0357             splitpts = find(s == delim);
0358             starts = [1, splitpts+1];
0359             ends = [splitpts-1, numel(s)];
0360             C = cell(1,numel(starts));
0361             <span class="keyword">for</span> n = 1:numel(starts)
0362                C(n) = {s(starts(n):ends(n))};
0363             <span class="keyword">end</span>
0364          <span class="keyword">end</span>
0365       <span class="keyword">end</span>
0366       
0367       <a name="_sub14" href="#_subfunctions" class="code">function cha_tags = array(varargin)</a>
0368          <span class="comment">% chaTag.array creates multiple channeltags from the input.</span>
0369          <span class="comment">% cha_tags = chaTag.array({'NET.STA.LOC.CHA','NET2.STA2..CH2'[,...]})</span>
0370          <span class="comment">% cha_tags = chaTag.array(Net/list, Sta/list, Loc/list, Cha/list)</span>
0371          <span class="keyword">switch</span> nargin
0372             <span class="keyword">case</span> 0
0373                <span class="comment">% return an empty nscltag array</span>
0374                cha_tags = <a href="channeltag.html" class="code" title="">channeltag</a>(<span class="string">'...'</span>);
0375                cha_tags(:)=[];
0376             <span class="keyword">case</span> 1
0377                <span class="comment">% parse a cell array of stations. OR parse an NxM char, where</span>
0378                <span class="comment">% each row is NET.STA.LOC.CHA</span>
0379                <span class="keyword">if</span> iscell(varargin{1})
0380                   <span class="keyword">for</span> n = numel(varargin{1}) : -1 : 1
0381                      cha_tags(n) = <a href="channeltag.html" class="code" title="">channeltag</a>(varargin{1}{n});
0382                   <span class="keyword">end</span>
0383                   cha_tags = reshape(cha_tags,size(varargin{1}));
0384                <span class="keyword">elseif</span> ischar(varargin{1})
0385                   char_array = varargin{1};
0386                   nRows = size(char_array,1);
0387                   <span class="keyword">for</span> n = nRows : -1 : 1
0388                      cha_tags(1,n) = <a href="channeltag.html" class="code" title="">channeltag</a>(strtrim(char_array(n,:)));
0389                   <span class="keyword">end</span>
0390                <span class="keyword">else</span>
0391                   error(<span class="string">'channeltag:array:UnknownInput'</span>,<span class="string">'expected cell of strings or a char array'</span>);
0392                <span class="keyword">end</span>
0393             <span class="keyword">case</span> 4
0394                <span class="comment">% expect 1xN char OR arbitrary-sized CELL of 1xN char</span>
0395                <span class="comment">% if multiple cells, then they should all be same size</span>
0396                inputsThatAreCells = cellfun(@iscell,varargin);
0397                <span class="keyword">if</span> any(inputsThatAreCells)
0398                   <span class="comment">%make a cell array of N.S.L.C</span>
0399                   A = strcat(varargin{1},<span class="string">'.'</span>,varargin{2},<span class="string">'.'</span>,varargin{3},<span class="string">'.'</span>,varargin{4});
0400                <span class="keyword">end</span>
0401                <span class="keyword">for</span> n = numel(A): -1 : 1
0402                   cha_tags(n) = <a href="channeltag.html" class="code" title="">channeltag</a>(A{n});
0403                <span class="keyword">end</span>
0404          <span class="keyword">end</span>
0405       <span class="keyword">end</span>
0406       
0407       <a name="_sub15" href="#_subfunctions" class="code">function test()</a>
0408          <span class="comment">% default channeltag</span>
0409          c = <a href="channeltag.html" class="code" title="">channeltag</a>();
0410          assert(strcmp(c.network,<span class="string">''</span>) &amp;&amp; strcmp(c.station,<span class="string">''</span>)<span class="keyword">...</span>
0411             &amp;&amp; strcmp(c.location,<span class="string">''</span>) &amp;&amp; strcmp(c.channel,<span class="string">''</span>))
0412          <span class="comment">% copy</span>
0413          c(2) = <a href="channeltag.html" class="code" title="">channeltag</a>();
0414          assert(c(1) == c(2)) <span class="comment">% test eq for an empty channeltag</span>
0415          <span class="comment">% check array creation</span>
0416          c1 = <a href="channeltag.html" class="code" title="">channeltag</a>();
0417          c1.network = <span class="string">'N1'</span>; c1.station = <span class="string">'S1'</span>; c1.location = <span class="string">'L1'</span>; c1.channel = <span class="string">'C1'</span>;
0418          c2 = c1;
0419          c2.network = <span class="string">'N2'</span>; c2.station = <span class="string">'S2'</span>; c2.location = <span class="string">'L2'</span>; c2.channel = <span class="string">'C2'</span>;
0420          assert(c2 ~= c1)
0421          tags_fieldcells = channeltag.array({<span class="string">'N1'</span>,<span class="string">'N2'</span>},{<span class="string">'S1'</span>,<span class="string">'S2'</span>},{<span class="string">'L1'</span>,<span class="string">'L2'</span>},{<span class="string">'C1'</span>,<span class="string">'C2'</span>});
0422          tags_textcells = channeltag.array({<span class="string">'N1.S1.L1.C1'</span>,<span class="string">'N2.S2.L2.C2'</span>});
0423          tags_textarray = channeltag.array([<span class="string">'N1.S1.L1.C1'</span>;<span class="string">'N2.S2.L2.C2'</span>]);
0424          assert(tags_fieldcells(1) == c1)  
0425          assert(tags_textcells(1) == c1)
0426          assert(tags_textarray(1) == c1)
0427          assert(tags_fieldcells(2) == c2)
0428          assert(tags_textcells(2) == c2)
0429          assert(tags_textarray(2) == c2)
0430          
0431          c = channeltag.array(<span class="string">'N'</span>,{<span class="string">'S1'</span>,<span class="string">'S2'</span>},<span class="string">'L'</span>,{<span class="string">'C1'</span>,<span class="string">'C2'</span>});
0432          assert(numel(c) == 2)
0433          assert(strcmp(c(2).station,<span class="string">'S2'</span>) &amp;&amp; strcmp(c(2).channel,<span class="string">'C2'</span>)<span class="keyword">...</span>
0434             &amp;&amp; strcmp([c.network], <span class="string">'NN'</span>) &amp;&amp; strcmp([c.location], <span class="string">'LL'</span>))
0435          tags = channeltag.array(<span class="string">'NW'</span>,<span class="string">'STA1'</span>,<span class="string">'00'</span>, {<span class="string">'A'</span>,<span class="string">'B'</span>,<span class="string">'C'</span>,<span class="string">'D'</span>});
0436          tags2 = channeltag.array(<span class="string">'NW'</span>,<span class="string">'STA1'</span>,<span class="string">'00'</span>, {<span class="string">'F'</span>,<span class="string">'C'</span>,<span class="string">'A'</span>,<span class="string">'E'</span>});
0437          sortedtags = <a href="#_sub3" class="code" title="subfunction [Y, I] = sort(cha_tags)">sort</a>(tags2);
0438          assert(sortedtags(1).channel == <span class="string">'A'</span> &amp;&amp; sortedtags(4).channel == <span class="string">'F'</span>)
0439          <span class="comment">% ismember</span>
0440          assert(ismember(<a href="channeltag.html" class="code" title="">channeltag</a>(<span class="string">'NW.STA1.00.B'</span>), tags));
0441          
0442       <span class="keyword">end</span> <span class="comment">%test</span>
0443          
0444          
0445    <span class="keyword">end</span> <span class="comment">%static methods</span>
0446 <span class="keyword">end</span> <span class="comment">%classdef</span>
0447</pre></div>
<hr><address>Generated on Sun 11-Oct-2015 14:40:09 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>