<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of readsacfile</title>
  <meta name="keywords" content="readsacfile">
  <meta name="description" content="readsacfile    Read SAC binary files.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../../../index.html">Home</a> &gt;  <a href="#">gismotools</a> &gt; <a href="../../../index.html">GISMO</a> &gt; <a href="../../index.html">classes</a> &gt; <a href="../index.html">@waveform</a> &gt; <a href="index.html">private</a> &gt; readsacfile.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../../../index.html"><img alt="<" border="0" src="../../../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for gismotools/GISMO/classes/@waveform/private&nbsp;<img alt=">" border="0" src="../../../../../right.png"></a></td></tr></table>-->

<h1>readsacfile
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../../../up.png"></a></h2>
<div class="box"><strong>readsacfile    Read SAC binary files.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../../../up.png"></a></h2>
<div class="box"><strong>function OUTPUT = readsacfile(varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">readsacfile    Read SAC binary files.
    usage:  output = readsacfile('sacfile')
         OUTPUT is a struct with fields &quot;header&quot; and &quot;amplitudes&quot;
         OUTPUT.header is an array of cells, each parsed into the proper
         data type (ie, SINGLE, CHAR, LOGICAL, etc.).
         OUTPUT.amplitudes is an array of the measured data</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../../../../matlabicon.gif)">
<li><a href="load_sac.html" class="code" title="function w = load_sac(dataRequest)">load_sac</a>	LOAD_SAC loads a waveform from SAC files</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function OUTPUT = mainFunction(endian,varargin)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function OUTPUT = readsacfile(varargin)</a>
0002    <span class="comment">%readsacfile    Read SAC binary files.</span>
0003    <span class="comment">%    usage:  output = readsacfile('sacfile')</span>
0004    <span class="comment">%         OUTPUT is a struct with fields &quot;header&quot; and &quot;amplitudes&quot;</span>
0005    <span class="comment">%         OUTPUT.header is an array of cells, each parsed into the proper</span>
0006    <span class="comment">%         data type (ie, SINGLE, CHAR, LOGICAL, etc.).</span>
0007    <span class="comment">%         OUTPUT.amplitudes is an array of the measured data</span>
0008    
0009    <span class="comment">% VERSION: 1.1 of waveform objects</span>
0010    <span class="comment">% AUTHOR: Celso Reyes   creyes@gi.alaska.edu</span>
0011    <span class="comment">%    modified from Michael Thorne (4/2004)</span>
0012    <span class="comment">% LASTUPDATE: 9/2/2009</span>
0013    
0014    
0015    <span class="keyword">try</span>
0016       OUTPUT = <a href="#_sub1" class="code" title="subfunction OUTPUT = mainFunction(endian,varargin)">mainFunction</a>(<span class="string">'little-endian'</span>,varargin{:});
0017    <span class="keyword">catch</span>
0018       <span class="comment">% disp('big-endian')</span>
0019       OUTPUT = <a href="#_sub1" class="code" title="subfunction OUTPUT = mainFunction(endian,varargin)">mainFunction</a>(<span class="string">'big-endian'</span>,varargin{:});
0020    <span class="keyword">end</span>
0021 <span class="keyword">end</span>
0022 <a name="_sub1" href="#_subfunctions" class="code">function OUTPUT = mainFunction(endian,varargin)</a>
0023    <span class="keyword">for</span> nrecs = 1:nargin-1
0024       
0025       sacfile = varargin{nrecs};
0026       
0027       <span class="comment">%---------------------------------------------------------------------------</span>
0028       <span class="comment">%    Default byte-order</span>
0029       <span class="comment">%    endian  = 'big-endian' byte order (e.g., UNIX)</span>
0030       <span class="comment">%            = 'little-endian' byte order (e.g., LINUX)</span>
0031       
0032       <span class="comment">%endian = 'little-endian';</span>
0033       <span class="comment">%endian = 'big-endian';</span>
0034       
0035       <span class="keyword">if</span> strcmp(endian,<span class="string">'big-endian'</span>)
0036          fid = fopen(sacfile,<span class="string">'r'</span>,<span class="string">'ieee-be'</span>);
0037       <span class="keyword">elseif</span> strcmp(endian,<span class="string">'little-endian'</span>)
0038          fid = fopen(sacfile,<span class="string">'r'</span>,<span class="string">'ieee-le'</span>);
0039       <span class="keyword">end</span>
0040       
0041       <span class="comment">%preallocate</span>
0042       h = cell(1,123);
0043       
0044       <span class="comment">% read in single precision real header variables:</span>
0045       <span class="comment">%---------------------------------------------------------------------------</span>
0046       <span class="keyword">for</span> i=1:70
0047          h(i) = {fread(fid,1,<span class="string">'single'</span>)};
0048       <span class="keyword">end</span>
0049       
0050       <span class="comment">% read in single precision integer header variables:</span>
0051       <span class="comment">%---------------------------------------------------------------------------</span>
0052       <span class="keyword">for</span> i=71:105
0053          h(i) = {fread(fid,1,<span class="string">'int32'</span>)};
0054       <span class="keyword">end</span>
0055       
0056       
0057       <span class="comment">% Check header version = 6 and issue warning</span>
0058       <span class="comment">%---------------------------------------------------------------------------</span>
0059       <span class="comment">% If the header version is not NVHDR == 6 then the sacfile is likely of the</span>
0060       <span class="comment">% opposite byte order.  This will give h(77) some ridiculously large</span>
0061       <span class="comment">% number.  NVHDR can also be 4 or 5.  In this case it is an old SAC file</span>
0062       <span class="comment">% and rsac cannot read this file in.  To correct, read the SAC file into</span>
0063       <span class="comment">% the newest verson of SAC and w over.</span>
0064       <span class="comment">%</span>
0065       <span class="keyword">if</span> (h{77} == 4 || h{77} == 5)
0066          message = strcat(<span class="string">'NVHDR = 4 or 5. File: &quot;'</span>,sacfile,<span class="string">'&quot; may be from an old version of SAC.'</span>);
0067          fclose(fid);
0068          error(<span class="string">'Waveform:readsacfile:oldSacVersion'</span>,message)
0069       <span class="keyword">elseif</span> h{77} ~= 6
0070          message = strcat(<span class="string">'Current readsacfile byte order: &quot;'</span>,endian,<span class="string">'&quot;. File: &quot;'</span>,sacfile,<span class="string">'&quot; may be of opposite byte-order.'</span>);
0071          fclose(fid);
0072          error(<span class="string">'Waveform:readsacfile:wrongEndian'</span>,message)
0073       <span class="keyword">end</span>
0074       
0075       <span class="comment">% read in logical header variables</span>
0076       <span class="comment">%---------------------------------------------------------------------------</span>
0077       <span class="keyword">for</span> i=106:110
0078          h(i) = {fread(fid,1,<span class="string">'int32'</span>)};
0079       <span class="keyword">end</span>
0080       
0081       <span class="comment">% read in character header variables</span>
0082       <span class="comment">%---------------------------------------------------------------------------</span>
0083       strlens = repmat(8,23,1); strlens(2) = 16;
0084       <span class="keyword">for</span> i=111:133;<span class="comment">%111:8:302</span>
0085          h(i) = {(fread(fid,strlens(i-110),<span class="string">'char=&gt;char'</span>))'};
0086       <span class="keyword">end</span>
0087       
0088       
0089       <span class="comment">% read in amplitudes</span>
0090       <span class="comment">%---------------------------------------------------------------------------</span>
0091       
0092       
0093       OUTPUT(nrecs).amplitudes = fread(fid,<span class="string">'single'</span>);
0094       fclose(fid);
0095       
0096       
0097       <span class="comment">% arrange output files</span>
0098       <span class="comment">%------------------------------------------------------------------------</span>
0099       <span class="comment">%---</span>
0100       OUTPUT(nrecs).header = h(:)';
0101       
0102       
0103    <span class="keyword">end</span>
0104 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Sun 11-Oct-2015 14:40:09 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>