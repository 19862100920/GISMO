<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of DEP_xcorr</title>
  <meta name="keywords" content="DEP_xcorr">
  <meta name="description" content="C = XCORR(C)">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../../index.html">Home</a> &gt;  <a href="#">gismotools</a> &gt; <a href="../../index.html">GISMO</a> &gt; <a href="../index.html">classes</a> &gt; <a href="index.html">@correlation</a> &gt; DEP_xcorr.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../../index.html"><img alt="<" border="0" src="../../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for gismotools/GISMO/classes/@correlation&nbsp;<img alt=">" border="0" src="../../../../right.png"></a></td></tr></table>-->

<h1>DEP_xcorr
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>C = XCORR(C)</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>function c=xcorr(c,varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> C = XCORR(C)
 This function calculates and fills in the correlation and lag fields in a
 correlation object. The input is a correlation object, presumeably with
 empty correlation and lag fields. c.C is a matrix of maximum correlation
 values normalized so that autocorrelations are 1. c.L is the lag in
 seconds between the two waveforms. That is, c.L is a small time
 correction which, when added to the second trigger value, will allow the
 two waveforms to be aligned at their maximum correlation value. To align
 traces use the routine ADJUSTTRIG.

 C = XCORR(C,[PRETRIG POSTTRIG]);
 Perform cross correlation on a clipped portion of the data only. This is 
 useful when you wish to keep the entire waveform but align the traces based on 
 the correlation of a particular wavelet. PRETRIG and POSTTRIG are the
 time in seconds relative to the trigger time. Note that PRETRIG is
 negative for times before the trigger.

 C = XCORR(C,...,'1xr') Use single trace against one row algorithm (default).

 C = XCORR(C,...,'dec') Same as 1xr but decomposes complex numbers for
 calculation. Mathworks suggests this approach may be faster in some
 circumstances. However, initial testing found it slower that the 1xr
 algorithm.

 C = XCORR(C,...,'1x1') Use single trace against single trace algorithm.
 Conceivably faster when memory is very limited. In practice I have yet to
 encounter a situation where this algorithm benchmarks faster than the
 1xr.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="get.html" class="code" title="function val = get(c,prop_name)">get</a>	GET - Get correlation properties</li><li><a href="set.html" class="code" title="function c = set(c, prop_name, val)">set</a>	SET Set properties for correlation object</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function d = getwavematrix(c)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function c=xcorr(c,varargin)</a>
0002 
0003 <span class="comment">% C = XCORR(C)</span>
0004 <span class="comment">% This function calculates and fills in the correlation and lag fields in a</span>
0005 <span class="comment">% correlation object. The input is a correlation object, presumeably with</span>
0006 <span class="comment">% empty correlation and lag fields. c.C is a matrix of maximum correlation</span>
0007 <span class="comment">% values normalized so that autocorrelations are 1. c.L is the lag in</span>
0008 <span class="comment">% seconds between the two waveforms. That is, c.L is a small time</span>
0009 <span class="comment">% correction which, when added to the second trigger value, will allow the</span>
0010 <span class="comment">% two waveforms to be aligned at their maximum correlation value. To align</span>
0011 <span class="comment">% traces use the routine ADJUSTTRIG.</span>
0012 <span class="comment">%</span>
0013 <span class="comment">% C = XCORR(C,[PRETRIG POSTTRIG]);</span>
0014 <span class="comment">% Perform cross correlation on a clipped portion of the data only. This is</span>
0015 <span class="comment">% useful when you wish to keep the entire waveform but align the traces based on</span>
0016 <span class="comment">% the correlation of a particular wavelet. PRETRIG and POSTTRIG are the</span>
0017 <span class="comment">% time in seconds relative to the trigger time. Note that PRETRIG is</span>
0018 <span class="comment">% negative for times before the trigger.</span>
0019 <span class="comment">%</span>
0020 <span class="comment">% C = XCORR(C,...,'1xr') Use single trace against one row algorithm (default).</span>
0021 <span class="comment">%</span>
0022 <span class="comment">% C = XCORR(C,...,'dec') Same as 1xr but decomposes complex numbers for</span>
0023 <span class="comment">% calculation. Mathworks suggests this approach may be faster in some</span>
0024 <span class="comment">% circumstances. However, initial testing found it slower that the 1xr</span>
0025 <span class="comment">% algorithm.</span>
0026 <span class="comment">%</span>
0027 <span class="comment">% C = XCORR(C,...,'1x1') Use single trace against single trace algorithm.</span>
0028 <span class="comment">% Conceivably faster when memory is very limited. In practice I have yet to</span>
0029 <span class="comment">% encounter a situation where this algorithm benchmarks faster than the</span>
0030 <span class="comment">% 1xr.</span>
0031 
0032 <span class="comment">% Author: Michael West, Geophysical Institute, Univ. of Alaska Fairbanks</span>
0033 <span class="comment">% $Date$</span>
0034 <span class="comment">% $Revision$</span>
0035 
0036 
0037 
0038 <span class="comment">% GET INPUT PARAMETERS</span>
0039 <span class="keyword">if</span> ~isa(c,<span class="string">'correlation'</span>)
0040     disp(<span class="string">'First input parameter must be a correlation object'</span>);
0041 <span class="keyword">end</span>
0042 
0043 
0044 <span class="keyword">if</span> length(varargin)&gt;0
0045 
0046     <span class="comment">% CHECK ALGORITHM</span>
0047     <span class="keyword">if</span> ischar(varargin{end})
0048         algorithm = lower(varargin{end});
0049         varargin = varargin(1:end-1);
0050     <span class="keyword">else</span>
0051         algorithm = <span class="string">'1xr'</span>;
0052     <span class="keyword">end</span>;
0053 
0054     <span class="comment">% APPLY CLIPPING</span>
0055     varargin
0056     <span class="keyword">if</span> length(varargin{end})==2       <span class="comment">% check for clipping values</span>
0057         pretrig =  varargin{1}(1);
0058         posttrig = varargin{1}(2);
0059         c1 = clip(c,pretrig,posttrig);
0060     <span class="keyword">else</span>
0061         c1 = c;
0062     <span class="keyword">end</span>
0063 
0064     <span class="comment">% ADD CORRELATION</span>
0065     <span class="keyword">if</span> isa(varargin(2),<span class="string">'correlation'</span>)
0066         c2 = varargin(2);
0067         algorithm = <span class="string">'cxc'</span>;
0068     <span class="keyword">end</span>
0069 <span class="keyword">else</span>
0070     c1 = c;
0071     algorithm = <span class="string">'1xr'</span>;
0072 <span class="keyword">end</span>
0073     
0074     
0075 <span class="comment">% CREATE MATRIX OF DATA FROM WAVEFORM ARRAY</span>
0076 <span class="comment">% The correlation object is modified here into a Matlab structure that</span>
0077 <span class="comment">% shares similar fields to the object except that the the trace data is</span>
0078 <span class="comment">% stored in a matrix instead of in a waveform object. This structure is</span>
0079 <span class="comment">% passed to the correlation subroutines as 'd'. The matrix structure</span>
0080 <span class="comment">% improves computation speed because fft and other routines are optomized</span>
0081 <span class="comment">% for matrices. This structure is based on the correlation object version</span>
0082 <span class="comment">% 0.</span>
0083 
0084 d.start = <a href="get.html" class="code" title="function val = get(c,prop_name)">get</a>(c1.W,<span class="string">'START_MATLAB'</span>);
0085 d.Fs    = <a href="get.html" class="code" title="function val = get(c,prop_name)">get</a>(c1.W(1),<span class="string">'Fs'</span>);
0086 d.trig  = c1.trig;
0087 d.w     = [];
0088 <span class="keyword">for</span> i = 1:length(c1.W)
0089     d.w(:,i) = <a href="get.html" class="code" title="function val = get(c,prop_name)">get</a>(c1.W(i),<span class="string">'DATA'</span>);
0090 <span class="keyword">end</span>;
0091 clear c1
0092 
0093 
0094 <span class="comment">% EXECUTE CROSS CORRELATION</span>
0095 <span class="keyword">if</span> exist(<span class="string">'pretrig'</span>) &amp;&amp; exist(<span class="string">'posttrig'</span>)
0096     disp([<span class="string">'using '</span> algorithm <span class="string">' algorithm on the time interval ['</span> num2str(pretrig) <span class="string">' '</span> num2str(posttrig) <span class="string">'] ...'</span> ]);
0097 <span class="keyword">else</span>
0098     disp([<span class="string">'using '</span> algorithm <span class="string">' algorithm ...'</span>]);
0099 <span class="keyword">end</span>    
0100 <span class="keyword">if</span> strcmp(algorithm,<span class="string">'1x1'</span>)==1
0101     d = xcorr1x1(d);
0102   <span class="keyword">elseif</span> strcmp(algorithm,<span class="string">'1xr'</span>)
0103       d = xcorr1xr(d);
0104   <span class="keyword">elseif</span> strcmp(algorithm,<span class="string">'dec'</span>)
0105       d = xcorrdec(d);
0106   <span class="keyword">elseif</span> strcmp(algorithm,<span class="string">'cxc'</span>)
0107       d = xcorrcxc(d);
0108 <span class="keyword">end</span>;
0109 
0110 
0111 <span class="comment">% ASSIGN CORRELATION PARAMETERS TO ORIGINAL DATA</span>
0112 c = <a href="set.html" class="code" title="function c = set(c, prop_name, val)">set</a>( c , <span class="string">'CORR'</span> , d.C );
0113 c = <a href="set.html" class="code" title="function c = set(c, prop_name, val)">set</a>( c , <span class="string">'LAG'</span>  , d.L  );
0114 clear d
0115 
0116 
0117 <span class="comment">% CREATE MATRIX OF WAVEFORM DATA</span>
0118     <a name="_sub1" href="#_subfunctions" class="code">function d = getwavematrix(c)</a>
0119 d.start = <a href="get.html" class="code" title="function val = get(c,prop_name)">get</a>(c.W,<span class="string">'START_MATLAB'</span>);
0120 d.Fs    = <a href="get.html" class="code" title="function val = get(c,prop_name)">get</a>(c.W(1),<span class="string">'Fs'</span>);
0121 d.trig  = c.trig;
0122 d.w     = [];
0123 <span class="keyword">for</span> i = 1:length(c.W)
0124     d.w(:,i) = <a href="get.html" class="code" title="function val = get(c,prop_name)">get</a>(c.W(i),<span class="string">'DATA'</span>);
0125 <span class="keyword">end</span>;</pre></div>
<hr><address>Generated on Sun 11-Oct-2015 14:40:09 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>