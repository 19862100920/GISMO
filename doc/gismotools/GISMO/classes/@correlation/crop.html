<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of crop</title>
  <meta name="keywords" content="crop">
  <meta name="description" content="c = CROP(c,[PRETRIG POSTTRIG])">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../../index.html">Home</a> &gt;  <a href="#">gismotools</a> &gt; <a href="../../index.html">GISMO</a> &gt; <a href="../index.html">classes</a> &gt; <a href="index.html">@correlation</a> &gt; crop.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../../index.html"><img alt="<" border="0" src="../../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for gismotools/GISMO/classes/@correlation&nbsp;<img alt=">" border="0" src="../../../../right.png"></a></td></tr></table>-->

<h1>crop
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>c = CROP(c,[PRETRIG POSTTRIG])</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>function c = crop(c,varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> c = CROP(c,[PRETRIG POSTTRIG])
 This function crop all waveforms to a time window defined by pretrig and
 posttrig. Pretrig and posttrig are values in seconds relative to the
 trigger time. The START field is adjusted for the new trace start times.
 Any missing data is replaced with zeros. Typically this operation will
 be used after traces have been aligned on a common trigger (with
 ADJUSTTRIG).

 c = CROP(c,PRETRIG,POSTTRIG) Alternate input format. Included for backward 
 compatibility. The first usage is more consistent with other uses of 
 PRETRIG and POSTTRIG.
 
 EXAMPLE:
    C = CROP(C,[-3 5])
    CROPS the traces to 8 seconds in length beginning 3 seconds before the
    trigger.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="get.html" class="code" title="function val = get(c,prop_name)">get</a>	GET - Get correlation properties</li><li><a href="set.html" class="code" title="function c = set(c, prop_name, val)">set</a>	SET Set properties for correlation object</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="correlation.html" class="code" title="function c = correlation(varargin)">correlation</a>	</li><li><a href="interferogram.html" class="code" title="function [c,t,i,CC,LL] = interferogram(c,varargin)">interferogram</a>	C = INTERFEROGRAM(C)</li><li><a href="minus.html" class="code" title="function c = minus(c,varargin)">minus</a>	C = MINUS(C,I)</li><li><a href="norm.html" class="code" title="function c = norm(c,varargin)">norm</a>	C = NORM(C)</li><li><a href="stack.html" class="code" title="function c = stack(c,varargin)">stack</a>	c = STACK(c)</li><li><a href="xcorr.html" class="code" title="function c=xcorr(c,varargin)">xcorr</a>	C = XCORR(C)</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function c = crop(c,varargin)</a>
0002 
0003 <span class="comment">% c = CROP(c,[PRETRIG POSTTRIG])</span>
0004 <span class="comment">% This function crop all waveforms to a time window defined by pretrig and</span>
0005 <span class="comment">% posttrig. Pretrig and posttrig are values in seconds relative to the</span>
0006 <span class="comment">% trigger time. The START field is adjusted for the new trace start times.</span>
0007 <span class="comment">% Any missing data is replaced with zeros. Typically this operation will</span>
0008 <span class="comment">% be used after traces have been aligned on a common trigger (with</span>
0009 <span class="comment">% ADJUSTTRIG).</span>
0010 <span class="comment">%</span>
0011 <span class="comment">% c = CROP(c,PRETRIG,POSTTRIG) Alternate input format. Included for backward</span>
0012 <span class="comment">% compatibility. The first usage is more consistent with other uses of</span>
0013 <span class="comment">% PRETRIG and POSTTRIG.</span>
0014 <span class="comment">%</span>
0015 <span class="comment">% EXAMPLE:</span>
0016 <span class="comment">%    C = CROP(C,[-3 5])</span>
0017 <span class="comment">%    CROPS the traces to 8 seconds in length beginning 3 seconds before the</span>
0018 <span class="comment">%    trigger.</span>
0019 <span class="comment">%</span>
0020 
0021 <span class="comment">% Author: Michael West, Geophysical Institute, Univ. of Alaska Fairbanks</span>
0022 <span class="comment">% $Date$</span>
0023 <span class="comment">% $Revision$</span>
0024 
0025 
0026 <span class="comment">% READ &amp; CHECK ARGUMENTS</span>
0027 <span class="keyword">if</span> ~strcmpi(class(c),<span class="string">'correlation'</span>)
0028     error(<span class="string">'First input must be a correlation object'</span>);
0029 <span class="keyword">end</span>
0030 
0031 <span class="keyword">if</span> (nargin==3)
0032     pretrig =  varargin{1};
0033     posttrig = varargin{2};
0034 <span class="keyword">elseif</span> (nargin==2)
0035     tmp = varargin{1};
0036     <span class="keyword">if</span> numel(tmp)~=2
0037         error(<span class="string">'When CROP has only two arguments, the latter must be a two element vector. See HELP CORRELATION/CROP'</span>)
0038     <span class="keyword">end</span>
0039     pretrig = tmp(1);
0040     posttrig = tmp(2);
0041 <span class="keyword">else</span>
0042     error(<span class="string">'Wrong number of inputs'</span>);
0043 <span class="keyword">end</span>;
0044 
0045 <span class="comment">%added cr</span>
0046 pretrig= pretrig(1);
0047 posttrig=posttrig(1);
0048 
0049 <span class="comment">% CROP EACH TRACES</span>
0050 freq = <a href="get.html" class="code" title="function val = get(c,prop_name)">get</a>(c,<span class="string">'Fs'</span>);
0051 wStarts = <a href="get.html" class="code" title="function val = get(c,prop_name)">get</a>(c.W,<span class="string">'start_matlab'</span>);
0052 imax = <a href="get.html" class="code" title="function val = get(c,prop_name)">get</a>(c,<span class="string">'Traces'</span>);
0053 Mo = <a href="get.html" class="code" title="function val = get(c,prop_name)">get</a>(c,<span class="string">'Data_Length'</span>);
0054 M = round(freq*(posttrig-pretrig));
0055 wstartrel = 86400*(wStarts-c.trig);    <span class="comment">% relative start time, typically negative</span>
0056 s1_all =round(freq * (wstartrel - pretrig)); 
0057 samp_per_day = 86400 * freq;
0058 <span class="comment">%%start2 = zeros(imax,1);</span>
0059 d = double(c.W);
0060 <span class="keyword">for</span> i = 1:imax
0061     <span class="comment">%d = get(c.W(i),'DATA');                                     % extract trace</span>
0062     <span class="comment">%wstartrel = 86400*(wStarts(i)-c.trig(i));    % relative start time, typically negative</span>
0063     <span class="comment">%s1 = round(freq*(wstartrel(i)-pretrig));                % number of</span>
0064     <span class="comment">%samples to pad or crop</span>
0065     w2 = zeros(M,1);
0066     <span class="keyword">if</span> s1_all(i) &gt; 0                         <span class="comment">% beginning of traces must be PADDED</span>
0067         s2 =  min([Mo M-s1_all(i)]);         <span class="comment">% number of data samples to include</span>
0068         w2(s1_all(i)+1:s1_all(i)+s2) = d(1:s2,i);     <span class="comment">% Pad beginning with zeros</span>
0069         start2 = wStarts(i)-(s1_all(i))/samp_per_day;
0070         <span class="comment">%c.W(i) = set(c.W(i),'DATA',w2,'start',start2);</span>
0071         <span class="comment">%c.W(i) = set(c.W(i),'Start',start2);</span>
0072     <span class="keyword">else</span>       
0073         s1 = -1*s1_all(i);                   <span class="comment">% beginning of traces must be CLIPPED</span>
0074         s2 =  min([Mo-s1 M]);         <span class="comment">% number of data samples to include</span>
0075         w2(1:s2) = d(s1+1:s1+s2,i);     <span class="comment">% crop beginning</span>
0076         start2 = wStarts(i)+(s1)/samp_per_day;
0077         <span class="comment">%c.W(i) = set(c.W(i),'DATA',w2);</span>
0078         <span class="comment">%c.W(i) = set(c.W(i),'Start',start2);</span>
0079     <span class="keyword">end</span>;
0080         c.W(i) = <a href="set.html" class="code" title="function c = set(c, prop_name, val)">set</a>(c.W(i),<span class="string">'DATA'</span>,w2,<span class="string">'start'</span>,start2);
0081 <span class="keyword">end</span>;
0082 c.W = addhistory(c.W,<span class="string">'correlation/crop'</span>);
0083</pre></div>
<hr><address>Generated on Sun 11-Oct-2015 14:40:09 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>