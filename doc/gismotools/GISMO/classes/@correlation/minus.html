<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of minus</title>
  <meta name="keywords" content="minus">
  <meta name="description" content="C = MINUS(C,I)">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../../index.html">Home</a> &gt;  <a href="#">gismotools</a> &gt; <a href="../../index.html">GISMO</a> &gt; <a href="../index.html">classes</a> &gt; <a href="index.html">@correlation</a> &gt; minus.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../../index.html"><img alt="<" border="0" src="../../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for gismotools/GISMO/classes/@correlation&nbsp;<img alt=">" border="0" src="../../../../right.png"></a></td></tr></table>-->

<h1>minus
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>C = MINUS(C,I)</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>function c = minus(c,varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> C = MINUS(C,I)
 The function subtracts the waveform specified by trace index I from all
 other traces. The resulting correlation object has the same number of
 traces as the original though trace I is essentially zero amplitude.

 C = MINUS(C)
 Short hand version of MINUS where I is assumed to be the last trace in
 the list. That is, MINUS(C, get(C,'TRACES') ). This use is common
 following the STACK routine.

 Before using MINUS, time windows need to be cropped to the same interval
 relative to the triggers. This is most easily accomplished using the CROP
 function prior to MINUS. If the traces have not been cropped, MINUS will
 attempt to figure out which time window of data should be differenced.
 This can result in unanticipated signals at the ends of each trace.
 Caveat Emptor!

 MINUS will erase the CORR, LAG, STAT, LINK and CLUST fields from the
 objects. After differencing, these fields are no longer valid. 
 
 The traces are not normalized prior to subtracting. For most
 applications the user will first want to normalize the trace amplitudes
 using the NORM function. Typically, plots of the residual data will use
 the 'raw' plotting option.

 In order to be differenced, the &quot;phase shift&quot; of the samples within the
 trace must be the same. If it is not, MINUS will make a call to ALIGN to
 resample all traces such that one sample falls directly on the trigger
 time.
 
 Example - subtract the stacked waveform from each trace
   c = xcorr(c)
   c = adjusttrig(c)
   c = crop(c,-3,5)
   c = stack(c)
   c = norm(c)      % stacked waveform is the last trace
   c_residual = minus(c)
   plot(c_residual,'raw');</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="align.html" class="code" title="function c = align(c,varargin)">align</a>	c = ALIGN(c)</li><li><a href="check.html" class="code" title="function val = check(c,varargin)">check</a>	Check various features of a correlation object.</li><li><a href="correlation.html" class="code" title="function c = correlation(varargin)">correlation</a>	</li><li><a href="crop.html" class="code" title="function c = crop(c,varargin)">crop</a>	c = CROP(c,[PRETRIG POSTTRIG])</li><li><a href="get.html" class="code" title="function val = get(c,prop_name)">get</a>	GET - Get correlation properties</li><li><a href="set.html" class="code" title="function c = set(c, prop_name, val)">set</a>	SET Set properties for correlation object</li><li><a href="subset.html" class="code" title="function c = subset(c,index)">subset</a>	c = SUBSET(c,INDEX)</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function c = minus(c,varargin)</a>
0002 
0003 <span class="comment">% C = MINUS(C,I)</span>
0004 <span class="comment">% The function subtracts the waveform specified by trace index I from all</span>
0005 <span class="comment">% other traces. The resulting correlation object has the same number of</span>
0006 <span class="comment">% traces as the original though trace I is essentially zero amplitude.</span>
0007 <span class="comment">%</span>
0008 <span class="comment">% C = MINUS(C)</span>
0009 <span class="comment">% Short hand version of MINUS where I is assumed to be the last trace in</span>
0010 <span class="comment">% the list. That is, MINUS(C, get(C,'TRACES') ). This use is common</span>
0011 <span class="comment">% following the STACK routine.</span>
0012 <span class="comment">%</span>
0013 <span class="comment">% Before using MINUS, time windows need to be cropped to the same interval</span>
0014 <span class="comment">% relative to the triggers. This is most easily accomplished using the CROP</span>
0015 <span class="comment">% function prior to MINUS. If the traces have not been cropped, MINUS will</span>
0016 <span class="comment">% attempt to figure out which time window of data should be differenced.</span>
0017 <span class="comment">% This can result in unanticipated signals at the ends of each trace.</span>
0018 <span class="comment">% Caveat Emptor!</span>
0019 <span class="comment">%</span>
0020 <span class="comment">% MINUS will erase the CORR, LAG, STAT, LINK and CLUST fields from the</span>
0021 <span class="comment">% objects. After differencing, these fields are no longer valid.</span>
0022 <span class="comment">%</span>
0023 <span class="comment">% The traces are not normalized prior to subtracting. For most</span>
0024 <span class="comment">% applications the user will first want to normalize the trace amplitudes</span>
0025 <span class="comment">% using the NORM function. Typically, plots of the residual data will use</span>
0026 <span class="comment">% the 'raw' plotting option.</span>
0027 <span class="comment">%</span>
0028 <span class="comment">% In order to be differenced, the &quot;phase shift&quot; of the samples within the</span>
0029 <span class="comment">% trace must be the same. If it is not, MINUS will make a call to ALIGN to</span>
0030 <span class="comment">% resample all traces such that one sample falls directly on the trigger</span>
0031 <span class="comment">% time.</span>
0032 <span class="comment">%</span>
0033 <span class="comment">% Example - subtract the stacked waveform from each trace</span>
0034 <span class="comment">%   c = xcorr(c)</span>
0035 <span class="comment">%   c = adjusttrig(c)</span>
0036 <span class="comment">%   c = crop(c,-3,5)</span>
0037 <span class="comment">%   c = stack(c)</span>
0038 <span class="comment">%   c = norm(c)      % stacked waveform is the last trace</span>
0039 <span class="comment">%   c_residual = minus(c)</span>
0040 <span class="comment">%   plot(c_residual,'raw');</span>
0041 
0042 <span class="comment">% Author: Michael West, Geophysical Institute, Univ. of Alaska Fairbanks</span>
0043 <span class="comment">% $Date$</span>
0044 <span class="comment">% $Revision$</span>
0045 
0046 
0047 <span class="comment">% READ &amp; CHECK ARGUMENTS</span>
0048 <span class="keyword">if</span> (nargin&gt;2)
0049     error(<span class="string">'Wrong number of inputs'</span>);
0050 <span class="keyword">end</span>;
0051 
0052 <span class="keyword">if</span> ~strcmpi(class(c),<span class="string">'correlation'</span>)
0053     error(<span class="string">'First input must be a correlation object'</span>);
0054 <span class="keyword">end</span>
0055 
0056 <span class="keyword">if</span> ( length(varargin) == 1 )
0057     I = varargin;
0058     <span class="keyword">if</span> length(I) &gt; 1
0059         error(<span class="string">'Only one trace can be subtracted from the others'</span>);
0060     <span class="keyword">end</span>
0061 <span class="keyword">else</span>
0062     I = <a href="get.html" class="code" title="function val = get(c,prop_name)">get</a>(c,<span class="string">'TRACES'</span>);
0063 <span class="keyword">end</span>
0064 
0065 <span class="keyword">if</span> <a href="check.html" class="code" title="function val = check(c,varargin)">check</a>(c,<span class="string">'SCALE'</span>)
0066     disp(<span class="string">'Warning: Traces appear to have very different overall amplitudes'</span>);
0067 <span class="keyword">end</span>
0068 
0069 
0070 
0071 
0072 <span class="comment">% CREATE CORREATION OBJECT FOR INTERNAL MANIPULATIONS</span>
0073 c1 = <a href="correlation.html" class="code" title="function c = correlation(varargin)">correlation</a>;
0074 c1 = <a href="set.html" class="code" title="function c = set(c, prop_name, val)">set</a>(c1,<span class="string">'WAVEFORM'</span>, <a href="get.html" class="code" title="function val = get(c,prop_name)">get</a>(c,<span class="string">'WAVEFORM'</span>) );
0075 c1 = <a href="set.html" class="code" title="function c = set(c, prop_name, val)">set</a>(c1,<span class="string">'TRIG'</span>, <a href="get.html" class="code" title="function val = get(c,prop_name)">get</a>(c,<span class="string">'TRIG'</span>) );
0076 <span class="keyword">if</span> exist(<span class="string">'index'</span>)               <span class="comment">% Is this necessary?</span>
0077    c1 = <a href="subset.html" class="code" title="function c = subset(c,index)">subset</a>(c1,index); 
0078 <span class="keyword">end</span>
0079 
0080 
0081 <span class="comment">% CHECK IF TRACES ARE DESCRITIZED ON THE SAME INVERVALS</span>
0082 t = 86400 * (c1.trig - <a href="get.html" class="code" title="function val = get(c,prop_name)">get</a>(c1.W,<span class="string">'START'</span>));
0083 Fs = <a href="get.html" class="code" title="function val = get(c,prop_name)">get</a>(c1,<span class="string">'Fs'</span>);
0084 sampleshift = mod(t,1/Fs);
0085 <span class="keyword">if</span> (mean(sampleshift) ~= sampleshift)   <span class="comment">% if all sampleshifts are the same</span>
0086     c1 = <a href="align.html" class="code" title="function c = align(c,varargin)">align</a>(c1);
0087 <span class="keyword">end</span>
0088 
0089 
0090 <span class="comment">% CHECK IF TRACES ARE EQUALLY CROPPED</span>
0091 pretrig  = <a href="get.html" class="code" title="function val = get(c,prop_name)">get</a>(c1,<span class="string">'START'</span>) - <a href="get.html" class="code" title="function val = get(c,prop_name)">get</a>(c1,<span class="string">'TRIG'</span>);
0092 posttrig = <a href="get.html" class="code" title="function val = get(c,prop_name)">get</a>(c1,<span class="string">'END'</span>)   - <a href="get.html" class="code" title="function val = get(c,prop_name)">get</a>(c1,<span class="string">'TRIG'</span>);
0093 <span class="keyword">if</span> (mean(pretrig)~=pretrig(1)) || (mean(posttrig)~=posttrig(1))
0094     center = mean([pretrig ; posttrig])*86400;
0095     pretrig = center - (0.5 * <a href="get.html" class="code" title="function val = get(c,prop_name)">get</a>(c1,<span class="string">'DATA_LENGTH'</span>) * <a href="get.html" class="code" title="function val = get(c,prop_name)">get</a>(c1,<span class="string">'Period'</span>));
0096     posttrig = pretrig + (<a href="get.html" class="code" title="function val = get(c,prop_name)">get</a>(c1,<span class="string">'DATA_LENGTH'</span>)+1) * <a href="get.html" class="code" title="function val = get(c,prop_name)">get</a>(c1,<span class="string">'Period'</span>);
0097     <span class="comment">% is it the right length?</span>
0098     c1 = <a href="crop.html" class="code" title="function c = crop(c,varargin)">crop</a>(c1,pretrig(1),posttrig(1)); <span class="comment">%should all have same pre &amp; post</span>
0099 <span class="keyword">end</span>
0100 
0101 toSubtract = <a href="get.html" class="code" title="function val = get(c,prop_name)">get</a>(c1.W(I),<span class="string">'Data'</span>); <span class="comment">%this trace will be subtracted from all</span>
0102 <span class="keyword">for</span> i = 1:length(c.trig)
0103     <span class="comment">%c.W(i) = minus( c1.W(i) , c1.W(I) );</span>
0104     d = <a href="get.html" class="code" title="function val = get(c,prop_name)">get</a>(c1.W(i),<span class="string">'Data'</span>) - toSubtract;
0105     c.W(i) = <a href="set.html" class="code" title="function c = set(c, prop_name, val)">set</a>( c.W(i) , <span class="string">'Data'</span> , d);
0106     c.trig(i) = c1.trig(i);
0107 <span class="keyword">end</span>
0108 c.C = [];
0109 c.L = [];
0110 c.stat = [];
0111 c.link = [];
0112 c.clust = [];
0113 
0114</pre></div>
<hr><address>Generated on Sun 11-Oct-2015 14:40:09 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>