<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of load_objects_from_file</title>
  <meta name="keywords" content="load_objects_from_file">
  <meta name="description" content="grab all the variables in a matlab file, and flip through them, returning">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../../index.html">Home</a> &gt;  <a href="#">gismotools</a> &gt; <a href="../../index.html">GISMO</a> &gt; <a href="../index.html">classes</a> &gt; <a href="index.html">@datasource</a> &gt; load_objects_from_file.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../../index.html"><img alt="<" border="0" src="../../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for gismotools/GISMO/classes/@datasource&nbsp;<img alt=">" border="0" src="../../../../right.png"></a></td></tr></table>-->

<h1>load_objects_from_file
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>grab all the variables in a matlab file, and flip through them, returning</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>function allObj = load_objects_from_file(ds,searchClass,scnl,startt,endt) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">grab all the variables in a matlab file, and flip through them, returning
those that match the criteria
 allObj = load_file(datasource,searchClass,scnl,starttime,endtime)
   DATASOURCE is a single datasource object (of type &quot;file&quot;)
   SEARCHCLASS is a string containing the name of the class you are
   searching for.  eg, 'double','waveform', etc.
   SCNL is an array of scnlobjects which hold
   station/channel/network/location matches.
   STARTTIME is the starting time in matlab datenum format
   ENDTIME is the ending time in matlab datenum format

   This function returns a 1xN dimesional array of all relevent objects
   found within the searched file(s).  All variable identity from within
   the files is lost.
   - - -
   SO, for example, in the context of searching for waveform data...
   if there is a searchfile, that contians the variables: W (1x3
   waveform), W2 (1x1 waveform), MyWc (2x2 cell with waveforms in it), and
   D (double).

   the load_file method will rip out each and every waveform (recursing
   through cells), then lump all of them into a large 1xN waveform.  Each
   waveform that doesn't meet the SCNL criteria is discarded.  Then, all
   waveforms that don't have data somewhere within the starttime-endtime
   timeframe will be discarded as well.

   It is important to note that the recovered objects aren't trimmed to
   the starttime-endtime timeeframe.  That is, individual objects are not
   altered through the use of this function.


 Any object can be loaded from file, however since this was designed to
 work with seismic data, it must have an ISMEMBER function that takes as
 it's parameters the object itself and a SCNLobject.  Also required is the
 [Starts Ends] = GETTIMERANGE(obj) function. (see waveform/gettimerange
 for an example implementation.

 see also ISMEMBER, WAVEFORM/GETTIMERANGE</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="disp.html" class="code" title="function disp(ds)">disp</a>	DISP Datasource disp overloaded operator</li><li><a href="getfilename.html" class="code" title="function [filename] = getfilename(ds, scnls, starttimes)">getfilename</a>	GETFILENAME returns a filename that is associated with a single SCNL</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function hasValidRange = isWithinTimeRange(myObj,startt,endt)</a></li><li><a href="#_sub2" class="code">function mObj = myObjectsFromCells(searchClass, mycell)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function allObj = load_objects_from_file(ds,searchClass,scnl,startt,endt)</a>
0002    <span class="comment">%grab all the variables in a matlab file, and flip through them, returning</span>
0003    <span class="comment">%those that match the criteria</span>
0004    <span class="comment">% allObj = load_file(datasource,searchClass,scnl,starttime,endtime)</span>
0005    <span class="comment">%   DATASOURCE is a single datasource object (of type &quot;file&quot;)</span>
0006    <span class="comment">%   SEARCHCLASS is a string containing the name of the class you are</span>
0007    <span class="comment">%   searching for.  eg, 'double','waveform', etc.</span>
0008    <span class="comment">%   SCNL is an array of scnlobjects which hold</span>
0009    <span class="comment">%   station/channel/network/location matches.</span>
0010    <span class="comment">%   STARTTIME is the starting time in matlab datenum format</span>
0011    <span class="comment">%   ENDTIME is the ending time in matlab datenum format</span>
0012    <span class="comment">%</span>
0013    <span class="comment">%   This function returns a 1xN dimesional array of all relevent objects</span>
0014    <span class="comment">%   found within the searched file(s).  All variable identity from within</span>
0015    <span class="comment">%   the files is lost.</span>
0016    <span class="comment">%   - - -</span>
0017    <span class="comment">%   SO, for example, in the context of searching for waveform data...</span>
0018    <span class="comment">%   if there is a searchfile, that contians the variables: W (1x3</span>
0019    <span class="comment">%   waveform), W2 (1x1 waveform), MyWc (2x2 cell with waveforms in it), and</span>
0020    <span class="comment">%   D (double).</span>
0021    <span class="comment">%</span>
0022    <span class="comment">%   the load_file method will rip out each and every waveform (recursing</span>
0023    <span class="comment">%   through cells), then lump all of them into a large 1xN waveform.  Each</span>
0024    <span class="comment">%   waveform that doesn't meet the SCNL criteria is discarded.  Then, all</span>
0025    <span class="comment">%   waveforms that don't have data somewhere within the starttime-endtime</span>
0026    <span class="comment">%   timeframe will be discarded as well.</span>
0027    <span class="comment">%</span>
0028    <span class="comment">%   It is important to note that the recovered objects aren't trimmed to</span>
0029    <span class="comment">%   the starttime-endtime timeeframe.  That is, individual objects are not</span>
0030    <span class="comment">%   altered through the use of this function.</span>
0031    <span class="comment">%</span>
0032    <span class="comment">%</span>
0033    <span class="comment">% Any object can be loaded from file, however since this was designed to</span>
0034    <span class="comment">% work with seismic data, it must have an ISMEMBER function that takes as</span>
0035    <span class="comment">% it's parameters the object itself and a SCNLobject.  Also required is the</span>
0036    <span class="comment">% [Starts Ends] = GETTIMERANGE(obj) function. (see waveform/gettimerange</span>
0037    <span class="comment">% for an example implementation.</span>
0038    <span class="comment">%</span>
0039    <span class="comment">% see also ISMEMBER, WAVEFORM/GETTIMERANGE</span>
0040    
0041    <span class="comment">%The file looks a little opaque because it deals generically with classes</span>
0042    <span class="comment">%and objects, rather than tying itself down to any particular object.</span>
0043    allfilen = <a href="getfilename.html" class="code" title="function [filename] = getfilename(ds, scnls, starttimes)">getfilename</a>(ds,scnl,startt);
0044    <span class="keyword">for</span> thisfile = 1 : numel(allfilen)
0045       filen = allfilen{thisfile};
0046       
0047       <span class="keyword">if</span> ~exist(filen,<span class="string">'file'</span>)
0048          <a href="disp.html" class="code" title="function disp(ds)">disp</a>([<span class="string">'unable to find file: '</span>, filen]);
0049          <span class="keyword">continue</span>
0050       <span class="keyword">end</span>
0051       
0052       <span class="comment">%find out which variables exist within the file...</span>
0053       fcontents = whos(<span class="string">'-file'</span>,filen);
0054       variablesToLoad = ismember({fcontents.class},{searchClass, <span class="string">'cell'</span>});
0055       <span class="keyword">if</span> ~any(variablesToLoad),
0056          <span class="comment">%disp(['no items of the this class exist within the file:',filen]);</span>
0057          <span class="keyword">continue</span>
0058       <span class="keyword">end</span>
0059       stuff =load(filen,fcontents(variablesToLoad).name);
0060       
0061       fieldn = fieldnames(stuff);
0062       
0063       <span class="comment">%Look through all variables that were loaded, looking for the desired</span>
0064       <span class="comment">%class.  If a cell is encountered, then look for occurrences of that class</span>
0065       <span class="comment">%within the cell (recursively).</span>
0066       
0067       myObjectMask = false(size(fieldn));
0068       holder = cell(size(fieldn));
0069       <span class="keyword">for</span> fieldidx = 1:numel(fieldn)
0070          thisfield =  fieldn{fieldidx};
0071          <span class="comment">%grab all myObjects</span>
0072          <span class="keyword">if</span> isa(stuff.(thisfield),searchClass)
0073             holder(fieldidx) = {reshape(stuff.(thisfield),1,numel(stuff.(thisfield)))};
0074             myObjectMask(fieldidx) = true;
0075             stuff.(thisfield) = {};
0076          <span class="keyword">elseif</span> isa(stuff.(thisfield),<span class="string">'cell'</span>)
0077             holder(fieldidx) = {<a href="#_sub2" class="code" title="subfunction mObj = myObjectsFromCells(searchClass, mycell)">myObjectsFromCells</a>(searchClass,stuff.(thisfield))};
0078             myObjectMask(fieldidx) = true;
0079          <span class="keyword">else</span>
0080             stuff.(thisfield) = {};
0081          <span class="keyword">end</span>
0082       <span class="keyword">end</span>
0083       myObj = [holder{myObjectMask}];
0084       myObj = myObj(ismember(myObj,scnl));
0085       
0086       
0087       <span class="comment">%now get rid of any that don't match the time criteria.</span>
0088       hasValidRange = <a href="#_sub1" class="code" title="subfunction hasValidRange = isWithinTimeRange(myObj,startt,endt)">isWithinTimeRange</a>(myObj,startt,endt);
0089       allObj(thisfile) = {myObj(hasValidRange)};
0090       
0091       
0092    <span class="keyword">end</span>
0093    
0094    
0095    <span class="keyword">if</span> ~exist(<span class="string">'allObj'</span>,<span class="string">'var'</span>)
0096       warning(<span class="string">'no %ss found'</span>,searchClass);
0097       allObj = {};
0098    <span class="keyword">end</span>
0099    
0100    allObj = [allObj{:}];
0101    
0102 <span class="keyword">end</span>
0103 <a name="_sub1" href="#_subfunctions" class="code">function hasValidRange = isWithinTimeRange(myObj,startt,endt)</a>
0104    
0105    [theseStarts, theseEnds] = gettimerange(myObj);
0106    hasValidRange = false(size(theseStarts));
0107    
0108    <span class="comment">%   if isempty(theseStarts) || isempty(theseEnds)</span>
0109    <span class="comment">%     warning('Datasource:ObjectNoTimes',...</span>
0110    <span class="comment">%       'One or more objects have no start or end times associated with them');</span>
0111    <span class="comment">%     return;</span>
0112    <span class="comment">%   end</span>
0113    
0114    <span class="comment">%check each object's range against all requested ranges</span>
0115    <span class="keyword">for</span> timeidx = 1:numel(startt)
0116       requestedStart = startt(timeidx);
0117       requestedEnd = endt(timeidx);
0118       
0119       <span class="comment">% make sure the data doesn't start AFTER requested data...</span>
0120       validStarts = (theseStarts &lt;=requestedEnd);
0121       <span class="comment">% ...and make sure the data deosn't end BEFORE requested data</span>
0122       validEnds = (theseEnds &gt;= requestedStart);
0123       
0124       <span class="comment">%add objects that match the criteria to the OK list</span>
0125       hasValidRange = hasValidRange | (validStarts &amp; validEnds);
0126    <span class="keyword">end</span>
0127 <span class="keyword">end</span>
0128 
0129 <a name="_sub2" href="#_subfunctions" class="code">function mObj = myObjectsFromCells(searchClass, mycell)</a>
0130    myObjectMask = false(size(mycell));
0131    <span class="keyword">for</span> i=1:numel(mycell);
0132       <span class="keyword">if</span> isa(mycell{i},searchClass),
0133          myObjectMask(i) = true;
0134          mycell(i) = {reshape(mycell{i},1,numel(mycell{i}))}; <span class="comment">%make all myObjects 1xN</span>
0135       <span class="keyword">elseif</span> isa(mycell{i},<span class="string">'cell'</span>) <span class="comment">%it's a cell, let's recurse</span>
0136          mycell(i) = {<a href="#_sub2" class="code" title="subfunction mObj = myObjectsFromCells(searchClass, mycell)">myObjectsFromCells</a>(mycell{i})};  <span class="comment">%pull myObjects from the cell and bring them to this level.</span>
0137       <span class="keyword">end</span>
0138    <span class="keyword">end</span>
0139    mObj= [mycell{myObjectMask}];
0140 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Sun 11-Oct-2015 14:40:09 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>